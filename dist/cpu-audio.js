(()=>{"use strict";const e="CPU-AUDIO",t="CPU-CONTROLLER",a="#interface",i="audio[controls]",n=["poster","actions","timeline","chapters","panels","panels-title","panels-except-play"],o=/^[a-zA-Z0-9\-_]+$/,r=/^([a-zA-Z0-9\-_]+_«)([a-zA-Z0-9\-_]+)((»_.*_«)([a-zA-Z0-9\-_]+))?(»)$/;let l="with-preview";const s={passive:!0},d={passive:!0,once:!0};function c(e){"function"==typeof e&&e()}function u(e,t,a){a=void 0===a?document:a,Array.from(a.querySelectorAll(e)).forEach(t)}function p(){return void 0!==window.customElements}function h(e){let t=document.createElement("a");return t.href="string"!=typeof e?e:e.split("#")[0],t.href}function _(){return!window.matchMedia("screen").matches}function m(e){h(window.location.href)===h(e.target.href)&&e.preventDefault()}function g(e){e.addEventListener("click",m)}function f(e){let t=document.createElement("span");t.innerText=e;let a=t.innerHTML;return t.remove(),a}function v(e){window.console.info("CPU-AUDIO: ",e)}function b(e){window.console.warn("CPU-AUDIO: ",e)}const y={units:{d:86400,h:3600,m:60,s:1},_is_only_numeric:/^\d+$/,_any_not_numeric:/\D*/g,Infinity:"?",TimeInSeconds:function(e){let t=0;return""!==e&&(t=y._is_only_numeric.test(e)?Number(e):-1===e.indexOf(":")?y.SubunitTimeInSeconds(e):y.ColonTimeInSeconds(e)),t},SubunitTimeInSeconds:function(e){let t=0;for(let a in y.units)if(y.units.hasOwnProperty(a)&&-1!==e.indexOf(a)){let i=e.split(a);t+=Number(i[0].replace(y._any_not_numeric,""))*y.units[a],e=i[1]}return t},ColonTimeInSeconds:function(e){let t=0,a=e.split(":"),i=[1,60,3600,86400];for(let e=0;e<a.length;e++)t+=Number(a[e])*i[a.length-1-e];return t},SecondsInTime:function(e){if(e==1/0)return y.Infinity;let t="",a=!1;for(let i in y.units)if(y.units.hasOwnProperty(i)){let n=y.units[i];if(e>=n||a){a=!0;let o=Math.floor(e/n);t+=o+i,e-=o*n}}return""===t?"0s":t},SecondsInColonTime:function(e){if(e==1/0)return y.Infinity;let t="",a=!1;for(let i in y.units)if(y.units.hasOwnProperty(i)){let n=y.units[i];if(e>=n||a){a=!0;let i=Math.floor(e/n);t+=""===t?"":":",t+=(i<10&&""!==t?"0":"")+i,e-=i*n}}return 1===t.length?"0:0"+t:2===t.length?"0:"+t:""===t?"0:00":t},SecondsInPaddledColonTime:function(e){if(e==1/0)return y.Infinity;let t=y.SecondsInColonTime(e);return"00:00:00".substr(0,8-t.length)+t},IsoDuration:function(e){return`P${y.SecondsInTime(e).toUpperCase()}`}},w={_timecode_start:0,_timecode_end:!1,_last_play_error:!1,_remove_timecode_outofborders:function(e){(e<w._timecode_start||!1!==w._timecode_end&&e>w._timecode_end)&&(w._timecode_start=0,w._timecode_end=!1)},hashOrder:async function(e,t){v("hashOrder");let a=!0;"string"!=typeof e&&(a="at_start"in e,e=location.hash.substr(1));let i="",n="",o=e.split("&"),r=!1;for(let e of o)if(-1===e.indexOf("=")&&""===i)i=e;else{let t=e.split("="),a=t[0],i=t[1];switch(a){case"t":i=""!==i?i:"0",n=i,r=!0;break;case"autoplay":r="1"===i;break;case"auto_play":r="true"===i}}if(""===n||a&&!r)return void c(t);let l=n.split(","),s=l[0];w._timecode_start=y.TimeInSeconds(s),w._timecode_end=l.length>1&&y.TimeInSeconds(l[1]),!1!==w._timecode_end&&(w._timecode_end=w._timecode_end>w._timecode_start&&w._timecode_end),await document.CPU.jumpIdAt(i,s,t),document.CPU.global_controller&&document.CPU.global_controller.build_playlist()},hover:function(e){let t=e.target,a=document.CPU.find_container(t),i=(t.getClientRects()[0].left,e.offsetX/t.clientWidth*a.audiotag.duration);a.show_throbber_at(i)},out:function(e){document.CPU.find_container(e.target).hide_throbber()},preview_container_hover:function(e){let t=e.target;if(t.id||(t=t.closest("[id]")),null===t)return;let a=document.CPU.find_container(t),i=a.get_point_names_from_id(t.id);a.highlight_point(i[0],i[1])},throbble:function(e){let t=0,a=e.target,i=document.CPU.find_container(a).audiotag;if(i.duration!==1/0){if(document.CPU.current_audiotag_playing&&!document.CPU.is_audiotag_playing(i)&&w.pause(void 0,document.CPU.current_audiotag_playing),isNaN(i.duration)&&!document.CPU.is_audiotag_streamed(i)){let t=i.CPU_controller();null!==t&&t.update_loading&&t.update_loading(void 0,100*e.offsetX/a.clientWidth);let n="loadedmetadata",o={offsetX:e.offsetX,target:e.target},r=function(){w.throbble(o)};return i.addEventListener(n,r,d),void i.setAttribute("preload","metadata")}t=void 0!==e.at?e.at:e.offsetX/a.clientWidth*i.duration,document.CPU.seekElementAt(i,t),w.play(e)}else w.play(e)},pause:function(e,t){if(void 0===t){let a=e.target;t="AUDIO"===a.tagName?a:document.CPU.find_container(a).audiotag}t.pause(),document.CPU.current_audiotag_playing=null,window.localStorage.removeItem(t.currentSrc)},play_once:function(e){let t=e.target;document.CPU.last_used=t,document.CPU.only_play_one_audiotag&&document.CPU.current_audiotag_playing&&!document.CPU.is_audiotag_playing(t)&&w.pause(void 0,document.CPU.current_audiotag_playing),document.CPU.current_audiotag_playing=t},play:function(e,t){function a(e){w._last_play_error=!1,document.CPU.autoplay&&w.play(e,t)}if(void 0===t&&(t=document.CPU.find_container(e.target).audiotag),void 0===e&&w._last_play_error)return void b("play() prevented because already waiting for focus");w._last_play_error=!1,w._remove_timecode_outofborders(t.currentTime);let i=t.play();if(void 0!==i&&i.then((e=>{document.CPU.had_played=!0})).catch((e=>{switch(w._last_play_error=!0,e.name){case"NotAllowedError":b("Auto-play prevented : Browser requires a manual interaction first."),document.addEventListener("focus",a,d),document.addEventListener("click",a,d),t.CPU_connected&&t.CPU_controller().CPU.set_act_container("glow");break;case"NotSupportedError":e("The browser refuses the audio source, probably due to audio format.")}})),document.CPU.global_controller){let e=document.CPU.global_controller;t.isEqualNode(e.audiotag)||(e.attach_audiotag_to_controller(t),e.audiotag=t,e.show_main(),e.redraw_all_planes(),e.set_mode_container()),e.build_playlist()}},key:function(e,t){if(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;t=void 0===t?1:t;let a=document.CPU.find_container(e.target),i=a.audiotag;function n(t){e.at=a.audiotag.currentTime+t,a.show_throbber_at(e.at),w.throbble(e),a.hide_throbber_later()}switch(e.keyCode){case 27:w.restart(e),w.pause(void 0,i);break;case 32:i.paused?w.play(e,i):w.pause(void 0,i);break;case 35:document.CPU.seekElementAt(i,i.duration);break;case 36:w.restart(e);break;case 37:n(-document.CPU.keymove*t);break;case 39:n(+document.CPU.keymove*t);break;default:return}e.preventDefault()},keydownplay:function(e){if(13!==e.keyCode)return;let t=document.CPU.find_container(e.target).audiotag;t.paused?w.play(void 0,t):w.pause(void 0,t),e.preventDefault()},restart:function(e){let t=document.CPU.find_container(e.target);document.CPU.seekElementAt(t.audiotag,0)},reward:function(e){e.keyCode=37,w.key(e)},foward:function(e){e.keyCode=39,w.key(e)},fastreward:function(e){e.keyCode=37,w.key(e,document.CPU.fast_factor)},fastfoward:function(e){e.keyCode=39,w.key(e,document.CPU.fast_factor)},_hand_on:null,_press_button:function(e){let t=e.target.id?e.target:e.target.closest("button");if(!t.id||-1===["fastreward","reward","foward","fastfoward"].indexOf(t.id))return;w[t.id](e),null!==w._hand_on&&window.clearTimeout(w._hand_on);let a={target:t,preventDefault:c};w._hand_on=window.setTimeout(w._repeat_button,document.CPU.repeat_delay,a),e.preventDefault()},_repeat_button:function(e){w[e.target.id](e),w._hand_on=window.setTimeout(w._repeat_button,document.CPU.repeat_factor,e)},_release_button:function(e){window.clearTimeout(w._hand_on),w._hand_on=null,e.preventDefault()},cuechange:function(e,t){document.body.classList.remove(document.CPU.body_className_playing_cue),document.CPU.body_className_playing_cue=`cpu_playing_tag_«${t.id}»_cue_«${e.id}»`,document.body.classList.add(document.CPU.body_className_playing_cue)},update:function(e){let t=e.target;!1!==w._timecode_end&&t.currentTime>w._timecode_end&&w.pause(void 0,t),t.CPU_update(),t.paused||document.CPU.is_audiotag_streamed(t)||window.localStorage.setItem(t.currentSrc,String(t.currentTime))},ended:function(e,t){if(void 0===t&&(t=e.target),!("playlist"in t.dataset))return;let a=t.dataset.playlist,i=document.CPU.playlists[a];if(void 0===i)return void b(`Named playlist ${a} not created. WTF ?`);let n=i.indexOf(t.id);if(-1===n)return void b(`Audiotag ${t.id} not in playlist ${a}. WTF ?`);if(n+1===i.length)return;let o=i[n+1],r=document.getElementById(o);null!==r?(document.CPU.seekElementAt(r,0),w.play({},r)):b(`Audiotag #${o} doesn't exists. WTF ?`)},observer_cpuaudio:function(e){let t=document.CPU.find_container(e[0].target);if(null===t.element.querySelector("audio"))return v("<audio> element was removed."),void t.element.remove();t.element.copy_attributes_to_media_dataset()},observer_audio:function(e){let t=document.CPU.find_container(e[0].target);t.build_chapters(),t.complete_template();let a=document.CPU.global_controller;null!==a&&t.audiotag.isEqualNode(a.audiotag)&&(a.build_chapters(),a.complete_template())},native_share:function(e){let t=document.CPU.find_container(e.target).fetch_audiotag_dataset();navigator.share({title:t.title,text:t.title,url:t.canonical}),e.preventDefault()},_show_alternate_nav:null,touchstart:function(e){let t=document.CPU.find_container(e.target);w._show_alternate_nav=setTimeout(t.show_handheld_nav,document.CPU.alternate_delay,t)},touchcancel:function(e){clearTimeout(w._show_alternate_nav)}};let C={autoplay:!1,keymove:5,only_play_one_audiotag:!0,alternate_delay:500,fast_factor:4,repeat_delay:400,repeat_factor:100,current_audiotag_playing:null,global_controller:null,body_className_playing_cue:null,dynamicallyAllocatedIdPrefix:"CPU-Audio-tag-",count_element:0,had_played:!1,last_used:null,playlists:{},advance_in_playlist:!0,convert:y,trigger:w,default_dataset:{title:function(){for(let e of["og","twitter"]){let t=document.querySelector(`meta[property="${e}:title"]`);if(null!==t)return t.content}let e=document.title;return""===e?null:e}(),poster:function(){for(let e of['property="og:image"','name="twitter:image:src"']){let t=document.querySelector(`meta[${e}]`);if(null!==t)return t.content}return null}(),canonical:function(){let e=document.querySelector('link[rel="canonical"]');return null!==e?e.href:location.href.split("#")[0]}(),twitter:function(){let e=document.querySelector('meta[name="twitter:creator"]');return null!==e&&e.content.length>1?e.content:null}(),playlist:null,waveform:null,duration:null,download:null},is_audiotag_streamed:function(e){return null===e||e.duration===1/0||void 0!==e.dataset.streamed},recall_stored_play:function(e){let t=e.target;if(null!==document.CPU.current_audiotag_playing||document.CPU.is_audiotag_streamed(t))return;let a=Number(window.localStorage.getItem(t.currentSrc));a>0&&!w._last_play_error&&(document.CPU.seekElementAt(t,a),w.play(void 0,t))},attach_events_audiotag:function(e){e.addEventListener("loadedmetadata",document.CPU.recall_stored_play,s),e.addEventListener("play",w.play_once,s),e.addEventListener("ended",w.ended,s),e.addEventListener("ready",document.CPU.recall_stored_play,s),e.addEventListener("canplay",document.CPU.recall_stored_play,s),["ready","load","loadeddata","canplay","abort","error","emptied","play","playing","pause","ended","durationchange","loadedmetadata","timeupdate","waiting"].forEach((t=>{e.addEventListener(t,w.update)})),p()||["pause","ended"].forEach((t=>{e.addEventListener(t,w.pause)})),""===e.getAttribute("preload")&&(e.preload="metadata",e.load())},connect_audiotag:function(e){if(!e.CPU_connected&&(e.CPU_connected=!0,document.CPU.attach_events_audiotag(e),e.hidden=!0,e.removeAttribute("controls"),"string"==typeof e.dataset.playlist)){let t=e.dataset.playlist;t in document.CPU.playlists||(document.CPU.playlists[t]=[]),document.CPU.playlists[t].push(e.id)}},is_audiotag_playing:function(e){return document.CPU.current_audiotag_playing&&e.isEqualNode(document.CPU.current_audiotag_playing)},is_audiotag_global:function(e){return null===this.global_controller?this.is_audiotag_playing(e):e.isEqualNode(this.global_controller.audiotag)},jumpIdAt:async function(e,t,a){function i(e){let a=e.target,i=y.TimeInSeconds(t);document.CPU.seekElementAt(a,i);let o={target:a};a.readyState>=a.HAVE_FUTURE_DATA?n(o):a.addEventListener("canplay",n,d),w.update(o)}function n(e){let t=e.target;w.play(void 0,t),c(a)}let o=""!==e?document.getElementById(e):document.querySelector("cpu-audio audio");if(null==o||void 0===o.currentTime)return void b(`Unknow audiotag ${e}`);let r={target:o};o.readyState<HTMLMediaElement.HAVE_CURRENT_DATA?(o.addEventListener("loadedmetadata",i,d),o.load(),w.update(r)):i(r)},seekElementAt:function(e,t){if(isNaN(t)||document.CPU.is_audiotag_streamed(e))return;if(void 0!==e.fastSeek)e.fastSeek(t);else try{e.currentTime=t}catch(a){e.src=`${e.currentSrc.split("#")[0]}#t=${t}`}let a=e.CPU_controller();null!==a&&a.update_loading&&a.update_loading(t)},find_interface:function(e){return e.closest(a)},find_container:function(a){if(a.tagName===e||a.tagName===t)return a.CPU;let i=a.closest(e);return i?i.CPU:document.CPU.find_interface(a).parentNode.host.CPU},find_current_playlist:function(){if(null===this.global_controller)return[];let e=this.global_controller.audiotag;if(null===e)return[];for(let t in this.playlists)if(this.playlists[t].indexOf(e.id)>=0)return this.playlists[t];return[]}};const P={fr:{loading:"Chargement en cours…",pause:"Pause",play:"Lecture",canonical:"Lien vers la fiche du sonore",moment:"Lien vers ce moment",untitled:"(sans titre)",cover:"pochette",more:"Actions",share:"Partager",twitter:"Partager sur Twitter",facebook:"Partager sur Facebook",e_mail:"Partager par e-mail",download:"Télécharger",back:"Annuler",chapters:"Chapitres",playlist:"Playlist",media_err_aborted:"Vous avez annulé la lecture.",media_err_network:"Une erreur réseau a causé l'interruption du téléchargement.",media_err_decode:"La lecture du sonore a été annulée suite à des problèmes de corruption ou de fonctionnalités non supportés par votre navigateur.",media_err_src_not_supported:"Le sonore n'a pu être chargé, soit à cause de sourcis sur le serveur, le réseau ou parce que le format n'est pas supporté.",media_err_unknow:"Erreur due à une raison inconnue."},en:{loading:"Loading…",pause:"Pause",play:"Play",canonical:"Link to the sound's page",moment:"Link to this time",untitled:"(untitled)",cover:"cover",more:"Actions",share:"Share",twitter:"Share on Twitter",facebook:"Share on Facebook",e_mail:"Share via e-mail",download:"Download",back:"Back",chapters:"Chapters",playlist:"Playlist",media_err_aborted:"You have aborted the play.",media_err_network:"A network error broke the download.",media_err_decode:"Play was canceled due to file corruption or a not supported function in your browser.",media_err_src_not_supported:"The media cannot be downloaded due to server problems, network problems or unsupported by your browser.",media_err_unknow:"Error of unknown cause."}};let U=document.querySelector("html").lang;if(!U.length||!(U.toLowerCase()in P)){U="en";let e=window.navigator.languages;e=void 0!==e?e:[navigator.language||navigator.browserLanguage];let t=!1;for(let a of e)if(a.split){let e=a.split("-")[0];!t&&e in P&&(U=e)}}const x=P[U],k=/<(\w+)(\.[^>]+)?( [^>]+)?>/gi,L=/<\/(\w+)( [^>]*)?>/gi;class E{constructor(e,t){this.element=e,this.elements={},this.audiotag=e._audiotag,this.container=t,this.mode_when_play=null,this.glow_before_play=!1,this.current_playlist=[],this._activecue=null,this.mode_was=null,this.act_was=null,this.elapse_was=null,this.audiotag&&!this.audiotag._CPU_planes&&(this.audiotag._CPU_planes={})}async _fire_event(e,t){this.element.dispatchEvent(new CustomEvent(`CPU_${e}`,{target:this.element,bubbles:!0,cancelable:!1,composed:!1,detail:t}))}set_mode_container(e=null){e=null!==e?e:"default",this.mode_was!==e&&(this.container.classList.remove(`mode-${this.mode_was}`),this.container.classList.add(`mode-${e}`),this.mode_was=e)}set_act_container(e){this.act_was!==e&&(document.CPU.had_played||"loading"!==e)&&(this.container.classList.remove("act-loading","act-pause","act-play","act-glow"),this.container.classList.add(`act-${e}`),this.act_was=e)}set_hide_container(e){for(let e of n)this.container.classList.remove(`hide-${e}`);for(let t of e)t=t.toLowerCase(),n.indexOf(t)>-1&&this.container.classList.add(`hide-${t}`)}update_playbutton(){let e=this.audiotag,t=e.getAttribute("preload"),a=!t||"none"!==t.toLowerCase();if(e.readyState<HTMLMediaElement.HAVE_CURRENT_DATA&&(a||e._CPU_played))return void this.set_act_container("loading");w._last_play_error&&e.paused||this.set_act_container(e.paused?"pause":"play");let i="last-used",n=document.CPU.last_used;e.paused?(this.audiotag.isEqualNode(n)||this.container.classList.remove(i),!e._CPU_played&&this.glow_before_play&&this.set_act_container("glow")):(e._CPU_played=!0,this.container.classList.add(i),null!==this.mode_when_play&&(this.set_mode_container(this.mode_when_play),this.mode_when_play=null))}update_line(e,t,a){let i=this.audiotag.duration;void 0===a&&(a=0===i?0:100*t/i),this.elements[`${e}line`].style.width=`${a}%`}update_time(){let e=this.audiotag,t=document.CPU.is_audiotag_streamed(e)?0:Math.floor(e.currentTime),a=e.dataset.canonical;a=void 0===a?"":a;let i=h(a)+"#",n=a.indexOf("#");i+=(-1===n?e.id:a.substr(n+1))+"&t="+t;let o=this.elements.elapse;o.href=i;let r="…",l=Math.round(e.duration);if(isNaN(l)){let t=Math.round(e.dataset.duration);t>0&&(r=y.SecondsInColonTime(t))}else r=y.SecondsInColonTime(l);let s=y.SecondsInColonTime(e.currentTime),d=document.CPU.is_audiotag_streamed(e)?s:`${s}<span class="nosmaller"> / ${r}</span>`;this.elapse_was!==d&&(o.innerHTML=d,this.elapse_was=d),this.update_line("loading",e.currentTime)}update_time_borders(){let e=this.audiotag,t="_borders";document.CPU.is_audiotag_global(e)&&!1!==w._timecode_end?(this.add_plane(t,"",{track:"borders",panel:!1,highlight:!1}),this.add_point(t,w._timecode_start,"play",{link:!1,end:w._timecode_end})):this.remove_plane(t)}update_loading(e,t){this.update_line("loading",e,t),this.set_act_container("loading")}update_error(){let e=this.audiotag;if(null===e)return!0;let t=e.error;if(null!==t){let e,a=this.elements.pageerror;switch(this.show_interface("error"),t.code){case MediaError.MEDIA_ERR_ABORTED:e=x.media_err_aborted;break;case MediaError.MEDIA_ERR_NETWORK:e=x.media_err_network;break;case MediaError.MEDIA_ERR_DECODE:e=x.media_err_decode;break;case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:e=x.media_err_src_not_supported;break;default:e=x.media_err_unknow}return a.innerText=e,!0}return!1}update(){this.update_error()||(this.update_playbutton(),this.update_time(),this.update_time_borders())}position_time_element(e,t,a){function i(e){return void 0!==e&&!1!==e}let n=this.audiotag.duration;0===n||isNaN(n),i(t)&&(e.style.left=t/n*100+"%"),i(a)&&(e.style.right=100-a/n*100+"%")}async show_throbber_at(e){let t=this.audiotag;if(t.duration<1)return;isNaN(t.duration)&&!document.CPU.is_audiotag_streamed(t)&&t.setAttribute("preload","metadata");let a=this.elements.popup;this.elements.line,a.style.opacity=1,this.position_time_element(a,e),a.innerHTML=y.SecondsInColonTime(e),a.dateTime=y.SecondsInTime(e).toUpperCase()}hide_throbber(e){(e=void 0===e?this:e).elements.popup.style.opacity=0}hide_throbber_later(){let e=this.elements.popup;e._hider&&window.clearTimeout(e._hider),e._hider=window.setTimeout(this.hide_throbber,1e3,this)}fetch_audiotag_dataset(){let e={};for(let t in document.CPU.default_dataset){let a=null;t in this.audiotag.dataset?a=this.audiotag.dataset[t]:null!==document.CPU.default_dataset[t]&&(a=document.CPU.default_dataset[t]),e[t]=void 0===a?null:a}return e}update_links(){let e=this;function t(t,a){e.elements[t].href=a}let a=this.fetch_audiotag_dataset(),i=(null===a.canonical?"":function(e){let t=e.indexOf("#");return-1===t?e:e.substr(0,t)}(a.canonical))+`#${this.audiotag.id}`+(0===this.audiotag.currentTime?"":`&t=${Math.floor(this.audiotag.currentTime)}`),n=encodeURI(h(i)),o="";a.twitter&&"@"===a.twitter[0]&&(o=`&via=${a.twitter.substring(1)}`),t("twitter",`https://twitter.com/share?text=${a.title}&url=${n}${o}`),t("facebook",`https://www.facebook.com/sharer.php?t=${a.title}&u=${n}`),t("email",`mailto:?subject=${a.title}&body=${n}`);let r=this.audiotag.currentSrc;a.download&&(r=a.download);let l=this.audiotag.querySelector("source[data-downloadable]");l&&(r=l.src),t("link",r)}show_interface(e){this.container.classList.remove("show-no","show-main","show-share","show-error","media-streamed"),document.CPU.is_audiotag_streamed(this.audiotag)&&this.container.classList.add("media-streamed"),this.container.classList.add("show-"+e)}show_actions(e){let t=void 0!==e?document.CPU.find_container(e.target):this;t.show_interface("share"),t.update_links()}show_main(e){(void 0!==e?document.CPU.find_container(e.target):this).show_interface("main")}show_handheld_nav(e){let t=void 0!==e?document.CPU.find_container(e.target):this;document.CPU.is_audiotag_streamed(t.audiotag)||(t.container.classList.toggle("show-handheld-nav"),e.preventDefault())}inject_css(e,t){if(!e.match(o))return a=`inject_css invalid key "${e}"`,void window.console.error("CPU-AUDIO: ",a);var a;this.remove_css(e);let i=document.createElement("style");i.id=`style_${e}`,i.innerHTML=t,this.container.appendChild(i)}remove_css(e){let t=this.container.querySelector(`#style_${e}`);t&&t.remove()}add_id_to_audiotag(){""===this.audiotag.id&&(this.audiotag.id=document.CPU.dynamicallyAllocatedIdPrefix+String(document.CPU.count_element++))}complete_template(){let e=this.fetch_audiotag_dataset(),t=this.elements.canonical;t.href=e.canonical,null===e.title?(t.classList.add("untitled"),e.title=x.untitled):t.classList.remove("untitled"),t.innerText=e.title,this.elements.poster.src=null===e.poster?"":e.poster,this.elements.time.style.backgroundImage=null===e.waveform?"":`url(${e.waveform})`}attach_audiotag_to_controller(e){e&&(this.audiotag=e,this.add_id_to_audiotag(),this.complete_template(),w.update({target:e}))}get_plane(e){return this.audiotag._CPU_planes[e]}get_plane_track(e){return this.elements.line.querySelector(`#track_«${e}»`)}get_plane_panel(e){return this.container.querySelector(`#panel_«${e}»`)}get_plane_nav(e){let t=this.get_plane_panel(e);return t?t.querySelector("ul"):null}draw_plane(e){let a=this.get_plane_track(e);a&&a.remove();let i=this.get_plane_panel(e);i&&i.remove();let n=this.get_plane(e);if(!n)return;let o=w.preview_container_hover,r=this.remove_highlights_points.bind(this);function l(e){e.addEventListener("mouseover",o,s),e.addEventListener("focusin",o,s),e.addEventListener("mouseleave",r,s),e.addEventListener("focusout",r,s)}if(!1!==n.track&&(a=document.createElement("aside"),a.id=`track_«${e}»`,!0!==n.track&&a.classList.add(n.track.split(" ")),this.elements.line.appendChild(a),l(a)),!1!==n.panel){i=document.createElement("div"),i.id=`panel_«${e}»`,!0!==n.panel&&i.classList.add(n.panel.split(" ")),i.classList.add("panel");let t="<nav><ul></ul></nav>";void 0!==n.title&&(t=`<h6>${f(n.title)}</h6>${t}`),i.innerHTML=t,this.container.appendChild(i),l(i)}this.element.tagName!==t&&null!==document.CPU.global_controller&&this.audiotag.isEqualNode(document.CPU.global_controller.audiotag)&&document.CPU.global_controller.draw_plane(e)}add_plane(e,a,i){if(this.element.tagName===t||!e.match(o)||void 0!==this.get_plane(e))return!1;void 0===i&&(i={}),void 0===this.audiotag._CPU_planes&&(this.audiotag._CPU_planes={});let n={track:!0,panel:!0,title:a,highlight:!0,points:{}};for(let e in n)void 0===i[e]&&(i[e]=n[e]);return this.audiotag._CPU_planes[e]=i,this.draw_plane(e),!0}remove_plane(e){if(this.element.tagName===t||!e.match(o)||void 0===this.audiotag._CPU_planes[e])return!1;this.audiotag&&delete this.audiotag._CPU_planes[e];let a=this.get_plane_track(e);return a&&a.remove(),a=this.get_plane_panel(e),a&&a.remove(),this.element.tagName!==t&&null!==document.CPU.global_controller&&this.audiotag.isEqualNode(document.CPU.global_controller.audiotag)&&document.CPU.global_controller.draw_plane(e),!0}get_point_id(e,t,a){return`${a?"panel":"track"}_«${e}»_point_«${t}»`}get_point(e,t){return this.audiotag._CPU_planes[e].points[t]}get_point_track(e,t){return this.elements.line.querySelector("#"+this.get_point_id(e,t,!1))}get_point_panel(e,t){return this.container.querySelector("#"+this.get_point_id(e,t,!0))}translate_vtt(e){let t={i:"i",em:"em",b:"b",bold:"strong",u:"u",lang:"i"};function a(e){return!(e in t)}return e.split("<").length!==e.split(">").length?f(e):e.replace(k,(function(e,i,n,o){if(a(i=i.toLowerCase()))return"";let r="";return"lang"===i&&(r=` lang="${o.trim()}"`),`<${t[i]}${r}>`})).replace(L,(function(e,i){return a(i=i.toLowerCase())?"":`</${t[i]}>`})).replaceAll("\n","<br/>")}plane_resort(e){this.audiotag._CPU_planes[e].points=Object.fromEntries(Object.entries(this.audiotag._CPU_planes[e].points).sort(((e,t)=>e[1].start-t[1].start)))}draw_point(e,a){let i=this.get_point(e,a),n=this.audiotag?this.audiotag:document.CPU.global_controller.audiotag,o=i.start,r=i.link,l="#",s=`#${n.id}&t=${o}`;!0===r&&(l=s),"string"==typeof r&&(l=r);let d,c=this.get_plane_track(e);if(c){d=this.get_point_track(e,a);let t=this.get_point_id(e,a,!1);d||(d=document.createElement("a"),d.id=t,d.tabIndex=-1,c.appendChild(d)),d.href=l,d.title=i.text;let n="";i.image&&(n=`<img src="${i.image}" alt="">`),n+=`<span>${i.text}</span>`,d.innerHTML=n,this.position_time_element(d,o,i.end)}let u,p=this.get_plane_nav(e);if(p){u=this.get_point_panel(e,a),Number(i.start);let t=this.get_point_id(e,a,!0);u||(u=document.createElement("li"),u.id=t,u.innerHTML='<a href="#" class="cue"><strong></strong><time></time></a>',p.appendChild(u)),u.querySelector("strong").innerHTML=i.text;let n=u.querySelector("time");n.dateTime=y.IsoDuration(o),n.innerText=y.SecondsInColonTime(o),u.querySelector("a").href=l}this._fire_event("draw_point",{plane:e,point:a,data_point:i,element_point_track:d,element_point_panel:u}),this.element.tagName!==t&&null!==document.CPU.global_controller&&this.audiotag.isEqualNode(document.CPU.global_controller.audiotag)&&document.CPU.global_controller.draw_point(e,a)}add_point(e,a,i,n){return n=void 0===n?{}:n,!(this.element.tagName===t||void 0===this.get_plane(e)||void 0!==this.get_point(e,i)||a<0||!i.match(o)||(n.start=a,this.audiotag._CPU_planes[e].points[i]=n,this._fire_event("add_point",{plane:e,point:i,data_point:n}),this.audiotag._CPU_planes[e]._st_max>a?this.refresh_plane(e):(this.draw_point(e,i),this.audiotag._CPU_planes[e]._st_max=a),0))}edit_point(e,t,a){let i=this.get_point(e,t),n=!1;"start"in a&&Number(a.start)!==i.start&&(n=!0);for(let e in i)e in a&&(i[e]=a[e]);this.audiotag._CPU_planes[e].points[t]=i,n?(this.clear_plane(e),this.refresh_plane(e)):this.draw_point(e,t),this._fire_event("edit_point",{plane:e,point:t,data_point:a});let o=Number(a.start);this.audiotag._CPU_planes[e]._st_max<o&&(this.audiotag._CPU_planes[e]._st_max=o)}remove_point(e,a){let i=this.get_point_track(e,a);if(!i)return!1;this._fire_event("remove_point",{plane:e,point:a}),i.remove(),this.get_point_panel(e,a).remove(),delete this.audiotag._CPU_planes[e].points[a];let n=0;for(let t of Object.values(this.audiotag._CPU_planes[e].points)){let e=Number(t.start);n=n<e?e:n}return this.audiotag._CPU_planes[e]._st_max=n,this.element.tagName!==t&&null!==document.CPU.global_controller&&this.audiotag.isEqualNode(document.CPU.global_controller.audiotag)&&document.CPU.global_controller.remove_point(e,a),!0}get_point_names_from_id(e){return[e.replace(r,"$2"),e.replace(r,"$5")]}clear_plane(e){let t=this.get_plane(e);if(!t)return!1;for(let a of Object.keys(t.points))this.remove_point(e,a);let a=this.get_plane_nav(e);return null!==a&&(a.innerHTML=""),this.audiotag._CPU_planes[e]._st_max=0,!0}refresh_plane(e){this.plane_resort(e);for(let t of Object.keys(this.audiotag._CPU_planes[e].points))this.draw_point(e,t)}undraw_all_planes(){u("aside, div.panel",(e=>{e.remove()}),this.container)}redraw_all_planes(){this.undraw_all_planes();for(let e of Object.keys(this.audiotag._CPU_planes))this.draw_plane(e),this.refresh_plane(e)}reposition_tracks(){if(this.audiotag.duration,0!==this.audiotag.duration&&!isNaN(this.audiotag.duration))for(let e in this.audiotag._CPU_planes)if(!1!==this.get_plane(e).track)for(let t of Object.keys(this.audiotag._CPU_planes[e].points)){let a=this.get_point(e,t),i=this.get_point_track(e,t);this.position_time_element(i,a.start,a.end)}}remove_highlights_points(e,a){a=void 0===a||a,u(`.${e="string"==typeof e?e:l}`,(t=>{t.classList.remove(e)}),this.container),a&&null!==document.CPU.global_controller&&this.audiotag.isEqualNode(document.CPU.global_controller.audiotag)&&(this.element.tagName!==t?document.CPU.global_controller.remove_highlights_points(e,!1):document.CPU.find_container(document.CPU.global_controller.audiotag).remove_highlights_points(e,!1))}highlight_point(e,a,i,n){n=void 0===n||n,i="string"==typeof i?i:l,this.remove_highlights_points(i,n);let o=this.get_plane(e);if(o&&o.highlight){if(this.get_plane_track(e)){let t=this.get_point_track(e,a);t&&t.classList.add(i)}if(this.get_plane_panel(e)){let t=this.get_point_panel(e,a);t&&t.classList.add(i)}n&&null!==document.CPU.global_controller&&this.audiotag.isEqualNode(document.CPU.global_controller.audiotag)&&(this.element.tagName!==t?document.CPU.global_controller.highlight_point(e,a,i,!1):document.CPU.find_container(document.CPU.global_controller.audiotag).highlight_point(e,a,i,!1))}}_cuechange_event(e){let t,a="active-cue";try{let a=this.audiotag.currentTime;for(let i of e.target.activeCues)i.startTime<=a&&a<i.endTime&&(t=i);if(Object.is(t,this._activecue))return;this._activecue=t}catch(e){window.console.error(e)}this.remove_highlights_points(a),t&&(w.cuechange(t,this.audiotag),this._fire_event("chapter_changed",{cue:t}),this.highlight_point("_chapters",t.id,a))}async build_chapters(a){if(this.element.tagName===t)return;let i,n=this.audiotag,o=!1,r="_chapters";if(n&&n.textTracks&&n.textTracks.length>0){let e=null;for(let t of n.textTracks)"chapters"!==t.kind.toLowerCase()||null===t.cues||null!==e&&t.language.toLowerCase()!==prefered_language||(e=t);if(e&&e.cues.length>0){this.add_plane(r,x.chapters,{track:"chapters"});let t=this._cuechange_event.bind(this);e.removeEventListener("cuechange",t,s),e.addEventListener("cuechange",t,s);for(let t of e.cues)if(t.startTime<=t.startTime&&t.startTime<t.endTime&&(i=t),!this.get_point(r,t.id)){let e=Math.floor(t.startTime);this.add_point(r,e,t.id,{text:this.translate_vtt(t.text),link:!0,end:t.endTime})}e.cues.length>0&&(o=!0)}}if(this.element.tagName===e){let e=`cpu_tag_«${n.id}»_chaptered`;o?document.body.classList.add(e):(this.remove_plane(r),document.body.classList.remove(e))}}build_chapters_loader(){this.audiotag.addEventListener("durationchange",this.reposition_tracks.bind(this),s),this.build_chapters();let e=this.build_chapters.bind(this);this.audiotag.addEventListener("loadedmetadata",e,d);let t=this.audiotag.querySelector('track[kind="chapters"]');t&&!t._CPU_load_ev&&(t._CPU_load_ev=t.addEventListener("load",e,s))}build_playlist(){if(this.element.tagName!==t)return;this.current_playlist,this.current_playlist=document.CPU.find_current_playlist();let e=this.elements.playlist;if(e.innerHTML="",0!==this.current_playlist.length){e.innerHTML=`<h6>${x.playlist}</h6>`;for(let t of this.current_playlist){let a=document.getElementById(t),i=document.createElement("a");i.classList.add("cue"),t===this.audiotag.id&&i.classList.add("active-cue"),i.href=`#${a.id}&t=0`,i.tabIndex=0,i.innerHTML=`<strong>${a.dataset.title}</strong>`,e.append(i)}}}build_controller(){let e=this;u("[id]",(t=>{e.elements[t.id]=t}),this.element.shadowRoot),this.elements.poster.addEventListener("load",(()=>{e.elements.interface.classList.add("poster-loaded")}),s);let t={pause:w.play,play:w.pause,time:w.throbble,actions:this.show_actions,back:this.show_main,poster:this.show_main,restart:w.restart};for(let e in t)this.elements[e].addEventListener("click",t[e],s);let a=["fastreward","reward","foward","fastfoward"],i={touchstart:!0,touchend:!1,touchcancel:!1,mousedown:!0,mouseup:!1,mouseleave:!1};w._press_button,w._release_button;for(let e of a)for(let t in i)this.elements[e].addEventListener(t,i[t]?w._press_button:w._release_button);this.element.addEventListener("keydown",w.key),this.elements.control.addEventListener("keydown",w.keydownplay);let n=this.elements.time,o={mouseover:!0,mousemove:!0,mouseout:!1,touchstart:!0,touchend:!1,touchcancel:!1};for(let e in o)n.addEventListener(e,o[e]?w.hover:w.out,s);n.addEventListener("touchstart",w.touchstart,s),n.addEventListener("touchend",w.touchcancel,s),n.addEventListener("contextmenu",this.show_handheld_nav),this.audiotag&&(this.show_main(),this.build_chapters_loader(),this._fire_event("ready"))}}class T extends HTMLElement{constructor(){if(super(),this.CPU=null,_())return void this.remove();if(this.tagName===e&&null===this.querySelector(i))return b("Tag <CPU-AUDIO> without <audio controls>.\nSee https://github.com/dascritch/cpu-audio/blob/master/INSTALL.md for a correct installation."),void this.remove();let t=document.querySelector("template#CPU__template");this.attachShadow({mode:"open"}).innerHTML=t.innerHTML}connectedCallback(){if(_())return;this.CPU=new E(this,this.shadowRoot.querySelector(a)),this.CPU.audiotag||(document.CPU.global_controller=this.CPU,this.CPU.audiotag=document.querySelector("cpu-audio audio")),this.CPU.build_controller(),u("#canonical",g,this.shadowRoot),this.CPU.attach_audiotag_to_controller(this.CPU.audiotag);let e=this.CPU.elements.interface.classList,t=this.getAttribute("mode");if(null!==t){let e=t.split(",");e.length>1&&(t=this.CPU.audiotag.paused?e[0]:e[1],this.CPU.mode_when_play=e[1])}this.CPU.set_mode_container(t);let i=this.getAttribute("hide");null!==i&&this.CPU.set_hide_container(i.split(" ")),navigator.share&&(e.add("hasnativeshare"),this.CPU.elements.nativeshare.addEventListener("click",w.native_share)),null!==this.getAttribute("glow")&&(this.CPU.glow_before_play=!0,this.CPU.update_playbutton())}disconnectedCallback(){}}class $ extends T{constructor(){super(),this._audiotag=null,this.audiotag=null,this.observer_cpuaudio=null,this.observer_audio=null}copy_attributes_to_media_dataset(){for(let e in document.CPU.default_dataset){let t=this.getAttribute(e);null!==t&&(this._audiotag.dataset[e]="duration"!==e?t:y.TimeInSeconds(t))}}connectedCallback(){this._audiotag=this.querySelector(i),null!==this._audiotag&&(this.copy_attributes_to_media_dataset(),super.connectedCallback(),document.CPU.connect_audiotag(this.CPU.audiotag),this.observer_cpuaudio=new MutationObserver(w.observer_cpuaudio),this.observer_cpuaudio.observe(this,{childList:!0,attributes:!0}),this.observer_audio=new MutationObserver(w.observer_audio),this.observer_audio.observe(this,{childList:!0,attributes:!0,subtree:!0}))}}async function S(){!function(){let e=document.createElement("style");e.innerHTML=' audio[controls] { display : block; width : 100%; } :root { --cpu-height : 64px; --cpu-font-family : Lato, "Open Sans", "Segoe UI", Frutiger, "Frutiger Linotype", "Dejavu Sans", "Helvetica Neue", Arial, sans-serif; --cpu-font-size : 15px; --cpu-font-small-size : calc(var(--cpu-font-size) * 0.8); --cpu-background : #555; --cpu-color : #ddd; --cpu-playing-background : #444; --cpu-playing-color : #fff; --cpu-error-background : #a00 ; --cpu-error-color : #ff7 ; --cpu-popup-background : #aaa; --cpu-popup-color : #333; --cpu-cue : #000; --cpu-timeline-limits : #f00; --cpu-elapse-width : 160px; --cpu-min-padding : 16px; --cpu-inner-shadow : inset 0px 5px 10px -5px black; --cpu-color-transitions : 0s; --cpu-background-transitions : 0s; --cpu-unfold : 0s; } @media (max-width: 640px) { :root , .interface { --cpu-font-size : 13px; --cpu-height : 48px; --cpu-elapse-width : 140px; --cpu-min-padding : 4px; } @media (max-width: 480px) { :root , .interface { --cpu-elapse-width : 70px; } }',document.head.appendChild(e);let t=document.createElement("template");t.id="CPU__template",t.innerHTML=`<style>:host { all: initial; display: block; contain: content; } .act-play { --cpu-background : var(--cpu-playing-background); --cpu-color : var(--cpu-playing-color); } .show-error { --cpu-background : var(--cpu-error-background); --cpu-color : var(--cpu-error-color); } #interface { --cpu-timeline-height : 10px; background : var(--cpu-background); color : var(--cpu-color); } #interface, * { font-family : var(--cpu-font-family); font-size : var(--cpu-font-size); font-weight: normal; font-style: normal; line-height : 1.2; border : none; padding : 0; margin : 0; text-indent: 0; list-style-type: none; user-select: none; transition : color var(--cpu-color-transitions), background-color var(--cpu-background-transitions), opacity var(--cpu-background-transitions); } .show-no main { visibility : hidden; } main { display : flex; overflow : hidden; height : var(--cpu-height); } a, button { color : currentColor; border : none; text-decoration : none; } button { background : transparent; } svg { fill : currentColor; width : var(--cpu-height); height : var(--cpu-height); } i, em { font-style: italic; } b, strong, h5 a { font-weight: bold; } [src=''] { visibility: hidden; } #pageerror { padding: 0px 4px; align-self: center; } #control, #actions { flex : 0 0 var(--cpu-height); width : var(--cpu-height); max-height : var(--cpu-height); height : 100%; text-align : center; vertical-align : middle; } a { cursor : pointer; } #loading, #play, #pause, .show-main #pageshare, .show-main #pageerror, .show-share #pagemain, .show-share #pageerror, .show-error #pagemain, .show-error #pageshare , .show-error #poster, #handheld-nav , .show-handheld-nav #titleline { display : none; } .act-loading #loading, .act-play #play, .act-glow #pause, .act-pause #pause { display : block; } .act-glow #pause { animation : glow 2s infinite; } @keyframes glow { 0% {opacity : 0.5;} 50% {opacity : 1;} 100% {opacity : 0.5;} } .show-share #pageshare, .show-main #pagemain { flex : 1 1 100%; display : flex; align-items: center; } .act-loading #loading circle { fill : #777; opacity : 1; animation: pulse 2s infinite; } #loading circle:nth-child(2) { animation-delay:0.5s; } #loading circle:nth-child(3) { animation-delay:1s; } @keyframes pulse { 50% {opacity : 0;} } #poster { max-width : var(--cpu-height); min-width : var(--cpu-height); max-height : var(--cpu-height); min-height : var(--cpu-height); object-fit: contain; opacity : 0; } .poster-loaded #poster { opacity: 1; } .hide-poster #poster { display : none; } #control svg, #actions svg { vertical-align : middle; max-width : 100%; max-height : 100%; } #titleline { display : flex; align-items: center; } #about, #title { flex : 1 1 auto; position : relative; } /* #about { overflow : hidden; display:flex; flex-direction : column; }*/ #title { overflow: hidden; text-overflow : '…'; } #title a { display : block; max-height: calc(6px + calc(2 * var(--cpu-font-size))); } #canonical.untitled { font-style : italic; } #elapse { flex : 0 1 var(--cpu-elapse-width); text-align : right; } .mode-compact #elapse { flex : 0 0 calc(var(--cpu-elapse-width) + 32px); text-align : center; } #time { background-color : black; background-repeat: no-repeat; background-size: 100% 100%; width : 100%; height : var(--cpu-timeline-height); display : block; position : relative; cursor:none; } #loadingline { background : currentColor; height : var(--cpu-timeline-height); display : block ; position : absolute; left : 0; pointer-events : none; } #loadingline:after { content : ''; position: absolute; right : 0px; width : 0px; height : var(--cpu-timeline-height); display : block; outline : var(--cpu-color) 4px solid; z-index : 127; opacity : 0; } main:hover #loadingline:after, main:focus #loadingline:after { opacity : 1; } aside { position : absolute; width : 100%; } aside a { position : absolute; display : block; } aside a span { display : none; } aside.chapters { height : 2px; } aside.chapters a { background : var(--cpu-cue); height : 2px; border : 1px solid var(--cpu-background); } aside.chapters a.active-cue { background : var(--cpu-color); } aside.borders { pointer-events : none; height : var(--cpu-timeline-height); z-index : 4; top : calc( var(--cpu-timeline-height) + 6px); } aside.borders a { height : var(--cpu-timeline-height); background: transparent; } aside.borders a:before, aside.borders a:after { pointer-events : none; content:""; position : absolute; width : 2px; height : var(--cpu-timeline-height); border : 2px solid var(--cpu-timeline-limits); } aside.borders a:before { border-right-width: 0px; left : 0%; } aside.borders a:after { border-left-width: 0px; left : 100%; } aside.ticker { height : 16px; top : 30px; } aside.ticker a.active-cue { left : 0px !important; right : 0px !important; background : inherit !important; color : inherit !important; } aside.ticker a.active-cue span { display : inline-block; } /* #infoline { flex: 0 0 auto; min-height : 14px; } */ .act-loading #loadingline { background : repeating-linear-gradient(45deg, var(--cpu-color) 0, var(--cpu-background) 15px, var(--cpu-color) 30px); background-size: 200% 200%; animation: loadingline 1s linear infinite; } @keyframes loadingline { 0% { background-position-y : var(--cpu-timeline-height); } } #handheld-nav { max-height: calc(6px + calc(2 * var(--cpu-font-size))); padding-bottom: 8px; } .show-handheld-nav #handheld-nav { display : flex; } #handheld-nav * { flex : 1 0 auto; height : calc(2 * var(--cpu-font-size)); } .hide-actions #actions { visibility : hidden; pointer-events: none; min-width : var(--cpu-min-padding); max-width : var(--cpu-min-padding); } #pageshare { text-align : center; } #pageshare a { display: flex; align-items: center; justify-content: center; height : var(--cpu-height); } #pageshare a, #pageshare div { flex : 1 0; color : white; text-decoration : none; overflow : hidden; text-overflow : clip; } #pageshare svg { vertical-align : middle; width : 32px; height : 32px; } #pageshare #nativeshare { display : none; } .hasnativeshare #pageshare #nativeshare { display : flex; } .hasnativeshare #pageshare .nonativeshare { display : none; } #twitter { background : #4DB5F4 } #facebook, #nativeshare { background : #5974CC } #email { background : #CC0000 } #link { background : #77F } #popup { pointer-events : none; position: absolute; transform: translate(-25px, -19px); z-index : 127; min-width : 50px; font-size : 11px; text-align : center; padding : 2px; border-radius: 4px; box-shadow: black 2px 2px; background : var(--cpu-popup-background); color : var(--cpu-popup-color); opacity : 0; } #popup:before { pointer-events : none; content:""; position: absolute; z-index : 127; left: 20px; bottom: -8px; width: 0; height : 0; border-top: 8px solid var(--cpu-popup-background); border-left: 4px solid transparent; border-right: 4px solid transparent; } .panel { display : flex; list-style: none; flex-direction: column; padding : 0 var(--cpu-min-padding); box-shadow: var(--cpu-inner-shadow); } h6 { text-align : center; } .cue { border-top : 1px solid black; display : flex; margin : 0px; padding : 2px } .cue strong { flex : 1 1; font-weight : normal; } .cue time { flex : 0 0 var(--cpu-elapse-width) 0px; text-align : right; } .nocuetime time { display : none; } aside a, h6, .cue time , aside.ticker * { font-size : var(--cpu-font-small-size); } .mode-compact { width : calc(var(--cpu-elapse-width) + var(--cpu-height) * 2 + 32px); } .mode-button { width : var(--cpu-height); } .mode-compact #title, .mode-compact #line, .mode-compact #actions, .mode-compact aside, .mode-compact .panel, .mode-button #poster, .mode-button #about, .mode-button #actions, .mode-button aside, .mode-button .panel { width : 0; display : none; } .mode-hidden, .hide-chapters .chapters, .hide-timeline #line, .hide-panels .panel, .hide-panels-title h6, .hide-panels-except-play .panel, .media-streamed #link, .media-streamed #line { display : none; } .hide-panels-except-play.last-used .panel { display : flex; } .mode-compact.show-main #pagemain { flex : 0 0 auto; } @media (max-width: 640px) { .nosmall { display : none !important; } #elapse { max-height : 16px; } #interface { --cpu-timeline-height : 8px ; } #handheld-nav { padding-bottom: 4px; } aside.ticker { top: 22px; } } @media (max-width: 480px) { .nosmaller { display : none !important; } .mode-default #elapse { flex : 0 1 var(--cpu-elapse-width); } .mode-default #pagemain { padding-bottom : 16px; } #titleline { height : 32px; } #line { position: absolute; left: calc(0px - var(--cpu-height)); right: calc(0px - var(--cpu-height)); height: 16px; top: 32px; } aside a { pointer-events: none; } aside.borders { top : -2px; } aside.chapters { top : 8px; } #handheld-nav { padding-bottom: 2px; } } @media (max-width: 320px) { .nosmallest, .mode-default #elapse { display : none !important; } } @media print { #interface { display : none; } } a:hover, a:focus, button:hover, button:focus, #pageshare div:hover , .active-cue, .with-preview { background: var(--cpu-focus-background, var(--cpu-color)) !important; color : var(--cpu-focus-color, var(--cpu-background)) !important; }</style><div id="interface" class="show-no" tabindex="0"> <main> <img id="poster" class="nosmall" src="" alt="" loading="lazy" decoding="async" /> <section id="pageerror" role="alert"> </section> <section id="pagemain"> <button type="button" id="control" tabindex="0"> <svg id="loading" aria-label="${x.loading}" viewBox="0 0 32 32" aria-hidden="true"> <circle cx="6" cy="22" r="4" /> <circle cx="16" cy="22" r="4" /> <circle cx="26" cy="22" r="4" /> <title>${x.loading}</title> </svg> <svg id="play" aria-label="${x.pause}" viewBox="0 0 32 32" aria-hidden="true"> <title>${x.pause}</title> <path d="M 6,6 12.667,6 12.667,26 6,26 z" /> <path d="M 19.333,6 26,6 26,26 19.333,26 z" /> </svg> <svg id="pause" aria-label="${x.play}" viewBox="0 0 32 32" aria-hidden="true"> <title>${x.play}</title> <path d="M 6,6 6,26 26,16 z" /> </svg> </button> <div id="about"> <div id="titleline"> <h5 id="title"><a href="#" id="canonical" aria-label="${x.canonical}"></a></h5> <a id="elapse" aria-label="${x.moment}" tabindex="-1">…</a> </div> <div id="handheld-nav"> <button type="button" id="restart"> <svg viewBox="0 0 24 16" aria-hidden="true"> <polygon points="4,0 8,0 8,16 4,16"/> <path d="M 16,0 8,8 16,16 z" /> <path d="M 24,0 16,8 24,16 z" /> </svg> </button> <button type="button" id="fastreward"> <svg viewBox="0 0 24 16" aria-hidden="true"> <path d="M 8,0 0,8 8,16 z" /> <path d="M 16,0 8,8 16,16 z" /> <path d="M 24,0 16,8 24,16 z" /> </svg> </button> <button type="button" id="reward" class="nosmallest"> <svg viewBox="0 0 24 16" aria-hidden="true"> <path d="M 12,0 4,8 12,16 z" /> <path d="M 20,0 12,8 20,16 z" /> </svg> </button> <button type="button" id="foward"> <svg viewBox="0 0 24 16" aria-hidden="true"> <path d="M 4,0 12,8 4,16 z" /> <path d="M 12,0 20,8 12,16 z" /> </svg> </button> <button type="button" id="fastfoward"> <svg viewBox="0 0 24 16" aria-hidden="true"> <path d="M 0,0 8,8 0,16 z" /> <path d="M 8,0 16,8 8,16 z" /> <path d="M 16,0 24,8 16,16 z" /> </svg> </button> </div> <div id="line"> <div id="time"> <div id="loadingline" role="progressbar"></div> <time id="popup">--:--</time> </div> </div> \x3c!-- div id="infoline" class="nosmallest"></div --\x3e </div> <button id="actions" aria-label="${x.more}" title="${x.more}"> <svg viewBox="0 0 32 32" aria-hidden="true"> <circle cx="7" cy="16" r="3" /> <circle cx="16" cy="16" r="3" /> <circle cx="25" cy="16" r="3" /> </svg> </button> </section> <section id="pageshare"> <a href="#" target="social" id="nativeshare" aria-label="${x.share}" title="${x.share}"> <svg viewBox="0 0 32 32" aria-hidden="true"> <path d="M 21 0 C 18.2 0 16 2.2 16 5 C 16 5.1 16 5.2 16.0 5.2 L 8.2 9.2 C 7.3 8.4 6.2 8 5 8 C 2.2 8 0 10.2 0 13 C 0 15.8 2.2 18 5 18 C 6.2 18 7.3 17.5 8.2 16.8 L 16 20.8 C 16.0 20.8 16 20.9 16 21 C 16 23.8 18.2 26 21 26 C 23.8 26 26 23.8 26 21 C 26 18.2 23.8 16 21 16 C 19.8 16 18.7 16.4 17.8 17.2 L 10 13.3 C 10 13.2 10 13.1 10 13 C 10 12.9 10 12.8 10 12.8 L 17.8 8.8 C 18.7 9.6 19.8 10 21 10 C 23.8 10 26 7.8 26 5 C 26 2.2 23.8 0 21 0 Z"></path> </svg> <span class="nosmall">${x.share}</span> </a> <a href="#" target="social" id="twitter" class="nonativeshare" aria-label="${x.twitter}" title="${x.twitter}"> <svg viewBox="0 0 32 32" aria-hidden="true"> <path d="M 25.9,9.9 C 25.2,10.2 24.4,10.4 23.6,10.5 24.5,10 25.1,9.2 25.4,8.2 24.6,8.8 23.8,9.1 22.9,9.3 22.1,8.5 21.1,8 19.9,8 c -2.2,0 -4,1.8 -4,4 0,0 0,0.6 0.1,0.9 -3.3,-0.2 -6.3,-1.8 -8.3,-4.2 -0.3,0.6 -0.5,1.3 -0.5,2 0,1.4 0.7,2.6 1.8,3.4 -0.7,0 -1.3,-0.2 -1.8,-0.5 0,0 0,0 0,0.1 0,2 1.4,3.6 3.2,4 -0.3,0.1 -0.7,0.1 -1.1,0.1 -0.3,0 -0.5,0 -0.8,-0.1 0.5,1.6 2,2.8 3.7,2.8 -1.4,1.1 -3.1,1.7 -5,1.7 -0.3,0 -0.6,0 -1,-0.1 1.8,1.1 3.9,1.8 6.1,1.8 7.4,0 11.4,-6.1 11.4,-11.4 0,-0.2 0,-0.3 0,-0.5 0.8,-0.6 1.4,-1.3 2,-2.1 z" /> </svg> <span class="nosmall">${x.twitter}</span> </a> <a href="#" target="social" id="facebook" class="nonativeshare" aria-label="${x.facebook}" title="${x.facebook}"> <svg viewBox="0 0 32 32" aria-hidden="true"> <path d="m 21.1,16 -3.7,0 0,10 -4.3,0 0,-10 -2.1,0 0,-3.3 2.1,0 0,-2.1 c 0,-2.9 1.2,-4.6 4.7,-4.6 l 3.9,0 0,3.5 -3.2,0 c -1,0 -1.1,0.5 -1.1,1.4 l -0,1.8 4.3,0 -0.6,3.3 0,0 z" /> </svg> <span class="nosmall">${x.facebook}</span> </a> <a href="#" target="social" id="email" class="nonativeshare" aria-label="${x.e_mail}" title="${x.e_mail}"> <svg viewBox="0 0 32 32" aria-hidden="true"> <path d="m 8,9 15.9,0 c 0.3,0 0.6,0.1 0.8,0.2 l -8.8,9 -8.8,-9 c 0.3,-0.1 0.5,-0.2 0.8,-0.2 z m -2,12.3 0,-10.5 c 0,0 0,-0.1 0,-0.1 l 5.8,6 -5.8,5.1 c 0,-0.1 -0.1,-0.3 -0.1,-0.4 z m 17.9,1.8 -15.9,0 c -0.2,0 -0.3,0 -0.5,-0.1 l 5.7,-5 2.8,2.9 2.8,-2.9 5.7,5 c -0.2,0 -0.3,0.1 -0.5,0.1 z m 2,-1.8 c 0,0.2 0,0.3 -0.1,0.5 l -5.8,-5.1 5.8,-6 c 0,0 0,0.1 0,0.1 z" /> </svg> <span class="nosmall">${x.e_mail}</span> </a> <a href="#" target="social" download="" id="link" aria-label="${x.download}" title="${x.download}"> <svg viewBox="0 0 32 32" aria-hidden="true"> <path d="M 6,6 26,6 16,26 z" /> <rect x="6" y="22" width="20" height="4" /> </svg> <span class="nosmall">${x.download}</span> </a> <a id="back" aria-label="${x.back}" title="${x.back}"> <svg viewBox="0 0 32 32" aria-hidden="true"> <path d="M 9,8 24,23 23,24 8,9 z" /> <path d="M 9,24 24,9 23,8 8,23 z" /> </svg> <span class="nosmall">${x.back}</span> </a> </section> </main> <nav id="playlist" class="panel"> </nav> </div> `,document.head.appendChild(t)}(),p()?(window.customElements.define(e.toLowerCase(),$),window.customElements.define(t.toLowerCase(),T),document.body.classList.add("cpu-audio-with-webcomponents")):(b("WebComponent may NOT behave correctly on this browser. Only timecode hash links are activated.\nSee https://github.com/dascritch/cpu-audio/ for details"),u(i,document.CPU.attach_events_audiotag),document.body.classList.add("cpu-audio-without-webcomponents")),window.addEventListener("hashchange",w.hashOrder,s),w.hashOrder({at_start:!0})}HTMLAudioElement.prototype.CPU_connected=!1,HTMLAudioElement.prototype.CPU_controller=function(){return this.closest(e)},HTMLAudioElement.prototype.CPU_update=function(){let e=this.CPU_controller();if(e){let t=e.CPU;t&&t.update&&t.update()}null!==document.CPU.global_controller&&document.CPU.global_controller.update()},document.CPU||window.customElements.get(e.toLowerCase())?b("cpu-audio is called twice"):(HTMLDocument.prototype.CPU=C,null!==document.body?S():document.addEventListener("DOMContentLoaded",S,s))})();