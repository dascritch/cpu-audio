(()=>{"use strict";
/** @license
Cpu-Audio: an extension to the hash system to address timecode into audio/video elements and a player WebComponent
Version 7.0.3
Copyright (C) 2014-2021 Xavier "dascritch" Mouton-Dubosc & contributors.
License LGPL 3

- project mini-site https://dascritch.github.io/cpu-audio/
- project repository : https://github.com/dascritch/cpu-audio
- use case : http://cpu.pm
- blog post : https://dascritch.net/post/2018/11/06/Reconstruire-son-lecteur-audio-pour-le-web
**/
const e="CPU-AUDIO",t="CPU-CONTROLLER",n="audio[controls]",a=`${e} audio`,o={passive:!0},i={passive:!0,once:!0};function r(e,t,n=document){Array.from(n.querySelectorAll(e)).forEach(t)}function s(e,t,n){if(!e?.indexOf)return null;const a=e.indexOf(t);return-1===a?null:e[a+n]}function l(){return void 0!==window.customElements}function d(e){let t=document.createElement("a");return t.href="string"!=typeof e?e:e.split("#")[0],t.href}function c(){return!window.matchMedia("screen").matches}function u(e){d(window.location.href)===d(e.target.href)&&e.preventDefault()}function p(e){let t=document.createElement("p");t.innerText=e;const{innerHTML:n}=t;return t.remove(),n}function h(n){if([e,t].includes(n.tagName))return n.CPU;let a=n.closest(e)??n.closest(t);return a?a.CPU:n.getRootNode().host.CPU}function m(t){window.console.warn(`${e}: `,t)}const g={fr:{loading:"Chargement en cours…",pause:"Pause",play:"Lecture",canonical:"Lien vers la fiche du sonore",moment:"Lien vers ce moment",untitled:"(sans titre)",cover:"pochette",more:"Actions",share:"Partager",twitter:"Partager sur Twitter",facebook:"Partager sur Facebook",e_mail:"Partager par e-mail",download:"Télécharger",back:"Annuler",chapters:"Chapitres",playlist:"Playlist",media_err_aborted:"Vous avez annulé la lecture.",media_err_network:"Une erreur réseau a causé l'interruption du téléchargement.",media_err_decode:"La lecture du sonore a été annulée suite à des problèmes de corruption ou de fonctionnalités non supportés par votre navigateur.",media_err_src_not_supported:"Le sonore n'a pu être chargé, soit à cause de sourcis sur le serveur, le réseau ou parce que le format n'est pas supporté.",media_err_unknow:"Erreur due à une raison inconnue."},en:{loading:"Loading…",pause:"Pause",play:"Play",canonical:"Link to the sound's page",moment:"Link to this time",untitled:"(untitled)",cover:"cover",more:"Actions",share:"Share",twitter:"Share on Twitter",facebook:"Share on Facebook",e_mail:"Share via e-mail",download:"Download",back:"Back",chapters:"Chapters",playlist:"Playlist",media_err_aborted:"You have aborted the play.",media_err_network:"A network error broke the download.",media_err_decode:"Play was canceled due to file corruption or a not supported function in your browser.",media_err_src_not_supported:"The media cannot be downloaded due to server problems, network problems or unsupported by your browser.",media_err_unknow:"Error of unknown cause."}};let f=function(){const e=document.querySelector("html").lang;if(e.length&&e.toLowerCase()in g)return e;const t=window.navigator.languages??[navigator.language||navigator.browserLanguage];for(const e of t)if(e.split){const[t]=e.split("-");if(t in g)return t}return"en"}();const v=g[f];const b=document.head,y={get title(){for(const e of['property="og:title"','name="twitter:title"']){const t=b.querySelector(`meta[${e}]`);if(t)return t.content}const e=document.title;return""===e?null:e},get poster(){for(const e of['property="og:image"','name="twitter:image:src"']){const t=b.querySelector(`meta[${e}]`);if(t)return t.content}return null},get canonical(){const e=b.querySelector('link[rel="canonical"]');return e?e.href:location.href.split("#")[0]},get twitter(){const e=b.querySelector('meta[name="twitter:creator"]');return e&&e.content.length>1?e.content:null},playlist:null,waveform:null,duration:null,download:null},w={d:86400,h:3600,m:60,s:1};let P=[1,60,3600,86400];const C=/^\d+$/,k=/\D*/g,_=function(e){let t=0;return""!==e&&(t=C.test(e)?Number(e):e.includes(":")?L.colontimeInSeconds(e):L.subunittimeInSeconds(e)),t},x=function(e){if(e===1/0)return"?";let t="",n=!1;for(let a in w)if(w.hasOwnProperty(a)){let o=w[a];if(e>=o||n){n=!0;let i=Math.floor(e/o);t+=i+a,e-=i*o}}return""===t?"0s":t},T=function(e){if(e===1/0)return"?";let t="",n=!1;for(let a in w)if(w.hasOwnProperty(a)){let o=w[a];if(e>=o||n){n=!0;let a=Math.floor(e/o);t+=""===t?"":":",t+=(a<10&&""!==t?"0":"")+a,e-=a*o}}return 1===t.length?`0:0${t}`:2===t.length?`0:${t}`:""===t?"0:00":t},E=function(e){return`P${L.secondsInTime(e).toUpperCase()}`},L={timeInSeconds:_,subunittimeInSeconds:function(e){let t,n=0;for(let a in w)w.hasOwnProperty(a)&&e.includes(a)&&([t,e]=e.split(a),n+=Number(t.replace(k,""))*w[a]);return n},colontimeInSeconds:function(e){let t=0,n=e.split(":");for(let e=0;e<n.length;e++)t+=Number(n[e])*P[n.length-1-e];return t},secondsInTime:x,secondsInColonTime:T,secondsInPaddledColonTime:function(e){if(e===1/0)return"?";let t=L.secondsInColonTime(e);return"00:00:00".substr(0,8-t.length)+t},durationIso:E},U={i:"i",em:"i",b:"b",bold:"strong",u:"u",lang:"i"},A={i:"i",em:"i",b:"b",strong:"b",u:"u"};let I=U;const $=/<(\w+)(\.[^>]+)?( [^>]+)?>/gi,N=/<\/(\w+)( [^>]*)?>/gi,S=/\n/gi,M=/<br\s*[^>]*>/gi;function O(e){return!(e in I)}function D(e,t,n,a){if(O(t=t.toLowerCase()))return"";let o="";return"lang"==t&&(o=` lang="${a.trim()}"`),`<${I[t]}${o}>`}function z(e,t){return O(t=t.toLowerCase())?"":`</${I[t]}>`}function H(e,t=!0){if(I=t?U:A,e.split("<").length!==e.split(">").length)return p(e);const n=e.replace($,D).replace(N,z);return t?n.replace(S,"<br/>"):n.replace(M,"\n")}const q="_playlist";function R({id:e}){const t=document.CPU.playlists,n=document.CPU.currentPlaylistID();let a=!1;for(let o in t){const i=t[o].length,r=t[o].filter((t=>t!==e&&document.getElementById(t)));i!==r.length&&o===n&&(a=!0),document.CPU.playlists[o]=r,0===r.length&&delete document.CPU.playlists[o]}a&&B()}function j(){const e=document.CPU.globalController;if(!e)return;const t=e.current_playlist,n={};if(e.clearPlane(q),0!==e.current_playlist.length){for(let e of t)n[e]={text:document.getElementById(e)?.dataset.title,link:`#${e}&t=0`};e.bulkPoints(q,n),e.element.shadowRoot.querySelector("main").insertAdjacentElement("afterend",e.planePanel(q))}else e.removePlane(q)}function B(e){const t=document.CPU.globalController;if(!t||!t.isController)return;let n=t.current_playlist;if(t.current_playlist=document.CPU.currentPlaylist(),t.plane(q)||t.addPlane(q,{title:v.playlist,track:!1,panel:"nocuetime",highlight:!0,_comp:!0}),n!==t.current_playlist&&j(),t.highlightPoint(q,t.audiotag.id,ye),e){const{planeName:n,pointName:a}=ke(e);t.focusPoint(n,a)}}function F(e){let t=e.target;if(null!==document.CPU.currentAudiotagPlaying||K(t))return;let n=Number(window.localStorage.getItem(t.currentSrc));n>0&&!ae&&(document.CPU.seekElementAt(t,n),oe.play(null,t))}HTMLAudioElement.prototype._CPU_played=null,HTMLAudioElement.prototype._CPU_planes=null;let V=0;function K(e){return null==e||e.duration===1/0||null!=e.dataset.streamed}function W(e){return e===1/0||null===e||isNaN(e)}function G(e){return 0===e||W(e)}function X({duration:e,dataset:t}){let n=null;const a=Number(e);if(G(a)){const e=Number(t.duration);G(e)||(n=e)}else n=a;return n}function J(e,t){if(W(t))return null;t=t<0?0:t;const n=X(e);return G(n)||(t=t<n?t:n),t}function Y(e,t=null,n=null){e&&(e.readyState>e.HAVE_NOTHING?t?.(n):(t&&e.addEventListener("loadedmetadata",(()=>{t?.(n)}),i),e.load()))}function Q(e){e.addEventListener("loadedmetadata",F,i),e.addEventListener("play",oe.playOnce,o),e.addEventListener("ended",oe.nexttrack,o),e.addEventListener("ready",F,o),e.addEventListener("canplay",F,o);for(let t of["ready","load","loadeddata","canplay","abort","error","emptied","play","playing","pause","ended","durationchange","loadedmetadata","timeupdate","waiting"])e.addEventListener(t,oe.update,o);if(!l())for(let t of["pause","ended"])e.addEventListener(t,oe.pause,o);""===e.getAttribute("preload")&&Y(e)}function Z(e){null==e._CPU_played&&(e._CPU_played=!1,Q(e),e.hidden=!0,e.removeAttribute("controls"),function(e){if("string"==typeof e.dataset.playlist){const t=e.dataset.playlist;t in document.CPU.playlists||(document.CPU.playlists[t]=[]),document.CPU.playlists[t].push(e.id),document.CPU.globalController&&t===document.CPU.currentPlaylistID()&&B()}}(e))}let ee=null,te=0,ne=!1,ae=!1;const oe={_end:()=>ne,update:function({target:e}){!1!==ne&&e.currentTime>ne&&oe.pause(void 0,e),function(e){h(e)?.update(),document.CPU.globalController?.update()}(e),e.paused||K(e)||window.localStorage.setItem(e.currentSrc,String(e.currentTime))},hashOrder:async function(e,t=null){let n=!0;"string"!=typeof e&&(n="at_start"in e,e=location.hash.substr(1));let a=null,o="",i=!1;for(const t of e.split("&"))if(t.includes("=")){const[e,n]=t.split("=");switch(e.toLowerCase()){case"t":o=n||"0",i=!0;break;case"autoplay":i="1"===n;break;case"auto_play":i="true"===n.toLowerCase()}}else a=a??t;if(""===o||n&&!i)return void t?.();const[r,s]=o.split(",");te=_(r),ne=void 0!==s&&_(s),!1!==ne&&(ne=ne>te&&ne),document.CPU.scrollTo&&(a?.length>0?document.querySelector(`#${a}`):document.CPU.currentAudiotagPlaying)?.closest("cpu-audio, cpu-controller").scrollIntoView(),await document.CPU.jumpIdAt(a??"",r,t),B()},hover:function(e){const{target:t,clientX:n,targetTouches:a}=e;if(!t)return;const o=h(t),i=o.audiotag,r=X(i);if(G(r))return void(K(i)||Y(i,oe.hover,e));const{x:s,width:l}=o.shadowId("time").getBoundingClientRect(),d=((n??a?.[0]?.clientX)-s)/l;o.showThrobberAt(J(i,d*r))},out:function({target:e}){h(e).hideThrobber()},throbble:function(e){const{target:t,offsetX:n,at:a}=e,o=document.CPU,i=h(t),r=i.audiotag;if(a>=0)return void o.seekElementAt(r,a);const s=n/t.clientWidth,l=X(r);o.currentAudiotagPlaying&&!o.isAudiotagPlaying(r)&&oe.pause(null,o.currentAudiotagPlaying),oe.play(e,r),G(l)?i.updateLoading(void 0,100):o.seekElementAt(r,s*l)},pause:function(e=null,t=null){if(!t){const{target:n}=e;t="AUDIO"==n.tagName?n:h(n).audiotag}t.pause(),document.CPU.currentAudiotagPlaying=null,window.localStorage.removeItem(t.currentSrc)},playOnce:function({target:e}){let t=document.CPU;document.CPU.lastUsed=e,t.playStopOthers&&t.currentAudiotagPlaying&&!t.isAudiotagPlaying(e)&&oe.pause(void 0,t.currentAudiotagPlaying),t.currentAudiotagPlaying=e},play:function(e=null,t=null){if(!e&&ae)return void m("play() prevented because already waiting for focus");var n;t=t??h(e.target).audiotag,ae=!1,((n=t.currentTime)<te||!1!==ne&&n>ne)&&(te=0,ne=!1);let a=t.play();a&&a.then((()=>{document.CPU.hadPlayed=!0})).catch((n=>{ae=!0;const a=()=>{!function(e,t){ae=!1,document.CPU.autoplay&&oe.play(e,t)}(e,t)};switch(n.name){case"NotAllowedError":if(m("Auto-play prevented : Browser requires a manual interaction first."),document.addEventListener("focus",a,i),document.addEventListener("click",a,i),null!=t._CPU_played){let e=h(t);e.glowBeforePlay=!0,e.setAct("glow")}break;case"NotSupportedError":n("The browser refuses the audio source, probably due to audio format.")}})),Ae(t)},toggleplay:function({target:e}){const{audiotag:t}=h(e);t.paused?oe.play(null,t):oe.pause(null,t)},key:function(e,t=1){if(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;const n=h(e.target),{audiotag:a}=n;function o(t){e.at=J(a,a.currentTime+t),n.showThrobberAt(e.at),oe.throbble(e),n.hideThrobberLater()}switch(e.keyCode){case 13:if("control"!==n.focused()?.id.toLowerCase())return;oe.toggleplay(e);break;case 27:oe.restart(e),oe.pause(null,a);break;case 32:oe.toggleplay(e);break;case 35:document.CPU.seekElementAt(a,a.duration);break;case 36:oe.restart(e);break;case 37:o(-document.CPU.keymove*t);break;case 39:o(+document.CPU.keymove*t);break;case 38:n.prevFocus();break;case 40:n.nextFocus();break;default:return}e.preventDefault?.()},restart:function({target:e}){const t=h(e);document.CPU.seekElementAt(t.audiotag,0)},reward:function(e){e.keyCode=37,oe.key(e)},foward:function(e){e.keyCode=39,oe.key(e)},fastreward:function(e){e.keyCode=37,oe.key(e,document.CPU.fastFactor)},fastfoward:function(e){e.keyCode=39,oe.key(e,document.CPU.fastFactor)},prevcue:function({target:e}){ie(h(e),-1)},nextcue:function({target:e}){ie(h(e),1)},cuechange:function(e,t){const{classList:n}=document.body;n.remove(ee),ee=`cpu_playing_tag_«${t.id}»_cue_«${e.id}»`,n.add(ee)},prevtrack:function({target:e},t=null){re(t??h(e).audiotag,-1)},nexttrack:function({target:e},t=null){re(t??h(e).audiotag,1)}};function ie(e,t){const n=e.audiotag,a=e.planePoints("_chapters");if(!a)return;const{pointName:o}=ke(ee);let i=s(a,o,t),r=Object.values(a);t<0&&(r=r.reverse());const{currentTime:l}=n;if(!i)for(let e of r)!i&&(t<0&&e.end<=l||t>0&&e.start>=l)&&(i=e);i&&document.CPU.jumpIdAt(n.id,i.start)}function re(e,t){const{id:n}=e,a=e.dataset.playlist;if(!a)return;const o=document.CPU.playlists[a];if(!o)return void m(`Named playlist ${a} not created. WTF ?`);const i=o.indexOf(n);if(i<0)return void m(`Audiotag ${n} not in playlist ${a}. WTF ?`);const r=o[i+t];if(!r)return;const s=document.getElementById(r);s?(document.CPU.seekElementAt(s,0),oe.play(null,s)):m(`Audiotag #${r} doesn't exists. WTF ?`)}let se=null;const le=["fastreward","reward","foward","fastfoward"],de={press:function(e){const t=e.target.id?e.target:e.target.closest("button");t.id&&le.includes(t.id)&&(oe[t.id](e),se&&window.clearTimeout(se),se=window.setTimeout(de.repeat,document.CPU.repeatDelay,e),e.preventDefault())},repeat:function(e){oe[e.target.id](e),se=window.setTimeout(de.repeat,document.CPU.repeatFactor,e),e.preventDefault?.()},release:function(e){window.clearTimeout(se),se=null,e.preventDefault()}},ce={ev:null,down:function({target:e}){ce.ev=setTimeout(ce.do,document.CPU.alternateDelay,h(e))},do:function(e){e.showHandheldNav(),ce.ev=null},up:function(){clearTimeout(ce.ev),ce.ev=null}},ue="_chapters";function pe(e){if(!e)return null;let t=null;if(e.textTracks?.length>0)for(const n of e.textTracks)"chapters"!==n.kind.toLowerCase()||!n.cues||t&&n.language.toLowerCase()!==f||(t=n);return t}async function he(e){if(e.isController)return;const t=e.audiotag;let n=!1;const a={};if(t){const i=pe(t);if(i?.cues.length>0){e.addPlane(ue,{title:v.chapters,track:"chapters"});const r=()=>{me(e)};i.removeEventListener("cuechange",r),i.addEventListener("cuechange",r,o);for(const n of i.cues)e.point(ue,n.id)||(a[n.id]={start:J(t,Math.floor(n.startTime)),text:H(n.text),link:!0,end:J(t,Math.floor(n.endTime))});i.cues.length>0&&(n=!0),e.bulkPoints(ue,a),me(e,{target:{activeCues:i.cues}})}}const i=`cpu_tag_«${t.id}»_chaptered`,r=document.body.classList;n?r.add(i):(e.removePlane(ue),r.remove(i))}function me(e,t=null){const n=t?t.target.activeCues:pe(e.audiotag)?.activeCues;let a,o=e.audiotag.currentTime;if(n?.length>0)for(let e of n)e.startTime<=o&&o<e.endTime&&(a=e);a?.id!==e._activecue_id&&(e.removeHighlightsPoints(ue,ye),e._activecue_id=a?.id,a&&(oe.cuechange(a,e.audiotag),e.emitEvent("chapterChanged",{cue:a}),e.highlightPoint(ue,a.id,ye)))}function ge(e){const{title:t,canonical:n}=h(e.target).audiotagDataset();navigator.share({title:t,text:t,url:n}),e.preventDefault()}function fe(e){e.container.addEventListener("focus",(t=>{(e.shadowId("control")??e.shadowId("toggleplay"))?.focus(),t.preventDefault()}));const{classList:t}=e.container;e.shadowId("poster")?.addEventListener("load",(()=>{t.add("poster-loaded")}),o);const n={pause:oe.pause,play:oe.play,time:oe.throbble,actions:()=>{e.showActions()},back:t=>{e.showMain(),t.preventDefault()},poster:()=>{e.showMain()},restart:oe.restart,toggleplay:oe.toggleplay,prevcue:oe.prevcue,nextcue:oe.nextcue,prevtrack:oe.prevtrack,nexttrack:oe.nexttrack};for(const[t,a]of Object.entries(n)){const n=e.shadowId(t);n?.addEventListener("click",a,"A"===n.tagName?{}:o)}for(const t of le){const n=e.shadowId(t);n?.addEventListener("pointerdown",de.press),n?.addEventListener("pointerout",de.release),n?.addEventListener("pointerup",de.release)}e.element.addEventListener("keydown",oe.key);const a=e.shadowId("time");a?.addEventListener("pointerenter",oe.hover,o),a?.addEventListener("pointermove",oe.hover,o),a?.addEventListener("pointerout",oe.out,o),a?.addEventListener("pointerdown",ce.down,o),a?.addEventListener("pointerup",ce.up,o),navigator.share&&(t.add("hasnativeshare"),e.shadowId("nativeshare")?.addEventListener("click",ge,o));const r=e.shadowId("canonical");r&&r.addEventListener("click",u),e.audiotag&&(e.container.addEventListener("pointerenter",(()=>{Y(e.audiotag)}),i),e.audiotag.addEventListener("durationchange",(()=>{e.repositionTracks()}),o),function(e){const t=()=>{he(e)};t();let n=e.audiotag;n.addEventListener("loadedmetadata",t,i);let a=n.querySelector('track[kind="chapters"]');a&&!a._CPU_load_ev&&(a._CPU_load_ev=a.addEventListener("load",t,o))}(e),B(),e.showMain(),e.updatePlayButton(),e.emitEvent("ready"),e.updateLinks())}const ve=["poster","actions","timeline","chapters","panels","panels-title","panels-except-play"],be="with-preview",ye="active-cue",we="_borders",Pe=/^[\w-]+$/,Ce=/^[\w-]+_«([\w-]+)(»_.*_«([\w-]+))?»$/;function ke(e){let t,n;return"string"==typeof e&&([,t,,n]=e?.match(Ce)||[]),{planeName:t??"",pointName:n??""}}function _e({target:e}){if(e.id||(e=e.closest("[id]")),!e)return;const{planeName:t,pointName:n}=ke(e.id);h(e).highlightPoint(t,n)}function xe(e,t,n){return`${n?"panel":"track"}_«${e}»_point_«${t}»`}function Te({classList:e},t){t?e.remove("no"):e.add("no")}function Ee({start:e,end:t}){return(null==e||e>=0)&&(null==t||t>=e)}class Le{constructor(e){this.element=e,this.shadow=e.shadowRoot,this.audiotag=e.audiotag,this.container=this.shadowId("interface"),this.mode_when_play=null,this.glowBeforePlay=!!e.hasAttribute("glow"),this.current_playlist=[],this._activecue_id=null,this.mode_was=null,this.act_was=null,this.isController=!1,e.CPU=this,this.audiotag&&!this.audiotag._CPU_planes&&(this.audiotag._CPU_planes={}),this._planes={};const t=document.CPU.globalController;this.audiotag&&t&&!t.audiotag&&Ae(this.audiotag),this.audiotag||(this.isController=!0,this.container.classList.add("controller"),document.CPU.globalController=this,this.audiotag=document.querySelector(a),Y(this.audiotag)),fe(this),this.attachAudiotagToInterface(this.audiotag),this.attributesChanges()}attributesChanges(){let e=null;if(this.element.hasAttribute("mode")){e=this.element.getAttribute("mode");const[t,n]=e.split(",");n&&(e=this.audiotag.paused?t:n,this.mode_when_play=n)}this.setMode(e),this.element.hasAttribute("hide")&&this.setHide(this.element.getAttribute("hide").split(" "))}mirroredInController(){const e=document.CPU.globalController;return e&&this.audiotag.isEqualNode(e.audiotag)}translateVTT(e,t){return H(e,t)}planeAndPointNamesFromId(e){return ke(e)}async emitEvent(e,t){this.element.dispatchEvent(new CustomEvent(`CPU_${e}`,{target:this.element,bubbles:!0,cancelable:!1,composed:!1,detail:t}))}shadowId(e){return this.shadow.getElementById(e)}setMode(e=null){if(e=e??"default",this.mode_was===e)return;const t=this.container.classList;t.remove(`mode-${this.mode_was}`),t.add(`mode-${e}`),this.mode_was=e}setAct(e){if(this.act_was===e)return;if(!document.CPU.hadPlayed&&"loading"===e){if(null!==this.act_was)return;e="glow"}const t=this.container.classList;t.remove("act-loading","act-buffer","act-pause","act-play","act-glow"),t.add(`act-${e}`),"play"===this.act_was&&"loading"===e&&t.add("act-buffer"),this.act_was=e}setHide(e){const t=this.container.classList;for(let e of ve)t.remove(`hide-${e}`);for(let n of e)n=n.toLowerCase(),ve.includes(n)&&t.add(`hide-${n}`)}updatePlayButton(){const e=this.audiotag,t=e.getAttribute("preload"),n=this.shadowId("control"),a="aria-label";let o=!t||"none"!==t.toLowerCase();if(e.readyState<e.HAVE_CURRENT_DATA&&(o||e._CPU_played))return this.setAct("loading"),void n.setAttribute(a,v.loading);let i="pause",r="play";e.paused&&(i="play",r="pause",!e._CPU_played&&this.glowBeforePlay&&(r="glow")),this.setAct(r),n.setAttribute(a,v[i]);const s="last-used",l=this.container.classList;e.paused?this.audiotag.isEqualNode(document.CPU.lastUsed)||l.remove(s):(e._CPU_played=!0,l.add(s),this.mode_when_play&&(this.setMode(this.mode_when_play),this.mode_when_play=null))}updateLine(e,t=null){const n=this.shadowId("loadingline");if(!n)return;const{duration:a}=this.audiotag;t=t??(0===a?0:100*e/a),n.style.width=`${t}%`}updateTime(){const e=this.audiotag,t=K(e)?0:Math.floor(e.currentTime),n=e.dataset.canonical??"",a=n.indexOf("#"),o=this.shadowId("elapse");o&&(o.href=`${d(n)}#${a<0?e.id:n.substr(a+1)}&t=${t}`);this.shadowId("currenttime")&&(this.shadowId("currenttime").innerText=T(e.currentTime));const i=this.shadowId("totaltime");if(i){const t=X(e);i.innerText=G(t)?"":` / ${T(t)}`,Te(i,t)}this.updateLine(e.currentTime)}updateTimeBorders(){const e=this.audiotag;if(document.CPU.isAudiotagGlobal(e)&&!1!==ne){if(this.plane(we)){const e=this.point(we,we);if(e&&e.start===te&&e.end===ne)return}this.addPlane(we,{track:"borders",panel:!1,highlight:!1}),this.addPoint(we,we,{start:te,link:!1,end:ne})}else this.removePlane(we)}updateLoading(e,t){this.updateLine(e,t),this.setAct("loading")}updateError(){const e=this.audiotag;if(!e)return!0;const t=e.error;if(t){let e;this.show("error");const n=MediaError;switch(t.code){case n.MEDIA_ERR_ABORTED:e=v.media_err_aborted;break;case n.MEDIA_ERR_NETWORK:e=v.media_err_network;break;case n.MEDIA_ERR_DECODE:e=v.media_err_decode;break;case n.MEDIA_ERR_SRC_NOT_SUPPORTED:e=v.media_err_src_not_supported;break;default:e=v.media_err_unknow}const a=this.shadowId("pageerror");return a&&(a.innerText=e),!0}return!1}update(){this.updateError()||(this.updatePlayButton(),this.updateTime(),this.updateTimeBorders())}positionTimeElement(e,t=null,n=null){const{duration:a}=this.audiotag;if(G(a))return;const o=e=>null!=e&&!1!==e;o(t)&&(e.style.left=t/a*100+"%"),o(n)&&(e.style.right=100*(1-n/a)+"%")}async showThrobberAt(e){const t=this.audiotag;if(t.duration<1)return;isNaN(t.duration)&&!K(t)&&(t.setAttribute("preload","metadata"),Y(t,oe.hover,event));const n=this.shadowId("popup");this.positionTimeElement(n,e),n.style.opacity=1,n.innerHTML=T(e),n.dateTime=x(e).toUpperCase()}hideThrobber(){this.shadowId("popup").style.opacity=0}hideThrobberLater(){const e=this.shadowId("popup");e._hider&&window.clearTimeout(e._hider),e._hider=window.setTimeout((()=>{this.hideThrobber()}),1e3)}audiotagDataset(){return{...y,...this.audiotag.dataset}}updateLinks(){const e=this.audiotag,t=this.audiotagDataset(),n=d(t.canonical??""),a=0===e.currentTime?"":`&t=${Math.floor(e.currentTime)}`,o=n===d(window.location.href)?e.id:"",i=encodeURIComponent(`${n}#${o}${a}`),r="@"!==t.twitter?.[0]?"":`&via=${t.twitter.substring(1)}`,s=e.querySelector("source[data-downloadable]")?.src||t.download||e.currentSrc,l=t.title,c={twitter:`https://twitter.com/share?text=${l}&url=${i}${r}`,facebook:`https://www.facebook.com/sharer.php?t=${l}&u=${i}`,email:`mailto:?subject=${l}&body=${i}`,link:s};for(let e in c){const t=this.shadowId(e);t&&(t.href=c[e])}}show(e){const{classList:t}=this.container;t.remove("show-main","show-share","show-error","media-streamed"),K(this.audiotag)&&t.add("media-streamed"),t.add(`show-${e}`)}showActions(){this.show("share"),this.updateLinks()}showMain(){Te(this.container,!0),this.show("main")}showHandheldNav(e){K(this.audiotag)||(this.container.classList.toggle("show-handheld-nav"),e?.preventDefault())}injectCss(t,n){if(!t.match(Pe))return a=`injectCss invalid key "${t}"`,void window.console.error(`${e}: `,a);var a;this.removeCss(t);const o=document.createElement("style");o.id=`style_${t}`,o.innerHTML=n,this.container.appendChild(o)}removeCss(e){this.shadowId(`style_${e}`)?.remove()}completeTemplate(){const e=this.audiotagDataset();let{title:t,waveform:n}=e;const a=this.shadowId("canonical");if(a){a.href=e.canonical;let n=a.classList;t?n.remove("untitled"):(n.add("untitled"),t=v.untitled),a.innerText=t}this.element.title!==t&&(this.element.title=t);const o=this.shadowId("poster");o&&(o.src=e.poster||"");const i=this.shadowId("time");i&&(i.style.backgroundImage=n?`url(${n})`:""),this.showMain()}attachAudiotagToInterface(e){e&&(this.audiotag=e,function(e){e.id=e.id||"CPU-Audio-tag-"+V++}(e),this.completeTemplate(),oe.update({target:e}))}planeNames(){return Object.keys(this._planes).concat(Object.keys(this.audiotag?._CPU_planes??{}))}plane(e){return this._planes[e]??this.audiotag?._CPU_planes[e]}planeTrack(e){return this.shadowId(`track_«${e}»`)}planePanel(e){return this.shadowId(`panel_«${e}»`)}planeNav(e){return this.planePanel(e)?.querySelector("ul")}drawPlane(e){this.planeTrack(e)?.remove(),this.planePanel(e)?.remove();const t=this.plane(e);if(!t)return;const{track:n,panel:a,title:i}=t,r=()=>{this.removeHighlightsPoints(e,be,!0)},s=e=>{e.addEventListener("mouseover",_e,o),e.addEventListener("focusin",_e,o),e.addEventListener("mouseleave",r,o),e.addEventListener("focusout",r,o)};if(!1!==n){const t=document.createElement("aside");t.id=`track_«${e}»`,!0!==n&&t.classList.add(n.split(" ")),this.shadowId("line").appendChild(t),s(t)}if(!1!==a){const t=document.createElement("details");t.open=!0,t.id=`panel_«${e}»`,!0!==a&&t.classList.add(a.split(" ")),t.classList.add("panel"),t.innerHTML=`<summary>${p(i)}</summary><nav><ul></ul></nav>`,this.container.appendChild(t),Te(t.querySelector("summary"),i),s(t)}!this.isController&&this.mirroredInController()&&document.CPU.globalController.drawPlane(e)}addPlane(e,t={}){if(!e.match(Pe)||this.plane(e))return!1;if((t={track:!0,panel:!0,title:"",highlight:!0,points:{},_comp:!1,...t})._comp)this._planes[e]=t;else{if(this.isController)return!1;this.audiotag._CPU_planes=this.audiotag._CPU_planes??{},this.audiotag._CPU_planes[e]=t}return this.drawPlane(e),!0}removePlane(e){return!(!e.match(Pe)||!this.plane(e)||this.isController&&!this._planes[e])&&(delete(this._planes[e]?this._planes:this.audiotag._CPU_planes)[e],this.planeTrack(e)?.remove(),this.planePanel(e)?.remove(),!this.isController&&this.mirroredInController()&&document.CPU.globalController.drawPlane(e),!0)}planePoints(e){return this.plane(e)?.points}point(e,t){return this.plane(e)?.points?.[t]}pointTrack(e,t){return this.shadowId(xe(e,t,!1))}pointPanel(e,t){return this.shadowId(xe(e,t,!0))}planeSort(e){const t=this.planePoints(e);if(!t)return;this.plane(e).points=Object.fromEntries(Object.entries(t).sort((([,e],[,t])=>e.start-t.start)));const n=Object.values(this.plane(e).points);this.plane(e)._st_max=n[n.length-1]?.start??0}planePointNames(e){return Object.keys(this.planePoints(e))}panelReorder(e){if(this.planeSort(e),!this.planePanel(e))return;let t,n;for(let a of this.planePointNames(e))n=this.pointPanel(e,a),t?.insertAdjacentElement("afterend",n),t=n}drawPoint(e,t){const n=this.audiotag??document.CPU.globalController.audiotag,a=this.point(e,t),{start:o,link:i,text:r,image:s,end:l}=a;let d="#";!0===i&&(d=`#${n.id}&t=${o}`),"string"==typeof i&&(d=i);const c=this.planeTrack(e);let u;if(c){u=this.pointTrack(e,t),u||(u=document.createElement("a"),u.id=xe(e,t,!1),u.tabIndex=-1,u.innerHTML='<img alt="" /><span></span>',c.appendChild(u)),u.href=d,u.title=function(e){let t=document.createElement("p");t.innerHTML=e;const{innerText:n}=t;return t.remove(),n}(r);const n=u.querySelector("img");Te(n,s),n.src=s||"",u.querySelector("img").innerHTML=r,this.positionTimeElement(u,o,l)}const p=this.planeNav(e);let h;if(p){h=this.pointPanel(e,t),h||(h=document.createElement("li"),h.id=xe(e,t,!0),h.innerHTML='<a href="#" class="cue"><strong></strong><time></time></a>',p.appendChild(h)),h.querySelector("a").href=d,h.querySelector("strong").innerHTML=r;const n=h.querySelector("time");n.dateTime=E(o),n.innerText=T(o)}this.emitEvent("drawPoint",{planeName:e,pointName:t,pointData:a,elementPointTrack:u,elementPointPanel:h}),!this.isController&&this.mirroredInController()&&document.CPU.globalController.drawPoint(e,t)}addPoint(e,t,n={}){const a=Number(n.start);return!(!t.match(Pe)||!this.plane(e)||this.point(e,t)||!Ee(n))&&(!(!this._planes[e]&&this.isController)&&(n.start=a,this.plane(e).points[t]=n,this.emitEvent("addPoint",{planeName:e,pointName:t,pointData:n}),this.plane(e)._st_max>a?this.panelReorder(e):(this.drawPoint(e,t),this.plane(e)._st_max=a),!0))}bulkPoints(e,t={}){if(!this.plane(e))return!1;if(!this._planes[e]&&this.isController)return!1;for(const[e,n]of Object.entries(t))if(!e.match(Pe)||!Ee(n))return!1;t={...this.plane(e).points,...t},this.plane(e).points=t,this.emitEvent("bulkPoints",{planeName:e,pointDataGroup:t});const n=this.planeNav(e);return n&&(n.innerHTML=""),this.refreshPlane(e),!0}editPoint(e,t,n){const a=this.plane(e);if(!a)return!1;const o=this.point(e,t);if(!o)return!1;let{start:i}=n;i=Number(i);const r=null!=i&&i!==o.start;if(!Ee(n={...o,...n}))return!1;a.points[t]=n,this.drawPoint(e,t),r&&this.panelReorder(e),this.emitEvent("editPoint",{planeName:e,pointName:t,pointData:n}),a._st_max<i&&(a._st_max=i)}removePoint(e,t){const n=this.plane(e);if(!n||!this.point(e,t))return!1;this.emitEvent("removePoint",{planeName:e,pointName:t}),this.pointTrack(e,t)?.remove(),this.pointPanel(e,t)?.remove();let a=0;for(const t of Object.values(this.planePoints(e))){const e=Number(t.start);a=a<e?e:a}return n._st_max=a,!this.isController&&this.mirroredInController()&&document.CPU.globalController.removePoint(e,t),n.points[t]&&delete n.points[t],!0}clearPlane(e){const t=this.plane(e);if(!t)return!1;for(let n of Object.keys(t.points))this.removePoint(e,n);const n=this.planeNav(e);return n&&(n.innerHTML=""),t._st_max=0,!0}refreshPlane(e){this.planeSort(e);for(let t of this.planePointNames(e))this.drawPoint(e,t)}redrawAllPlanes(){r("aside, details.panel",(e=>{e.remove()}),this.container);for(let e of Object.keys({...this._planes,...this.audiotag._CPU_planes}))this.drawPlane(e),this.refreshPlane(e);me(this)}repositionTracks(){if(!G(this.audiotag.duration))for(const e in this.audiotag._CPU_planes){if(this.plane(e).track)for(const t of this.planePointNames(e)){const{start:n,end:a}=this.point(e,t),o=this.pointTrack(e,t);o&&this.positionTimeElement(o,n,a)}}}removeHighlightsPoints(e,t="with-preview",n=!0){if(r(`#track_«${e}» .${t}, #panel_«${e}» .${t}`,(e=>{e.classList.remove(t)}),this.container),n&&this.mirroredInController()){const n=document.CPU.globalController;(this.isController?h(n.audiotag):n).removeHighlightsPoints(e,t,!1)}}highlightPoint(e,t,n="with-preview",a=!0){if(this.removeHighlightsPoints(e,n,a),this.plane(e)?.highlight&&(this.pointTrack(e,t)?.classList.add(n),this.pointPanel(e,t)?.classList.add(n),a&&this.mirroredInController())){const a=document.CPU.globalController;(this.isController?h(a.audiotag):a).highlightPoint(e,t,n,!1)}}focusPoint(e,t){const n=this.pointPanel(e,t)?.querySelector("a")??this.pointTrack(e,t);return!!n&&(n.focus(),!0)}focused(){return this.shadow.querySelector(":focus")}focusedId(){const e=this.focused();if(!e)return;const t=""!=e.id?e.id:e.closest("[id]").id;return""==t?null:t}prevFocus(){Ue(this,!1)}nextFocus(){Ue(this,!0)}}function Ue(e,t){const n=e.planeNames();if(0==n.length)return;const a=t=>{const{track:n,panel:a,points:o}=e.plane(t);return(!1!==n||!1!==a)&&(e.planePanel(t)?.clientHeight>0||e.planeTrack(t)?.clientHeight>0)&&o&&Object.keys(o).length>0};let o,i,r,l=e.focused();if(l&&(l.id||(l=l.closest("[id]")),({planeName:o,pointName:i}=ke(l.id))),""!=i&&(r=e.planePointNames(o),i=s(r,i,t?1:-1)),!i){if(o=t?(e=>{for(let t=n.indexOf(e)+1;t<n.length;t++){const e=n[t];if(a(e))return e}})(o):(e=>{for(let t=n.indexOf(e)-1;t>=0;t--){const e=n[t];if(a(e))return e}})(o),!o)return;const r=e.planePointNames(o);i=r[t?0:r.length-1]}e.focusPoint(o,i)}function Ae(e){const t=document.CPU.globalController;if(t&&!e.isEqualNode(t.audiotag)){const n=document.CPU.globalController.element.querySelector("audio");n&&(R(n),n.remove());const a=t.focusedId();t.attachAudiotagToInterface(e),t.showMain(),t.redrawAllPlanes(),t.setMode(),B(a)}}function Ie([{target:n}]){const a=h(n),o=a.element,i="audio",r=o.querySelector(i),s=document.CPU.globalController;if(!r&&o.tagName!==t)return l="<audio> element was removed.",window.console.info(`${e}: `,l),o.remove(),void(s&&j());var l;o.copyAttributesToMediaDataset?.(),a.attributesChanges(),document.CPU.currentPlaylistID()===r?.dataset.playlist&&j()}class $e extends HTMLElement{constructor(){if(super(),this.CPU=null,this.observer=null,c())this.remove();else{if(this.tagName===e&&!this.querySelector(n))return m(`Tag <${e}> without <audio controls>.\nSee https://github.com/dascritch/cpu-audio/blob/master/INSTALL.md for a correct installation.`),void this.remove();if(this.tagName===t&&document.CPU.globalController)return m(`<${t}> tag instancied twice.`),void this.remove();this.shadow=this.attachShadow({mode:"open"}),this.shadow.innerHTML=`<style>:host{all:initial;display:block;contain:content}.act-buffer,.act-play{--cpu-background:var(--cpu-playing-background);--cpu-color:var(--cpu-playing-color)}.show-error{--cpu-background:var(--cpu-error-background);--cpu-color:var(--cpu-error-color)}#interface{--cpu-timeline-height:10px;background:var(--cpu-background);color:var(--cpu-color)}#interface.no{display:block;pointer-events:none}#interface.no main{visibility:hidden}#interface,*{font-family:var(--cpu-font-family);font-size:var(--cpu-font-size);font-weight:400;font-style:normal;line-height:var(--cpu-line-height);border:none;padding:0;margin:0;text-indent:0;list-style-type:none;-webkit-user-select:none;user-select:none;transition:color var(--cpu-color-transitions),background-color var(--cpu-background-transitions),opacity var(--cpu-background-transitions)}main{display:flex;overflow:hidden;height:var(--cpu-height);top:0;z-index:2}main,summary{position:sticky;background:var(--cpu-background)}a,button{color:currentColor;border:none;text-decoration:none;cursor:pointer;-webkit-touch-callout:none}button{background:0 0}a:focus,button:focus{outline:0}svg{fill:currentColor;width:var(--cpu-height);height:var(--cpu-height)}em,i{font-style:italic}b,strong{font-weight:700}[src='']{visibility:hidden}#pageerror{padding:0 4px;align-self:center}.siders{flex:0 0 var(--cpu-height);width:var(--cpu-height);max-height:var(--cpu-height);height:100%;text-align:center;vertical-align:middle}.act-glow #play,.act-loading #loading,.act-pause #play,.act-play #pause{display:block}.act-glow #play{animation:glow 2s infinite}@keyframes glow{0%{opacity:.5}50%{opacity:1}100%{opacity:.5}}.show-main #pagemain,.show-share #pageshare{flex:1 1 100%;display:flex;align-items:center}.act-loading #loading circle{fill:#777;opacity:1;animation:pulse 2s infinite}#loading circle:nth-child(2){animation-delay:.5s}#loading circle:nth-child(3){animation-delay:1s}@keyframes pulse{50%{opacity:0}}#poster{max-width:var(--cpu-height);min-width:var(--cpu-height);max-height:var(--cpu-height);min-height:var(--cpu-height);object-fit:contain;opacity:0}.poster-loaded #poster{opacity:1}.siders svg{vertical-align:middle;max-width:100%;max-height:100%}#titleline{display:flex;align-items:center}#about,#title{flex:1 1 auto;position:relative}#title{overflow:hidden;text-overflow:'…'}#title a{display:block;max-height:calc(6px + calc(2 * var(--cpu-font-size)))}#canonical.untitled{font-style:italic}#elapse{flex:0 1 var(--cpu-elapse-width);text-align:right}.mode-compact #elapse{flex:0 0 calc(var(--cpu-elapse-width) + 32px);text-align:center}#time{background-color:#000;background-repeat:no-repeat;background-size:100% 100%;width:100%;height:var(--cpu-timeline-height);display:block;position:relative}#loadingline{background:currentColor;height:var(--cpu-timeline-height);display:block;position:absolute;left:0;pointer-events:none}#loadingline:after{content:'';position:absolute;right:0;width:0;height:var(--cpu-timeline-height);display:block;outline:var(--cpu-color) 4px solid;z-index:127;opacity:0}main:focus #loadingline:after,main:hover #loadingline:after{opacity:1}aside{position:absolute;width:100%}aside a{position:absolute;display:block}aside a span{display:none}aside.chapters{height:2px}aside.chapters a{background:var(--cpu-cue);height:2px;border:1px solid var(--cpu-background)}aside.chapters a.active-cue{background:var(--cpu-color)}aside.borders{pointer-events:none;height:var(--cpu-timeline-height);z-index:4;top:calc(var(--cpu-timeline-height) + 6px)}aside.borders a{height:var(--cpu-timeline-height);background:0 0}aside.borders a:after,aside.borders a:before{pointer-events:none;content:"";position:absolute;width:2px;height:var(--cpu-timeline-height);border:2px solid var(--cpu-timeline-limits)}aside.borders a:before{border-right-width:0;left:0}aside.borders a:after{border-left-width:0;left:100%}.act-loading #loadingline{background:repeating-linear-gradient(45deg,var(--cpu-color) 0,var(--cpu-background) 15px,var(--cpu-color) 30px);background-size:200% 200%;animation:loadingline 1s linear infinite}@keyframes loadingline{0%{background-position-y:var(--cpu-timeline-height)}}#handheld-nav{max-height:calc(6px + calc(2 * var(--cpu-font-size)));padding-bottom:8px}.show-handheld-nav #handheld-nav{display:flex}#handheld-nav *{flex:1 0 auto;height:calc(2 * var(--cpu-font-size))}.hide-actions #actions{visibility:hidden;pointer-events:none;min-width:var(--cpu-min-padding);max-width:var(--cpu-min-padding)}#pageshare{text-align:center}#pageshare a{display:flex;align-items:center;justify-content:center;height:var(--cpu-height)}#pageshare a,#pageshare div{flex:1 0;color:#fff;text-decoration:none;overflow:hidden;text-overflow:clip}#pageshare svg{vertical-align:middle;width:32px;height:32px}#twitter{background:#4db5f4}#facebook,#nativeshare{background:#5974cc}#email{background:#c00}#link{background:#77f}#popup{pointer-events:none;position:absolute;transform:translate(-25px,-19px);z-index:127;min-width:50px;font-size:11px;text-align:center;padding:2px;border-radius:4px;box-shadow:#000 2px 2px;background:var(--cpu-popup-background);color:var(--cpu-popup-color);opacity:0}#popup:before{pointer-events:none;content:"";position:absolute;z-index:127;left:20px;bottom:-8px;width:0;height:0;border-top:8px solid var(--cpu-popup-background);border-left:4px solid transparent;border-right:4px solid transparent}.panel{display:flex;list-style:none;flex-direction:column;padding:0 var(--cpu-min-padding);box-shadow:var(--cpu-inner-shadow)}summary{text-align:center;list-style-type:revert;top:var(--cpu-height);box-shadow:var(--cpu-inner-shadow)}summary::marker{font-size:smaller;content:'[+] '}[open]>summary::marker{content:'[-] '}.cue{border-top:1px solid #000;display:flex;margin:0;padding:2px}.cue strong{flex:1 1;font-weight:400}.cue time{flex:0 0 var(--cpu-elapse-width) 0px;text-align:right}.nocuetime time{display:none}.cue time,aside a,summary{font-size:var(--cpu-font-small-size)}.mode-compact{width:calc(var(--cpu-elapse-width) + var(--cpu-height) * 2 + 32px)}.mode-button{width:var(--cpu-height)}.mode-button #about,.mode-button #actions,.mode-button #poster,.mode-button .panel,.mode-button aside,.mode-compact #actions,.mode-compact #line,.mode-compact #title,.mode-compact .panel,.mode-compact aside{width:0;display:none}#control svg,#handheld-nav,#pageshare #nativeshare,.hasnativeshare #pageshare .nonativeshare,.hide-chapters .chapters,.hide-panels .panel,.hide-panels-except-play .panel,.hide-panels-title summary,.hide-poster #poster,.hide-timeline #line,.media-streamed #line,.media-streamed #link,.mode-hidden,.no,.show-error #pagemain,.show-error #pageshare,.show-error #poster,.show-error .panel,.show-handheld-nav #titleline,.show-main #pageerror,.show-main #pageshare,.show-share #pageerror,.show-share #pagemain{display:none}.hasnativeshare #pageshare #nativeshare{display:flex}.mode-compact.show-main #pagemain{flex:0 0 auto}#pageshare div:hover,.active-cue,.with-preview,a:focus,a:hover,button:focus,button:hover{background:var(--cpu-focus-background,var(--cpu-color))!important;color:var(--cpu-focus-color,var(--cpu-background))!important}@media (max-width:640px){.nosmall{display:none!important}#elapse{max-height:16px}#interface{--cpu-timeline-height:8px}#handheld-nav{padding-bottom:4px}}@media (max-width:480px){.nosmaller{display:none!important}.mode-default #elapse{flex:0 1 var(--cpu-elapse-width)}.mode-default #pagemain{padding-bottom:16px}#titleline{height:32px}#line{position:absolute;left:calc(0px - var(--cpu-height));right:calc(0px - var(--cpu-height));height:16px;top:32px}aside a{pointer-events:none}aside.borders{top:-2px}aside.chapters{top:8px}#handheld-nav{padding-bottom:2px}.siders svg{height:calc(var(--cpu-height) - 16px)}}@media (max-width:320px){.mode-default #elapse,.nosmallest{display:none!important}}@media print{#interface{display:none}}@media (prefers-reduced-motion:reduce){*{animation:none!important}}</style><div id="interface"class="no"tabindex="-1"><main><img id="poster"class="nosmall"src=""alt=""loading="lazy"decoding="async"><section id="pageerror"role="alert"></section><section id="pagemain"><button type="button"id="control"tabindex="0"class="siders"><svg id="loading"viewBox="0 0 32 32"aria-hidden="true"><title>${v.loading}</title><circle cx="6"cy="22"r="4"/><circle cx="16"cy="22"r="4"/><circle cx="26"cy="22"r="4"/></svg> <svg id="pause"viewBox="0 0 32 32"aria-hidden="true"><title>${v.pause}</title><path d="M 6,6 12.667,6 12.667,26 6,26 z"/><path d="M 19.333,6 26,6 26,26 19.333,26 z"/></svg> <svg id="play"viewBox="0 0 32 32"aria-hidden="true"><title>${v.play}</title><path d="M 6,6 6,26 26,16 z"/></svg></button><div id="about"><div id="titleline"><strong id="title"><a href="#"id="canonical"aria-label="${v.canonical}"></a></strong> <a id="elapse"aria-label="${v.moment}"tabindex="-1"><span id="currenttime">…</span><span id="totaltime"class="nosmaller"></span></a></div><div id="handheld-nav"><button type="button"id="restart"><svg viewBox="0 0 24 16"aria-hidden="true"><polygon points="4,0 8,0 8,16 4,16"/><path d="M 16,0 8,8 16,16 z"/><path d="M 24,0 16,8 24,16 z"/></svg></button> <button type="button"id="fastreward"><svg viewBox="0 0 24 16"aria-hidden="true"><path d="M 8,0 0,8 8,16 z"/><path d="M 16,0 8,8 16,16 z"/><path d="M 24,0 16,8 24,16 z"/></svg></button> <button type="button"id="reward"class="nosmallest"><svg viewBox="0 0 24 16"aria-hidden="true"><path d="M 12,0 4,8 12,16 z"/><path d="M 20,0 12,8 20,16 z"/></svg></button> <button type="button"id="foward"><svg viewBox="0 0 24 16"aria-hidden="true"><path d="M 4,0 12,8 4,16 z"/><path d="M 12,0 20,8 12,16 z"/></svg></button> <button type="button"id="fastfoward"><svg viewBox="0 0 24 16"aria-hidden="true"><path d="M 0,0 8,8 0,16 z"/><path d="M 8,0 16,8 8,16 z"/><path d="M 16,0 24,8 16,16 z"/></svg></button></div><div id="line"><div id="time"><div id="loadingline"role="progressbar"aria-labelledby="popup"></div><time id="popup">--:--</time></div></div></div><a href="#"target="social"id="link"aria-label="${v.download}"title="${v.download}"download class="siders"><svg viewBox="0 0 32 32"aria-hidden="true"><path d="M 6,6 26,6 16,22 z"/><rect x="6"y="22"width="20"height="4"/></svg></a></section></main></div><style>/* Not the recommended way, but I didn't want to copy the whole scoped.css for invalidate only one^w a couple of rules */\n\t#link {\n\t\tbackground : none !important;\n\t}\n\t#link:hover, #link:focus {\n\t\tbackground: var(--cpu-focus-background, var(--cpu-color)) !important;\n\t}</style>`}}connectedCallback(){c()||this.shadowRoot&&(new Le(this),this.observer=new MutationObserver(Ie),this.observer.observe(this,{childList:!0,attributes:!0}),this.CPU.attributesChanges())}disconnectedCallback(){this.observer&&(this.observer.disconnect(),this.CPU.emitEvent("removed"),this.tagName===t&&document.CPU.globalController&&(document.CPU.globalController=null))}}function Ne([{target:e}]){const t=h(e);he(t),t.completeTemplate();const n=document.CPU.globalController;t.audiotag.isEqualNode(n?.audiotag)&&(he(n),n.completeTemplate())}class Se extends $e{constructor(){super(),this.audiotag=this.querySelector(n),this.audiotag?this.observer=null:this.remove()}copyAttributesToMediaDataset(){if(this.audiotag){for(let e in document.CPU.defaultDataset)if(this.hasAttribute(e)){const t=this.getAttribute(e);this.audiotag.dataset[e]="duration"!==e?t:_(t)}}else this.remove()}connectedCallback(){this.audiotag&&(this.copyAttributesToMediaDataset(),super.connectedCallback(),Z(this.CPU.audiotag),this.observer=new MutationObserver(Ne),this.observer.observe(this,{childList:!0,attributes:!0,subtree:!0}),document.CPU.currentPlaylistID()===this.audiotag.dataset.playlist&&j())}disconnectedCallback(){const e=document.CPU.globalController,t=this.audiotag.dataset.playlist;this.audiotag&&e&&this.audiotag.isEqualNode(e.audiotag)?e.element.appendChild(this.audiotag):t&&R(this.audiotag),super.disconnectedCallback()}}const Me={playStopOthers:!0,scrollTo:!1,autoplay:!1,advanceInPlaylist:!0,keymove:5,alternateDelay:1e3,fastFactor:4,repeatDelay:400,repeatFactor:100,...function(){const e="script[data-cpu-audio]",t=document.head.querySelector(e);if(!t)return{};try{return JSON.parse(t.innerHTML)}catch{return m(`invalid ${e} parameter tag`),{}}}(),currentAudiotagPlaying:null,globalController:null,hadPlayed:!1,lastUsed:null,playlists:{},convert:L,trigger:oe,defaultDataset:y,findCPU:h,adjacentKey:function(e,t,n){if(!e?.hasOwnProperty)return null;const a=Object.keys(e);return a[a.indexOf(t)+n]},isAudiotagPlaying:function(e){const t=document.CPU.currentAudiotagPlaying;return t&&e.isEqualNode(t)},isAudiotagGlobal:function(e){return this.globalController?e.isEqualNode(this.globalController.audiotag):this.isAudiotagPlaying(e)},jumpIdAt:async function(e,t,n){function o({target:e}){const n=_(t);document.CPU.seekElementAt(e,n);const a={target:e};e.readyState>=e.HAVE_FUTURE_DATA?r(a):e.addEventListener("canplay",r,i),oe.update(a)}function r(e){oe.play(null,e.target),n?.()}const s=""!==e?document.getElementById(e):document.querySelector(a);if(null==(s?.currentTime??null))return void m(`Unknow audiotag ${e}`);const l={target:s};s.readyState<s.HAVE_CURRENT_DATA?(s.addEventListener("loadedmetadata",o,i),s.load(),oe.update(l)):o(l)},seekElementAt:function(e,t){if(!W(t)&&!K(e)){if(t=J(e,t),e.fastSeek)e.fastSeek(t);else try{const n=()=>{e.currentTime=t};e.readyState>=e.HAVE_CURRENT_DATA?n():(e.load(),n(),e.currentTime<t&&e.addEventListener("loadedmetadata",n,{once:!0}))}catch(n){e.src=`${e.currentSrc.split("#")[0]}#t=${t}`}h(e)?.updateLoading?.(t)}},currentPlaylist:function(){const e=this.globalController?.audiotag;if(!e)return[];for(const t of Object.values(this.playlists))if(t.includes(e.id))return t;return[]},currentPlaylistID:function(){const e=this.globalController?.audiotag;if(!e)return[];for(let t of Object.keys(this.playlists))if(this.playlists[t].includes(e.id))return t;return null}};async function Oe(){let a;l()?(!function(){const e=document.createElement("style");e.innerHTML='audio[controls]{display:block;width:100%}:root{--cpu-height:64px;--cpu-font-family:Lato,"Open Sans","Segoe UI",Frutiger,"Frutiger Linotype","Dejavu Sans","Helvetica Neue",Arial,sans-serif;--cpu-font-size:15px;--cpu-font-small-size:calc(var(--cpu-font-size) * 0.8);--cpu-line-height:1.2;--cpu-background:#555;--cpu-color:#ddd;--cpu-playing-background:#444;--cpu-playing-color:#fff;--cpu-error-background:#a00;--cpu-error-color:#ff7;--cpu-popup-background:#aaa;--cpu-popup-color:#333;--cpu-cue:#000;--cpu-timeline-limits:#f00;--cpu-elapse-width:160px;--cpu-min-padding:16px;--cpu-inner-shadow:inset 0px 5px 10px -5px black;--cpu-color-transitions:0s;--cpu-background-transitions:0s}@media (max-width:640px){.interface,:root{--cpu-font-size:13px;--cpu-height:48px;--cpu-elapse-width:140px;--cpu-min-padding:4px}@media (max-width:480px){.interface,:root{--cpu-elapse-width:70px}}}',document.head.appendChild(e)}(),a="with-webcomponents",window.customElements.define(e.toLowerCase(),Se),window.customElements.define(t.toLowerCase(),$e)):(m("WebComponent may NOT behave correctly on this browser. Only timecode hash links are activated.\nSee https://github.com/dascritch/cpu-audio/ for details"),r(n,Q),a="without-webcomponents"),document.body.classList.add(`cpu-audio-${a}`),window.addEventListener("hashchange",oe.hashOrder,o),oe.hashOrder({at_start:!0})}document.CPU||window.customElements.get(e.toLowerCase())?m("cpu-audio is called twice"):(HTMLDocument.prototype.CPU=Me,document.addEventListener("DOMContentLoaded",Oe,o),"loading"!==document.readyState&&Oe())})();
//# sourceMappingURL=cpu-audio.direct-download.js.map
// Generated theme : direct-download

