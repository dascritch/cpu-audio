(()=>{"use strict";
/** @license
Cpu-Audio: an extension to the hash system to address timecode into audio/video elements and a player WebComponent
Version 7.1
Copyright (C) 2014-2022 Xavier "dascritch" Mouton-Dubosc & contributors.
License LGPL 3

- project mini-site https://dascritch.github.io/cpu-audio/
- project repository : https://github.com/dascritch/cpu-audio
- use case : http://cpu.pm
- blog post : https://dascritch.net/post/2018/11/06/Reconstruire-son-lecteur-audio-pour-le-web
**/
const t="CPU-AUDIO",e="CPU-CONTROLLER",n="audio[controls]",a=`${t} audio`;function o(t,e,n=document){Array.from(n.querySelectorAll(t)).forEach(e)}function i(n){if([t,e].includes(n.tagName))return n.CPU;let a=n.closest(t)??n.closest(e);return a?a.CPU:n.getRootNode().host.CPU}function r(t){const e=document.createElement("p");e.innerText=t;const{innerHTML:n}=e;return n}function s(t){const e=document.createElement("a");return e.href="string"!=typeof t?t:t.split("#")[0],e.href}const l={passive:!0},c={...l,once:!0};function d(t){s(window.location.href)===s(t.target.href)&&t.preventDefault()}const u=void 0!==window.customElements,p=!window.matchMedia("screen").matches,h=e=>window.console.warn(`${t}▷ `,e),m={fr:{loading:"Chargement en cours…",pause:"Pause",play:"Lecture",canonical:"Lien vers la fiche du sonore",moment:"Lien vers ce moment",untitled:"(sans titre)",cover:"pochette",more:"Actions",share:"Partager",twitter:"Partager sur Twitter",facebook:"Partager sur Facebook",e_mail:"Partager par e-mail",download:"Télécharger",back:"Annuler",chapters:"Chapitres",playlist:"Playlist",media_err_aborted:"Vous avez annulé la lecture.",media_err_network:"Une erreur réseau a causé l'interruption du téléchargement.",media_err_decode:"La lecture du sonore a été annulée suite à des problèmes de corruption ou de fonctionnalités non supportés par votre navigateur.",media_err_src_not_supported:"Le sonore n'a pu être chargé, soit à cause de sourcis sur le serveur, le réseau ou parce que le format n'est pas supporté.",media_err_unknow:"Erreur due à une raison inconnue."},en:{loading:"Loading…",pause:"Pause",play:"Play",canonical:"Link to the sound's page",moment:"Link to this time",untitled:"(untitled)",cover:"cover",more:"Actions",share:"Share",twitter:"Share on Twitter",facebook:"Share on Facebook",e_mail:"Share via e-mail",download:"Download",back:"Back",chapters:"Chapters",playlist:"Playlist",media_err_aborted:"You have aborted the play.",media_err_network:"A network error broke the download.",media_err_decode:"Play was canceled due to file corruption or a not supported function in your browser.",media_err_src_not_supported:"The media cannot be downloaded due to server problems, network problems or unsupported by your browser.",media_err_unknow:"Error of unknown cause."}};let g=function(){const t=document.querySelector("html").lang;if(t.length&&t.toLowerCase()in m)return t;const e=window.navigator.languages??[navigator.language||navigator.browserLanguage];for(const t of e)if(t.split){const[e]=t.split("-");if(e in m)return e}return"en"}();const f=m[g],v=f;const b=/^[\w-]+_«([\w-]+)(»_.*_«([\w-]+))?»$/,w=/^[\w-]+$/;function y(t){let e,n;return"string"==typeof t&&([,e,,n]=t?.match(b)||[]),{planeName:e??"",pointName:n??""}}function C(t,e,n){return`${n?"panel":"track"}_«${t}»_point_«${e}»`}const P={d:86400,h:3600,m:60,s:1},k=[1,60,3600,86400],_=/^\d+$/,x=/\D*/g,T=t=>{let e=0;return""!==t&&(e=_.test(t)?Number(t):t.includes(":")?$.colontimeInSeconds(t):$.subunittimeInSeconds(t)),e},E=t=>{if(t===1/0)return"?";let e="",n=!1;for(const a in P)if(P.hasOwnProperty(a)){let o=P[a];if(t>=o||n){n=!0;let i=Math.floor(t/o);e+=i+a,t-=i*o}}return""===e?"0s":e},L=t=>{if(t===1/0)return"?";let e="",n=!1;for(let a in P)if(P.hasOwnProperty(a)){let o=P[a];if(t>=o||n){n=!0;let a=Math.floor(t/o);e+=""===e?"":":",e+=(a<10&&""!==e?"0":"")+a,t-=a*o}}return 1===e.length?`0:0${e}`:2===e.length?`0:${e}`:""===e?"0:00":e},U=t=>`P${$.secondsInTime(t).toUpperCase()}`,$={timeInSeconds:T,subunittimeInSeconds:t=>{let e,n=0;for(let a in P)P.hasOwnProperty(a)&&t.includes(a)&&([e,t]=t.split(a),n+=Number(e.replace(x,""))*P[a]);return n},colontimeInSeconds:t=>{let e=0;const n=t.split(":");for(let t=0;t<n.length;t++)e+=Number(n[t])*k[n.length-1-t];return e},secondsInTime:E,secondsInColonTime:L,secondsInPaddledColonTime:t=>{if(t===1/0)return"?";let e=$.secondsInColonTime(t);return"00:00:00".substr(0,8-e.length)+e},durationIso:U},A=$;function I({target:t}){if(t.id||(t=t.closest("[id]")),!t)return;const{planeName:e,pointName:n}=y(t.id);i(t).highlightPoint(e,n)}function N({classList:t},e){e?t.remove("no"):t.add("no")}const S={i:"i",em:"i",b:"b",bold:"strong",u:"u",lang:"i"},M={i:"i",em:"i",b:"b",strong:"b",u:"u"};let D=S;const O=/<(\w+)(\.[^>]+)?( [^>]+)?>/gi,z=/<\/(\w+)( [^>]*)?>/gi,H=/\n/gi,q=/<br\s*[^>]*>/gi;function B(t){return!(t in D)}function R(t,e,n,a){if(B(e=e.toLowerCase()))return"";let o="";return"lang"==e&&(o=` lang="${a.trim()}"`),`<${D[e]}${o}>`}function j(t,e){return B(e=e.toLowerCase())?"":`</${D[e]}>`}const F=function(t,e=!0){if(D=e?S:M,t.split("<").length!==t.split(">").length)return r(t);const n=t.replace(O,R).replace(z,j);return e?n.replace(H,"<br/>"):n.replace(q,"\n")};function V(t){return null==t||t.duration===1/0||null!=t.dataset.streamed}function K(t){return t===1/0||null===t||isNaN(t)}function W(t){return 0===t||K(t)}function G({duration:t,dataset:e}){let n=null;const a=Number(t);if(W(a)){const t=Number(e.duration);W(t)||(n=t)}else n=a;return n}function X(t,e){if(K(e))return null;e=e<0?0:e;const n=G(t);return W(n)||(e=e<n?e:n),e}function J(t){if(!t)return null;let e=null;if(t.textTracks?.length>0)for(const n of t.textTracks)"chapters"!==n.kind.toLowerCase()||!n.cues||e&&n.language.toLowerCase()!==g||(e=n);return e}function Y(t,e,n){if(!t?.indexOf)return null;const a=t.indexOf(e);return-1===a?null:t[a+n]}let Z=null;function Q(t,e){const n=t.audiotag,a=t.planePoints("_chapters");if(!a)return;const{pointName:o}=y(Z);let i=Y(a,o,e),r=Object.values(a);e<0&&(r=r.reverse());const{currentTime:s}=n;if(!i)for(const t of r)!i&&(e<0&&t.end<=s||e>0&&t.start>=s)&&(i=t);i&&document.CPU.jumpIdAt(n.id,i.start)}function tt(t,e){const{classList:n}=document.body;n.remove(Z),Z=`cpu_playing_tag_«${e.id}»_cue_«${t.id}»`,n.add(Z)}const et="_chapters";async function nt(t){if(t.isController)return;const e=t.audiotag;let n=!1;const a={};if(e){const o=J(e);if(o?.cues.length>0){t.addPlane(et,{title:v.chapters,track:"chapters"});const i=()=>{at(t)};o.removeEventListener("cuechange",i),o.addEventListener("cuechange",i,l);for(const n of o.cues)t.point(et,n.id)||(a[n.id]={start:X(e,Math.floor(n.startTime)),text:F(n.text),link:!0,end:X(e,Math.floor(n.endTime))});o.cues.length>0&&(n=!0),t.bulkPoints(et,a),at(t,{target:{activeCues:o.cues}})}}const o=`cpu_tag_«${e.id}»_chaptered`,i=document.body.classList;n?i.add(o):(t.removePlane(et),i.remove(o))}function at(t,e=null){const n=e?e.target.activeCues:J(t.audiotag)?.activeCues;let a;const o=t.audiotag.currentTime;if(n?.length>0)for(const t of n)t.startTime<=o&&o<t.endTime&&(a=t);a?.id!==t._activecue_id&&(t.removeHighlightsPoints(et,it),t._activecue_id=a?.id,a&&(tt(a,t.audiotag),t.emitEvent("chapterChanged",{cue:a}),t.highlightPoint(et,a.id,it)))}const ot="with-preview",it="active-cue";const rt={drawPlane:function(t){this.planeTrack(t)?.remove(),this.planePanel(t)?.remove();const e=this.plane(t);if(!e)return;const{track:n,panel:a,title:o}=e,i=()=>this.removeHighlightsPoints(t,ot,!0),s=t=>{t.addEventListener("mouseover",I,l),t.addEventListener("focusin",I,l),t.addEventListener("mouseleave",i,l),t.addEventListener("focusout",i,l)};if(!1!==n){const e=document.createElement("aside");e.id=`track_«${t}»`,!0!==n&&e.classList.add(n.split(" ")),this.shadowId("line").appendChild(e),s(e)}if(!1!==a){const e=document.createElement("details");e.open=!0,e.id=`panel_«${t}»`,!0!==a&&e.classList.add(a.split(" ")),e.classList.add("panel"),e.innerHTML=`<summary>${r(o)}</summary><nav><ul></ul></nav>`,this.container.appendChild(e),N(e.querySelector("summary"),o),s(e)}!this.isController&&this.mirroredInController()&&document.CPU.globalController.drawPlane(t)},drawPoint:function(t,e){const n=this.audiotag??document.CPU.globalController.audiotag,a=this.point(t,e),{start:o,link:i,text:r,image:s,end:l}=a;let c="#";!0===i&&(c=`#${n.id}&t=${o}`),"string"==typeof i&&(c=i);const d=this.planeTrack(t);let u;if(d){u=this.pointTrack(t,e),u||(u=document.createElement("a"),u.id=C(t,e,!1),u.tabIndex=-1,u.innerHTML='<img alt="" /><span></span>',d.appendChild(u)),u.href=c,u.title=function(t){const e=document.createElement("p");e.innerHTML=t;const{innerText:n}=e;return n}(r);const n=u.querySelector("img");N(n,s),n.src=s||"",u.querySelector("img").innerHTML=r,this.positionTimeElement(u,o,l)}const p=this.planeNav(t);let h;if(p){h=this.pointPanel(t,e),h||(h=document.createElement("li"),h.id=C(t,e,!0),h.innerHTML='<a href="#" class="cue"><strong></strong><time></time></a>',p.appendChild(h)),h.querySelector("a").href=c,h.querySelector("strong").innerHTML=r;const n=h.querySelector("time");n.dateTime=U(o),n.innerText=L(o)}this.emitEvent("drawPoint",{planeName:t,pointName:e,pointData:a,elementPointTrack:u,elementPointPanel:h}),!this.isController&&this.mirroredInController()&&document.CPU.globalController.drawPoint(t,e)},refreshPlane:function(t){this.planeSort(t);for(const e of this.planePointNames(t))this.drawPoint(t,e)},redrawAllPlanes:function(){o("aside, details.panel",(t=>t.remove()),this.container);for(const t of Object.keys({...this._planes,...this.audiotag._CPU_planes}))this.drawPlane(t),this.refreshPlane(t);at(this)},removeHighlightsPoints:function(t,e="with-preview",n=!0){if(o(`#track_«${t}» .${e}, #panel_«${t}» .${e}`,(t=>t.classList.remove(e)),this.container),n&&this.mirroredInController()){const n=document.CPU.globalController;(this.isController?i(n.audiotag):n).removeHighlightsPoints(t,e,!1)}},highlightPoint:function(t,e,n="with-preview",a=!0){if(this.removeHighlightsPoints(t,n,a),this.plane(t)?.highlight&&(this.pointTrack(t,e)?.classList.add(n),this.pointPanel(t,e)?.classList.add(n),a&&this.mirroredInController())){const a=document.CPU.globalController;(this.isController?i(a.audiotag):a).highlightPoint(t,e,n,!1)}}},st=rt,lt="_playlist";function ct({id:t}){const e=document.CPU.playlists,n=document.CPU.currentPlaylistID();let a=!1;for(const o in e){const i=e[o].length,r=e[o].filter((e=>e!==t&&document.getElementById(e)));i!==r.length&&o===n&&(a=!0),document.CPU.playlists[o]=r,0===r.length&&delete document.CPU.playlists[o]}a&&ut()}function dt(){const t=document.CPU.globalController;if(!t)return;const e=t.current_playlist,n={};if(t.clearPlane(lt),0!==t.current_playlist.length){for(const t of e)n[t]={text:document.getElementById(t)?.dataset.title,link:`#${t}&t=0`};t.bulkPoints(lt,n),t.element.shadowRoot.querySelector("main").insertAdjacentElement("afterend",t.planePanel(lt))}else t.removePlane(lt)}function ut(t){const e=document.CPU.globalController;if(!e||!e.isController)return;const n=e.current_playlist;if(e.current_playlist=document.CPU.currentPlaylist(),e.plane(lt)||e.addPlane(lt,{title:v.playlist,track:!1,panel:"nocuetime",highlight:!0,_comp:!0}),n!==e.current_playlist&&dt(),e.highlightPoint(lt,e.audiotag.id,it),t){const{planeName:n,pointName:a}=y(t);e.focusPoint(n,a)}}let pt=!1,ht=0,mt=!1;function gt(t=null,e=null){if(!e){const{target:n}=t;e="AUDIO"==n.tagName?n:i(n).audiotag}e.pause(),document.CPU.currentAudiotagPlaying=null,window.localStorage.removeItem(e.currentSrc)}function ft(t=null,e=null){if(!t&&pt)return void h("play() prevented because already waiting for focus");var n;e=e??i(t.target).audiotag,pt=!1,((n=e.currentTime)<ht||!1!==mt&&n>mt)&&(ht=0,mt=!1);let a=e.play();a&&a.then((()=>{document.CPU.hadPlayed=!0})).catch((n=>{pt=!0;const a=()=>{!function(t,e){pt=!1,document.CPU.autoplay&&ft(t,e)}(t,e)};switch(n.name){case"NotAllowedError":if(h("Auto-play prevented : Browser requires a manual interaction first."),document.addEventListener("focus",a,c),document.addEventListener("click",a,c),null!=e._CPU_played){let t=i(e);t.glowBeforePlay=!0,t.setAct("glow")}break;case"NotSupportedError":n("The browser refuses the audio source, probably due to audio format.")}})),re(e)}function vt({target:t}){const{audiotag:e}=i(t);e.paused?ft(null,e):gt(null,e)}function bt(t){const{target:e,offsetX:n,at:a}=t,o=document.CPU,r=i(e),s=r.audiotag;if(a>=0)return void o.seekElementAt(s,a);const l=n/e.clientWidth,c=G(s);o.currentAudiotagPlaying&&!o.isAudiotagPlaying(s)&&gt(null,o.currentAudiotagPlaying),ft(t,s),W(c)?r.updateLoading(void 0,100):o.seekElementAt(s,l*c)}function wt(t){const{target:e,clientX:n,targetTouches:a}=t;if(!e)return;const o=i(e),r=o.audiotag,s=G(r);if(W(s))return void(V(r)||Lt(r,wt,t));const{x:l,width:c}=o.shadowId("time").getBoundingClientRect(),d=((n??a?.[0]?.clientX)-l)/c;o.showThrobberAt(X(r,d*s))}function yt(t,e=1){if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return;const n=i(t.target),{audiotag:a}=n;function o(e){t.at=X(a,a.currentTime+e),n.showThrobberAt(t.at),bt(t),n.hideThrobberLater()}switch(t.keyCode){case 13:if("control"!==n.focused()?.id.toLowerCase())return;vt(t);break;case 27:Ct(t),gt(null,a);break;case 32:vt(t);break;case 35:document.CPU.seekElementAt(a,a.duration);break;case 36:Ct(t);break;case 37:o(-document.CPU.keymove*e);break;case 39:o(+document.CPU.keymove*e);break;case 38:n.prevFocus();break;case 40:n.nextFocus();break;default:return}t.preventDefault?.()}function Ct({target:t}){const e=i(t);document.CPU.seekElementAt(e.audiotag,0)}async function Pt(t,e=null){let n=!0;"string"!=typeof t&&(n="at_start"in t,t=location.hash.substr(1));let a=null,o="",i=!1;for(const e of t.split("&"))if(e.includes("=")){const[t,n]=e.split("=");switch(t.toLowerCase()){case"t":o=n||"0",i=!0;break;case"autoplay":i="1"===n;break;case"auto_play":i="true"===n.toLowerCase()}}else a=a??e;if(""===o||n&&!i)return void e?.();const[r,s]=o.split(",");let l=T(r),c=void 0!==s&&T(s);!1!==c&&(c=c>l&&c),function(t,e){ht=t,mt=e}(l,c),document.CPU.scrollTo&&(a?.length>0?document.querySelector(`#${a}`):document.CPU.currentAudiotagPlaying)?.closest("cpu-audio, cpu-controller").scrollIntoView(),await document.CPU.jumpIdAt(a??"",r,e),ut()}function kt(t,e){const{id:n}=t,a=t.dataset.playlist;if(!a)return;const o=document.CPU.playlists[a];if(!o)return void h(`Named playlist ${a} not created. WTF ?`);const i=o.indexOf(n);if(i<0)return void h(`Audiotag ${n} not in playlist ${a}. WTF ?`);const r=o[i+e];if(!r)return;const s=document.getElementById(r);s?(document.CPU.seekElementAt(s,0),ft(null,s)):h(`Audiotag #${r} doesn't exists. WTF ?`)}function _t({target:t}){!1!==mt&&t.currentTime>mt&&gt(void 0,t),function(t){i(t)?.update(),document.CPU.globalController?.update()}(t),t.paused||V(t)||window.localStorage.setItem(t.currentSrc,String(t.currentTime))}const xt={...{hashOrder:Pt},...{restart:Ct,reward:function(t){t.keyCode=37,yt(t)},foward:function(t){t.keyCode=39,yt(t)},fastreward:function(t){t.keyCode=37,yt(t,document.CPU.fastFactor)},fastfoward:function(t){t.keyCode=39,yt(t,document.CPU.fastFactor)}},...{throbble:bt,hover:wt,out:function({target:t}){i(t).hideThrobber()}},...{key:yt},...{update:_t},...{cuechange:tt,prevcue:function({target:t}){Q(i(t),-1)},nextcue:function({target:t}){Q(i(t),1)}},...{prevtrack:function({target:t},e=null){kt(e??i(t).audiotag,-1)},nexttrack:function({target:t},e=null){kt(e??i(t).audiotag,1)}},pause:gt,playOnce:function({target:t}){const e=document.CPU;e.lastUsed=t,e.playStopOthers&&e.currentAudiotagPlaying&&!e.isAudiotagPlaying(t)&&gt(void 0,e.currentAudiotagPlaying),e.currentAudiotagPlaying=t},play:ft,toggleplay:vt,_end:()=>mt};function Tt(t){let e=t.target;if(null!==document.CPU.currentAudiotagPlaying||V(e))return;let n=Number(window.localStorage.getItem(e.currentSrc));n>0&&!pt&&(document.CPU.seekElementAt(e,n),xt.play(null,e))}HTMLAudioElement.prototype._CPU_played=null,HTMLAudioElement.prototype._CPU_planes=null;let Et=0;function Lt(t,e=null,n=null){t&&(t.readyState>t.HAVE_NOTHING?e?.(n):(e&&t.addEventListener("loadedmetadata",(()=>e?.(n)),c),t.load()))}function Ut(t){t.addEventListener("loadedmetadata",Tt,c),t.addEventListener("play",xt.playOnce,l),t.addEventListener("ended",xt.nexttrack,l),t.addEventListener("ready",Tt,l),t.addEventListener("canplay",Tt,l);for(const e of["ready","load","loadeddata","canplay","abort","error","emptied","play","playing","pause","ended","durationchange","loadedmetadata","timeupdate","waiting"])t.addEventListener(e,xt.update,l);if(!u)for(const e of["pause","ended"])t.addEventListener(e,xt.pause,l);""===t.getAttribute("preload")&&Lt(t)}function $t(t){null==t._CPU_played&&(t._CPU_played=!1,Ut(t),t.hidden=!0,t.removeAttribute("controls"),function(t){if("string"==typeof t.dataset.playlist){const e=t.dataset.playlist;e in document.CPU.playlists||(document.CPU.playlists[e]=[]),document.CPU.playlists[e].push(t.id),document.CPU.globalController&&e===document.CPU.currentPlaylistID()&&ut()}}(t))}let At=null;function It({target:t}){At=setTimeout(Nt,document.CPU.alternateDelay,i(t))}function Nt(t){t.showHandheldNav(),At=null}function St(){clearTimeout(At),At=null}let Mt=null;const Dt=["fastreward","reward","foward","fastfoward"];function Ot(t){const e=t.target.id?t.target:t.target.closest("button");e.id&&Dt.includes(e.id)&&(xt[e.id](t),Mt&&window.clearTimeout(Mt),Mt=window.setTimeout(zt,document.CPU.repeatDelay,t),t.preventDefault())}function zt(t){xt[t.target.id](t),Mt=window.setTimeout(zt,document.CPU.repeatFactor,t),t.preventDefault?.()}function Ht(t){window.clearTimeout(Mt),Mt=null,t.preventDefault()}function qt(t){const{title:e,canonical:n}=i(t.target).audiotagDataset();navigator.share({title:e,text:e,url:n}),t.preventDefault()}const Bt=function(t){t.container.addEventListener("focus",(e=>{(t.shadowId("control")??t.shadowId("toggleplay"))?.focus(),e.preventDefault()}));const{classList:e}=t.container;t.shadowId("poster")?.addEventListener("load",(()=>{e.add("poster-loaded")}),l);const n={pause:xt.pause,play:xt.play,time:xt.throbble,actions:()=>t.showActions(),back:e=>{t.showMain(),e.preventDefault()},poster:()=>t.showMain(),restart:xt.restart,toggleplay:xt.toggleplay,prevcue:xt.prevcue,nextcue:xt.nextcue,prevtrack:xt.prevtrack,nexttrack:xt.nexttrack};for(const[e,a]of Object.entries(n)){const n=t.shadowId(e);n?.addEventListener("click",a,"A"===n.tagName?{}:l)}for(const e of Dt){const n=t.shadowId(e);n&&(n.addEventListener("pointerdown",Ot),n.addEventListener("pointerout",Ht),n.addEventListener("pointerup",Ht))}t.element.addEventListener("keydown",xt.key);const a=t.shadowId("time");a&&(a.addEventListener("pointerenter",xt.hover,l),a.addEventListener("pointermove",xt.hover,l),a.addEventListener("pointerout",xt.out,l),a.addEventListener("pointerdown",It,l),a.addEventListener("pointerup",St,l)),navigator.share&&(e.add("hasnativeshare"),t.shadowId("nativeshare")?.addEventListener("click",qt,l));const o=t.shadowId("canonical");o&&o.addEventListener("click",d),t.audiotag&&(t.container.addEventListener("pointerenter",(()=>Lt(t.audiotag)),c),t.audiotag.addEventListener("durationchange",(()=>t.repositionTracks()),l),function(t){const e=()=>{nt(t)};e();const{audiotag:n}=t;n.addEventListener("loadedmetadata",e,c);const a=n.querySelector('track[kind="chapters"]');a&&!a._CPU_load_ev&&(a._CPU_load_ev=a.addEventListener("load",e,l))}(t),ut(),t.showMain(),t.updatePlayButton(),t.emitEvent("ready"),t.updateLinks())},Rt=document.head,jt={get title(){for(const t of['property="og:title"','name="twitter:title"']){const e=Rt.querySelector(`meta[${t}]`);if(e)return e.content}const t=document.title;return""===t?null:t},get poster(){for(const t of['property="og:image"','name="twitter:image:src"']){const e=Rt.querySelector(`meta[${t}]`);if(e)return e.content}return null},get canonical(){const t=Rt.querySelector('link[rel="canonical"]');return t?t.href:location.href.split("#")[0]},get twitter(){const t=Rt.querySelector('meta[name="twitter:creator"]');return t&&t.content.length>1?t.content:null},playlist:null,waveform:null,duration:null,download:null},Ft={attributesChanges:function(){let t=null;if(this.element.hasAttribute("mode")){t=this.element.getAttribute("mode");const[e,n]=t.split(",");n&&(t=this.audiotag.paused?e:n,this.mode_when_play=n)}this.setMode(t),this.element.hasAttribute("hide")&&this.setHide(this.element.getAttribute("hide").split(" "))},audiotagDataset:function(){return{...jt,...this.audiotag.dataset}},mirroredInController:function(){const t=document.CPU.globalController;return t&&this.audiotag.isEqualNode(t.audiotag)},emitEvent:async function(t,e){this.element.dispatchEvent(new CustomEvent(`CPU_${t}`,{target:this.element,bubbles:!0,cancelable:!1,composed:!1,detail:e}))},shadowId:function(t){return this.shadow.getElementById(t)}},Vt=["poster","actions","timeline","chapters","panels","panels-title","panels-except-play"],Kt={setMode:function(t=null){if(t=t??"default",this.mode_was===t)return;const{classList:e}=this.container;e.remove(`mode-${this.mode_was}`),e.add(`mode-${t}`),this.mode_was=t},setAct:function(t){if(this.act_was===t)return;if(!document.CPU.hadPlayed&&"loading"===t){if(null!==this.act_was)return;t="glow"}const e=this.container.classList;e.remove("act-loading","act-buffer","act-pause","act-play","act-glow"),e.add(`act-${t}`),"play"===this.act_was&&"loading"===t&&e.add("act-buffer"),this.act_was=t},setHide:function(t){const e=this.container.classList;for(const t of Vt)e.remove(`hide-${t}`);for(let n of t)n=n.toLowerCase(),Vt.includes(n)&&e.add(`hide-${n}`)},completeTemplate:function(){const t=this.audiotagDataset();let{title:e,waveform:n}=t;const a=this.shadowId("canonical");if(a){a.href=t.canonical;let n=a.classList;e?n.remove("untitled"):(n.add("untitled"),e=v.untitled),a.innerText=e}this.element.title!==e&&(this.element.title=e);const o=this.shadowId("poster");o&&(o.src=t.poster||"");const i=this.shadowId("time");i&&(i.style.backgroundImage=n?`url(${n})`:""),this.showMain()},attachAudiotagToInterface:function(t){t&&(this.audiotag=t,function(t){t.id=t.id||`${document.CPU.IDPrefix}${Et++}`}(t),this.completeTemplate(),_t({target:t}))},injectCss:function(e,n){if(!e.match(w))return a=`injectCss invalid key "${e}"`,void window.console.error(`${t}▷ `,a);var a;this.removeCss(e);const o=document.createElement("style");o.id=`style_${e}`,o.innerHTML=n,this.container.appendChild(o)},removeCss:function(t){this.shadowId(`style_${t}`)?.remove()}},Wt=Kt,Gt="_borders",Xt={updatePlayButton:function(){const t=this.audiotag,e=t.getAttribute("preload"),n=this.shadowId("control"),a="aria-label";let o=!e||"none"!==e.toLowerCase();if(t.readyState<t.HAVE_CURRENT_DATA&&(o||t._CPU_played))return this.setAct("loading"),void n.setAttribute(a,v.loading);let i="pause",r="play";t.paused&&(i="play",r="pause",!t._CPU_played&&this.glowBeforePlay&&(r="glow")),this.setAct(r),n.setAttribute(a,v[i]);const s="last-used",l=this.container.classList;t.paused?this.audiotag.isEqualNode(document.CPU.lastUsed)||l.remove(s):(t._CPU_played=!0,l.add(s),this.mode_when_play&&(this.setMode(this.mode_when_play),this.mode_when_play=null))},updateLine:function(t,e=null){const n=this.shadowId("loadingline");if(!n)return;const{duration:a}=this.audiotag;e=e??(0===a?0:100*t/a),n.style.width=`${e}%`},updateTime:function(){const t=this.audiotag,e=V(t)?0:Math.floor(t.currentTime),n=t.dataset.canonical??"",a=n.indexOf("#"),o=this.shadowId("elapse");o&&(o.href=`${s(n)}#${a<0?t.id:n.substr(a+1)}&t=${e}`);this.shadowId("currenttime")&&(this.shadowId("currenttime").innerText=L(t.currentTime));const i=this.shadowId("totaltime");if(i){const e=G(t);i.innerText=W(e)?"":` / ${L(e)}`,N(i,e)}this.updateLine(t.currentTime)},updateTimeBorders:function(){const t=this.audiotag;if(document.CPU.isAudiotagGlobal(t)&&!1!==mt){if(this.plane(Gt)){const t=this.point(Gt,Gt);if(t&&t.start===ht&&t.end===mt)return}this.addPlane(Gt,{track:"borders",panel:!1,highlight:!1}),this.addPoint(Gt,Gt,{start:ht,link:!1,end:mt})}else this.removePlane(Gt)},updateLoading:function(t,e){this.updateLine(t,e),this.setAct("loading")},updateError:function(){const t=this.audiotag;if(!t)return!0;const e=t.error;if(e){let t;this.show("error");const n=MediaError;switch(e.code){case n.MEDIA_ERR_ABORTED:t=v.media_err_aborted;break;case n.MEDIA_ERR_NETWORK:t=v.media_err_network;break;case n.MEDIA_ERR_DECODE:t=v.media_err_decode;break;case n.MEDIA_ERR_SRC_NOT_SUPPORTED:t=v.media_err_src_not_supported;break;default:t=v.media_err_unknow}const a=this.shadowId("pageerror");return a&&(a.innerText=t),!0}return!1},updateLinks:function(){const t=this.audiotag,e=this.audiotagDataset(),n=s(e.canonical??""),a=0===t.currentTime?"":`&t=${Math.floor(t.currentTime)}`,o=n===s(window.location.href)?t.id:"",i=encodeURIComponent(`${n}#${o}${a}`),r="@"!==e.twitter?.[0]?"":`&via=${e.twitter.substring(1)}`,l=t.querySelector("source[data-downloadable]")?.src||e.download||t.currentSrc,c=e.title,d={twitter:`https://twitter.com/share?text=${c}&url=${i}${r}`,facebook:`https://www.facebook.com/sharer.php?t=${c}&u=${i}`,email:`mailto:?subject=${c}&body=${i}`,link:l};for(const t in d){const e=this.shadowId(t);e&&(e.href=d[t])}},update:function(){this.updateError()||(this.updatePlayButton(),this.updateTime(),this.updateTimeBorders())}},Jt=Xt,Yt={positionTimeElement:function(t,e=null,n=null){const{duration:a}=this.audiotag;if(W(a))return;const o=t=>null!=t&&!1!==t;o(e)&&(t.style.left=e/a*100+"%"),o(n)&&(t.style.right=100*(1-n/a)+"%")},showThrobberAt:async function(t){const e=this.audiotag;if(e.duration<1)return;isNaN(e.duration)&&!V(e)&&(e.setAttribute("preload","metadata"),Lt(e,wt,event));const n=this.shadowId("popup");this.positionTimeElement(n,t),n.style.opacity=1,n.innerHTML=L(t),n.dateTime=E(t).toUpperCase()},hideThrobber:function(){this.shadowId("popup").style.opacity=0},hideThrobberLater:function(){const t=this.shadowId("popup");t._hider&&window.clearTimeout(t._hider),t._hider=window.setTimeout((()=>{this.hideThrobber()}),1e3)}},Zt={show:function(t){const{classList:e}=this.container;e.remove("show-main","show-share","show-error","media-streamed"),V(this.audiotag)&&e.add("media-streamed"),e.add(`show-${t}`)},showActions:function(){this.show("share"),this.updateLinks()},showMain:function(){N(this.container,!0),this.show("main")},showHandheldNav:function(t){V(this.audiotag)||(this.container.classList.toggle("show-handheld-nav"),t?.preventDefault())}};function Qt({start:t,end:e}){return(null==t||t>=0)&&(null==e||e>=t)}const te={planeNames:function(){return Object.keys(this._planes).concat(Object.keys(this.audiotag?._CPU_planes??{}))},plane:function(t){return this._planes[t]??this.audiotag?._CPU_planes[t]},planeTrack:function(t){return this.shadowId(`track_«${t}»`)},planePanel:function(t){return this.shadowId(`panel_«${t}»`)},planeNav:function(t){return this.planePanel(t)?.querySelector("ul")},addPlane:function(t,e={}){if(!t.match(w)||this.plane(t))return!1;if((e={track:!0,panel:!0,title:"",highlight:!0,points:{},_comp:!1,...e})._comp)this._planes[t]=e;else{if(this.isController)return!1;this.audiotag._CPU_planes=this.audiotag._CPU_planes??{},this.audiotag._CPU_planes[t]=e}return this.drawPlane(t),!0},removePlane:function(t){return!(!t.match(w)||!this.plane(t)||this.isController&&!this._planes[t])&&(delete(this._planes[t]?this._planes:this.audiotag._CPU_planes)[t],this.planeTrack(t)?.remove(),this.planePanel(t)?.remove(),!this.isController&&this.mirroredInController()&&document.CPU.globalController.drawPlane(t),!0)},planePoints:function(t){return this.plane(t)?.points},point:function(t,e){return this.plane(t)?.points?.[e]},pointTrack:function(t,e){return this.shadowId(C(t,e,!1))},pointPanel:function(t,e){return this.shadowId(C(t,e,!0))},planeSort:function(t){const e=this.planePoints(t);if(!e)return;this.plane(t).points=Object.fromEntries(Object.entries(e).sort((([,t],[,e])=>t.start-e.start)));const n=Object.values(this.plane(t).points);this.plane(t)._st_max=n[n.length-1]?.start??0},planePointNames:function(t){return Object.keys(this.planePoints(t))},panelReorder:function(t){if(this.planeSort(t),!this.planePanel(t))return;let e,n;for(const a of this.planePointNames(t))n=this.pointPanel(t,a),e?.insertAdjacentElement("afterend",n),e=n},addPoint:function(t,e,n={}){const a=Number(n.start);return!(!e.match(w)||!this.plane(t)||this.point(t,e)||!Qt(n))&&(!(!this._planes[t]&&this.isController)&&(n.start=a,this.plane(t).points[e]=n,this.emitEvent("addPoint",{planeName:t,pointName:e,pointData:n}),this.plane(t)._st_max>a?this.panelReorder(t):(this.drawPoint(t,e),this.plane(t)._st_max=a),!0))},bulkPoints:function(t,e={}){if(!this.plane(t))return!1;if(!this._planes[t]&&this.isController)return!1;for(const[t,n]of Object.entries(e))if(!t.match(w)||!Qt(n))return!1;e={...this.plane(t).points,...e},this.plane(t).points=e,this.emitEvent("bulkPoints",{planeName:t,pointDataGroup:e});const n=this.planeNav(t);return n&&(n.innerHTML=""),this.refreshPlane(t),!0},editPoint:function(t,e,n){const a=this.plane(t);if(!a)return!1;const o=this.point(t,e);if(!o)return!1;let{start:i}=n;i=Number(i);const r=null!=i&&i!==o.start;if(!Qt(n={...o,...n}))return!1;a.points[e]=n,this.drawPoint(t,e),r&&this.panelReorder(t),this.emitEvent("editPoint",{planeName:t,pointName:e,pointData:n}),a._st_max<i&&(a._st_max=i)},removePoint:function(t,e){const n=this.plane(t);if(!n||!this.point(t,e))return!1;this.emitEvent("removePoint",{planeName:t,pointName:e}),this.pointTrack(t,e)?.remove(),this.pointPanel(t,e)?.remove();let a=0;for(const e of Object.values(this.planePoints(t))){const t=Number(e.start);a=a<t?t:a}return n._st_max=a,!this.isController&&this.mirroredInController()&&document.CPU.globalController.removePoint(t,e),n.points[e]&&delete n.points[e],!0},clearPlane:function(t){const e=this.plane(t);if(!e)return!1;for(const n of Object.keys(e.points))this.removePoint(t,n);const n=this.planeNav(t);return n&&(n.innerHTML=""),e._st_max=0,!0},repositionTracks:function(){if(!W(this.audiotag.duration))for(const t in this.audiotag._CPU_planes){if(this.plane(t).track)for(const e of this.planePointNames(t)){const{start:n,end:a}=this.point(t,e),o=this.pointTrack(t,e);o&&this.positionTimeElement(o,n,a)}}}};const ee=function(t,e){const n=t.planeNames();if(0==n.length)return;const a=e=>{const{track:n,panel:a,points:o}=t.plane(e);return(!1!==n||!1!==a)&&(t.planePanel(e)?.clientHeight>0||t.planeTrack(e)?.clientHeight>0)&&o&&Object.keys(o).length>0};let o,i,r,s=t.focused();if(s&&(s.id||(s=s.closest("[id]")),({planeName:o,pointName:i}=y(s.id))),""!=i&&(r=t.planePointNames(o),i=Y(r,i,e?1:-1)),!i){if(o=e?(t=>{for(let e=n.indexOf(t)+1;e<n.length;e++){const t=n[e];if(a(t))return t}})(o):(t=>{for(let e=n.indexOf(t)-1;e>=0;e--){const t=n[e];if(a(t))return t}})(o),!o)return;const r=t.planePointNames(o);i=r[e?0:r.length-1]}t.focusPoint(o,i)},ne={focusPoint:function(t,e){const n=this.pointPanel(t,e)?.querySelector("a")??this.pointTrack(t,e);return!!n&&(n.focus(),!0)},focused:function(){return this.shadow.querySelector(":focus")},focusedId:function(){const t=this.focused();if(!t)return;const e=""!=t.id?t.id:t.closest("[id]").id;return""==e?null:e},prevFocus:function(){ee(this,!1)},nextFocus:function(){ee(this,!0)}},ae=ne;const oe=function(t){const{audiotag:e,shadowRoot:n}=t,o={element:t,shadow:n,audiotag:e,mode_when_play:null,glowBeforePlay:!!t.hasAttribute("glow"),current_playlist:[],_activecue_id:null,mode_was:null,act_was:null,isController:!1,...Ft,...Wt,...Jt,...Yt,...Zt,...te,...st,...ae,translateVTT:F,planeAndPointNamesFromId:y};o.container=o.shadowId("interface"),t.CPU=o,e&&!e._CPU_planes&&(e._CPU_planes={}),o._planes={};const i=document.CPU.globalController;e&&i&&!i.audiotag&&re(e),e||(o.isController=!0,o.container.classList.add("controller"),document.CPU.globalController=o,o.audiotag=document.querySelector(a),Lt(o.audiotag)),Bt(o),o.attachAudiotagToInterface(o.audiotag),o.attributesChanges()},ie="audio";function re(t){const e=document.CPU.globalController;if(e&&!t.isEqualNode(e.audiotag)){const n=document.CPU.globalController.element.querySelector(ie);n&&(ct(n),n.remove());const a=e.focusedId();e.attachAudiotagToInterface(t),e.showMain(),e.redrawAllPlanes(),e.setMode(),ut(a)}}function se([{target:n}]){const a=i(n),o=a.element,r=o.querySelector(ie),s=document.CPU.globalController;if(!r&&o.tagName!==e)return l="<audio> element was removed.",window.console.info(`${t}▷ `,l),o.remove(),void(s&&dt());var l;o.copyAttributesToMediaDataset?.(),a.attributesChanges(),document.CPU.currentPlaylistID()===r?.dataset.playlist&&dt()}class le extends HTMLElement{constructor(){if(super(),this.CPU=null,this.observer=null,p)this.remove();else{if(this.tagName===t&&!this.querySelector(n))return h(`<${t}> tag without <audio controls>.\nRead the manual first: https://github.com/dascritch/cpu-audio/blob/master/INSTALL.md`),void this.remove();if(this.tagName===e&&document.CPU.globalController)return h(`<${e}> tag instancied twice`),void this.remove();this.shadow=this.attachShadow({mode:"open"}),this.shadow.innerHTML=`<style>:host{all:initial;display:block;contain:content}.act-buffer,.act-play{--cpu-background:var(--cpu-playing-background);--cpu-color:var(--cpu-playing-color)}.show-error{--cpu-background:var(--cpu-error-background);--cpu-color:var(--cpu-error-color)}#interface{--cpu-timeline-height:10px;background:var(--cpu-background);color:var(--cpu-color)}#interface.no{display:block;pointer-events:none}#interface.no main{visibility:hidden}#interface,*{font-family:var(--cpu-font-family);font-size:var(--cpu-font-size);font-weight:400;font-style:normal;line-height:var(--cpu-line-height);border:none;padding:0;margin:0;text-indent:0;list-style-type:none;-webkit-user-select:none;user-select:none;transition:color var(--cpu-color-transitions),background-color var(--cpu-background-transitions),opacity var(--cpu-background-transitions)}main{display:flex;overflow:hidden;height:var(--cpu-height);top:0;z-index:2}main,summary{position:sticky;background:var(--cpu-background)}a,button{color:currentColor;border:none;text-decoration:none;cursor:pointer;-webkit-touch-callout:none}button{background:0 0}svg{fill:currentColor;width:var(--cpu-height);height:var(--cpu-height)}em,i{font-style:italic}b,strong{font-weight:700}[src='']{visibility:hidden}#pageerror{padding:0 4px;align-self:center}.siders{flex:0 0 var(--cpu-height);width:var(--cpu-height);max-height:var(--cpu-height);height:100%;text-align:center;vertical-align:middle}.act-glow #play,.act-loading #loading,.act-pause #play,.act-play #pause{display:block}.act-glow #play{animation:glow 2s infinite}@keyframes glow{0%{opacity:.5}50%{opacity:1}100%{opacity:.5}}.show-main #pagemain,.show-share #pageshare{flex:1 1 100%;display:flex;align-items:center}.act-loading #loading circle{fill:#777;opacity:1;animation:pulse 2s infinite}#loading circle:nth-child(2){animation-delay:.5s}#loading circle:nth-child(3){animation-delay:1s}@keyframes pulse{50%{opacity:0}}#poster{max-width:var(--cpu-height);min-width:var(--cpu-height);max-height:var(--cpu-height);min-height:var(--cpu-height);object-fit:contain;opacity:0}.poster-loaded #poster{opacity:1}.siders svg{vertical-align:middle;max-width:100%;max-height:100%}#titleline{display:flex;align-items:center}#about,#title{flex:1 1 auto;position:relative}#title{overflow:hidden;text-overflow:'…'}#title a{display:block;max-height:calc(6px + calc(2 * var(--cpu-font-size)))}#canonical.untitled{font-style:italic}#elapse{flex:0 1 var(--cpu-elapse-width);text-align:right}.mode-compact #elapse{flex:0 0 calc(var(--cpu-elapse-width) + 32px);text-align:center}#time{background-color:#000;background-repeat:no-repeat;background-size:100% 100%;width:100%;height:var(--cpu-timeline-height);display:block;position:relative}#loadingline{background:currentColor;height:var(--cpu-timeline-height);display:block;position:absolute;left:0;pointer-events:none}#loadingline:after{content:'';position:absolute;right:0;width:0;height:var(--cpu-timeline-height);display:block;outline:var(--cpu-color) 4px solid;z-index:127;opacity:0}main:focus #loadingline:after,main:hover #loadingline:after{opacity:1}aside{position:absolute;width:100%}aside a{position:absolute;display:block}aside a span{display:none}aside.chapters{height:2px}aside.chapters a{background:var(--cpu-cue);height:2px;border:1px solid var(--cpu-background)}aside.chapters a.active-cue{background:var(--cpu-color)}aside.borders{pointer-events:none;height:var(--cpu-timeline-height);z-index:4;top:calc(var(--cpu-timeline-height) + 6px)}aside.borders a{height:var(--cpu-timeline-height);background:0 0}aside.borders a:after,aside.borders a:before{pointer-events:none;content:"";position:absolute;width:2px;height:var(--cpu-timeline-height);border:2px solid var(--cpu-timeline-limits)}aside.borders a:before{border-right-width:0;left:0}aside.borders a:after{border-left-width:0;left:100%}.act-loading #loadingline{background:repeating-linear-gradient(45deg,var(--cpu-color) 0,var(--cpu-background) 15px,var(--cpu-color) 30px);background-size:200% 200%;animation:loadingline 1s linear infinite}@keyframes loadingline{0%{background-position-y:var(--cpu-timeline-height)}}#handheld-nav{max-height:calc(6px + calc(2 * var(--cpu-font-size)));padding-bottom:8px}.show-handheld-nav #handheld-nav{display:flex}#handheld-nav *{flex:1 0 auto;height:calc(2 * var(--cpu-font-size))}.hide-actions #actions{visibility:hidden;pointer-events:none;min-width:var(--cpu-min-padding);max-width:var(--cpu-min-padding)}#pageshare{text-align:center}#pageshare a{display:flex;align-items:center;justify-content:center;height:var(--cpu-height)}#pageshare a,#pageshare div{flex:1 0;color:#fff;text-decoration:none;overflow:hidden;text-overflow:clip}#pageshare svg{vertical-align:middle;width:32px;height:32px}#twitter{background:#4db5f4}#facebook,#nativeshare{background:#5974cc}#email{background:#c00}#link{background:#77f}#popup{pointer-events:none;position:absolute;transform:translate(-25px,-19px);z-index:127;min-width:50px;font-size:11px;text-align:center;padding:2px;border-radius:4px;box-shadow:#000 2px 2px;background:var(--cpu-popup-background);color:var(--cpu-popup-color);opacity:0}#popup:before{pointer-events:none;content:"";position:absolute;z-index:127;left:20px;bottom:-8px;width:0;height:0;border-top:8px solid var(--cpu-popup-background);border-left:4px solid transparent;border-right:4px solid transparent}.panel{display:flex;list-style:none;flex-direction:column;padding:0 var(--cpu-min-padding);box-shadow:var(--cpu-inner-shadow)}summary{text-align:center;list-style-type:revert;top:var(--cpu-height);box-shadow:var(--cpu-inner-shadow);padding:4px}summary::marker{content:'⍓ '}[open]>summary::marker{content:'⍌ '}.cue{border-top:1px solid #000;display:flex;margin:0;padding:2px}.cue strong{flex:1 1;font-weight:400}.cue time{flex:0 0 var(--cpu-elapse-width) 0px;text-align:right}.nocuetime time{display:none}.cue time,aside a{font-size:var(--cpu-font-small-size)}.mode-compact{width:calc(var(--cpu-elapse-width) + var(--cpu-height) * 2 + 32px)}.mode-button{width:var(--cpu-height)}.mode-button #about,.mode-button #actions,.mode-button #poster,.mode-button .panel,.mode-button aside,.mode-compact #actions,.mode-compact #line,.mode-compact #title,.mode-compact .panel,.mode-compact aside{width:0;display:none}#control svg,#handheld-nav,#pageshare #nativeshare,.hasnativeshare #pageshare .nonativeshare,.hide-chapters .chapters,.hide-panels .panel,.hide-panels-except-play .panel,.hide-panels-title summary,.hide-poster #poster,.hide-timeline #line,.media-streamed #line,.media-streamed #link,.mode-hidden,.no,.show-error #pagemain,.show-error #pageshare,.show-error #poster,.show-error .panel,.show-handheld-nav #titleline,.show-main #pageerror,.show-main #pageshare,.show-share #pageerror,.show-share #pagemain{display:none}.hasnativeshare #pageshare #nativeshare{display:flex}.mode-compact.show-main #pagemain{flex:0 0 auto}#pageshare div:hover,.active-cue,.with-preview,a:focus,a:hover,button:focus,button:hover,summary:focus{background:var(--cpu-focus-background,var(--cpu-color))!important;color:var(--cpu-focus-color,var(--cpu-background))!important;outline:0}@media (max-width:640px){.nosmall{display:none!important}#elapse{max-height:16px}#interface{--cpu-timeline-height:8px}#handheld-nav{padding-bottom:4px}}@media (max-width:480px){.nosmaller{display:none!important}.mode-default #elapse{flex:0 1 var(--cpu-elapse-width)}.mode-default #pagemain{padding-bottom:16px}#titleline{height:32px}#line{position:absolute;left:calc(0px - var(--cpu-height));right:calc(0px - var(--cpu-height));height:16px;top:32px}aside a{pointer-events:none}aside.borders{top:-2px}aside.chapters{top:8px}#handheld-nav{padding-bottom:2px}.siders svg{height:calc(var(--cpu-height) - 16px)}}@media (max-width:320px){.mode-default #elapse,.nosmallest{display:none!important}}@media print{#interface{display:none}}@media (prefers-reduced-motion:reduce){*{animation:none!important}}</style><div id="interface"class="no"tabindex="-1"><main><img id="poster"class="nosmall"src=""alt=""loading="lazy"decoding="async"><section id="pageerror"role="alert"></section><section id="pagemain"><button type="button"id="control"tabindex="0"class="siders"><svg id="loading"viewBox="0 0 32 32"><title>${f.loading}</title><circle cx="6"cy="22"r="4"/><circle cx="16"cy="22"r="4"/><circle cx="26"cy="22"r="4"/></svg> <svg id="pause"viewBox="0 0 32 32"><title>${f.pause}</title><path d="M 6,6 12.667,6 12.667,26 6,26 z"/><path d="M 19.333,6 26,6 26,26 19.333,26 z"/></svg> <svg id="play"viewBox="0 0 32 32"><title>${f.play}</title><path d="M 6,6 6,26 26,16 z"/></svg></button><div id="about"><div id="titleline"><strong id="title"><a href="#"id="canonical"aria-label="${f.canonical}"></a></strong> <a id="elapse"aria-label="${f.moment}"tabindex="-1"><span id="currenttime">…</span><span id="totaltime"class="nosmaller"></span></a></div><div id="handheld-nav"><button type="button"id="restart"><svg viewBox="0 0 24 16"aria-hidden="true"><polygon points="4,0 8,0 8,16 4,16"/><path d="M 16,0 8,8 16,16 z"/><path d="M 24,0 16,8 24,16 z"/></svg></button> <button type="button"id="fastreward"><svg viewBox="0 0 24 16"aria-hidden="true"><path d="M 8,0 0,8 8,16 z"/><path d="M 16,0 8,8 16,16 z"/><path d="M 24,0 16,8 24,16 z"/></svg></button> <button type="button"id="reward"class="nosmallest"><svg viewBox="0 0 24 16"aria-hidden="true"><path d="M 12,0 4,8 12,16 z"/><path d="M 20,0 12,8 20,16 z"/></svg></button> <button type="button"id="foward"><svg viewBox="0 0 24 16"aria-hidden="true"><path d="M 4,0 12,8 4,16 z"/><path d="M 12,0 20,8 12,16 z"/></svg></button> <button type="button"id="fastfoward"><svg viewBox="0 0 24 16"aria-hidden="true"><path d="M 0,0 8,8 0,16 z"/><path d="M 8,0 16,8 8,16 z"/><path d="M 16,0 24,8 16,16 z"/></svg></button></div><div id="line"><div id="time"><div id="loadingline"role="progressbar"aria-labelledby="popup"></div><time id="popup">--:--</time></div></div></div><button id="actions"aria-label="${f.more}"title="${f.more}"class="siders"><svg viewBox="0 0 32 32"aria-hidden="true"><circle cx="7"cy="16"r="3"/><circle cx="16"cy="16"r="3"/><circle cx="25"cy="16"r="3"/></svg></button></section><section id="pageshare"><a href="#"target="social"id="nativeshare"aria-label="${f.share}"title="${f.share}"><svg viewBox="0 0 32 32"aria-hidden="true"><path d="M 21 0 C 18.2 0 16 2.2 16 5 C 16 5.1 16 5.2 16.0 5.2 L 8.2 9.2 C 7.3 8.4 6.2 8 5 8 C 2.2 8 0 10.2 0 13 C 0 15.8 2.2 18 5 18 C 6.2 18 7.3 17.5 8.2 16.8 L 16 20.8 C 16.0 20.8 16 20.9 16 21 C 16 23.8 18.2 26 21 26 C 23.8 26 26 23.8 26 21 C 26 18.2 23.8 16 21 16 C 19.8 16 18.7 16.4 17.8 17.2 L 10 13.3 C 10 13.2 10 13.1 10 13 C 10 12.9 10 12.8 10 12.8 L 17.8 8.8 C 18.7 9.6 19.8 10 21 10 C 23.8 10 26 7.8 26 5 C 26 2.2 23.8 0 21 0 Z"></path></svg> <span class="nosmall">${f.share}</span> </a><a href="#"target="social"id="twitter"class="nonativeshare"aria-label="${f.twitter}"title="${f.twitter}"><svg viewBox="0 0 32 32"aria-hidden="true"><path d="M 25.9,9.9 C 25.2,10.2 24.4,10.4 23.6,10.5 24.5,10 25.1,9.2 25.4,8.2 24.6,8.8 23.8,9.1 22.9,9.3 22.1,8.5 21.1,8 19.9,8 c -2.2,0 -4,1.8 -4,4 0,0 0,0.6 0.1,0.9 -3.3,-0.2 -6.3,-1.8 -8.3,-4.2 -0.3,0.6 -0.5,1.3 -0.5,2 0,1.4 0.7,2.6 1.8,3.4 -0.7,0 -1.3,-0.2 -1.8,-0.5 0,0 0,0 0,0.1 0,2 1.4,3.6 3.2,4 -0.3,0.1 -0.7,0.1 -1.1,0.1 -0.3,0 -0.5,0 -0.8,-0.1 0.5,1.6 2,2.8 3.7,2.8 -1.4,1.1 -3.1,1.7 -5,1.7 -0.3,0 -0.6,0 -1,-0.1 1.8,1.1 3.9,1.8 6.1,1.8 7.4,0 11.4,-6.1 11.4,-11.4 0,-0.2 0,-0.3 0,-0.5 0.8,-0.6 1.4,-1.3 2,-2.1 z"/></svg> <span class="nosmall">${f.twitter}</span> </a><a href="#"target="social"id="facebook"class="nonativeshare"aria-label="${f.facebook}"title="${f.facebook}"><svg viewBox="0 0 32 32"aria-hidden="true"><path d="m 21.1,16 -3.7,0 0,10 -4.3,0 0,-10 -2.1,0 0,-3.3 2.1,0 0,-2.1 c 0,-2.9 1.2,-4.6 4.7,-4.6 l 3.9,0 0,3.5 -3.2,0 c -1,0 -1.1,0.5 -1.1,1.4 l -0,1.8 4.3,0 -0.6,3.3 0,0 z"/></svg> <span class="nosmall">${f.facebook}</span> </a><a href="#"target="social"id="email"class="nonativeshare"aria-label="${f.e_mail}"title="${f.e_mail}"><svg viewBox="0 0 32 32"aria-hidden="true"><path d="m 8,9 15.9,0 c 0.3,0 0.6,0.1 0.8,0.2 l -8.8,9 -8.8,-9 c 0.3,-0.1 0.5,-0.2 0.8,-0.2 z m -2,12.3 0,-10.5 c 0,0 0,-0.1 0,-0.1 l 5.8,6 -5.8,5.1 c 0,-0.1 -0.1,-0.3 -0.1,-0.4 z m 17.9,1.8 -15.9,0 c -0.2,0 -0.3,0 -0.5,-0.1 l 5.7,-5 2.8,2.9 2.8,-2.9 5.7,5 c -0.2,0 -0.3,0.1 -0.5,0.1 z m 2,-1.8 c 0,0.2 0,0.3 -0.1,0.5 l -5.8,-5.1 5.8,-6 c 0,0 0,0.1 0,0.1 z"/></svg> <span class="nosmall">${f.e_mail}</span> </a><a href="#"target="social"download=""id="link"aria-label="${f.download}"title="${f.download}"><svg viewBox="0 0 32 32"aria-hidden="true"><path d="M 6,6 26,6 16,22 z"/><rect x="6"y="22"width="20"height="4"/></svg> <span class="nosmall">${f.download}</span> </a><a href="#"id="back"aria-label="${f.back}"title="${f.back}"><svg viewBox="0 0 32 32"aria-hidden="true"><path d="M 9,8 24,23 23,24 8,9 z"/><path d="M 9,24 24,9 23,8 8,23 z"/></svg> <span class="nosmall">${f.back}</span></a></section></main></div>`}}connectedCallback(){p||this.shadowRoot&&(new oe(this),this.observer=new MutationObserver(se),this.observer.observe(this,{childList:!0,attributes:!0}),this.CPU.attributesChanges())}disconnectedCallback(){this.observer&&(this.observer.disconnect(),this.CPU.emitEvent("removed"),this.tagName===e&&document.CPU.globalController&&(document.CPU.globalController=null))}}function ce([{target:t}]){const e=i(t);nt(e),e.completeTemplate();const n=document.CPU.globalController;e.audiotag.isEqualNode(n?.audiotag)&&(nt(n),n.completeTemplate())}class de extends le{constructor(){super(),this.audiotag=this.querySelector(n),this.audiotag?this.observer=null:this.remove()}copyAttributesToMediaDataset(){if(this.audiotag){for(const t in document.CPU.defaultDataset)if(this.hasAttribute(t)){const e=this.getAttribute(t);this.audiotag.dataset[t]="duration"!==t?e:T(e)}}else this.remove()}connectedCallback(){this.audiotag&&(this.copyAttributesToMediaDataset(),super.connectedCallback(),$t(this.CPU.audiotag),this.observer=new MutationObserver(ce),this.observer.observe(this,{childList:!0,attributes:!0,subtree:!0}),document.CPU.currentPlaylistID()===this.audiotag.dataset.playlist&&dt())}disconnectedCallback(){const t=document.CPU.globalController,e=this.audiotag.dataset.playlist;this.audiotag&&t&&this.audiotag.isEqualNode(t.audiotag)?t.element.appendChild(this.audiotag):e&&ct(this.audiotag),super.disconnectedCallback()}}const ue="script[data-cpu-audio]";const pe=async function(t,e,n){function o({target:t}){const n=T(e);document.CPU.seekElementAt(t,n);const a={target:t};t.readyState>=t.HAVE_FUTURE_DATA?i(a):t.addEventListener("canplay",i,c),_t(a)}function i(t){ft(null,t.target),n?.()}const r=""!==t?document.getElementById(t):document.querySelector(a);if(null==(r?.currentTime??null))return void h(`Unknow audiotag #${t}`);const s={target:r};if(r.readyState<r.HAVE_CURRENT_DATA)return r.addEventListener("loadedmetadata",o,c),r.load(),void _t(s);o(s)},he=function(t,e){if(!K(e)&&!V(t)){if(e=X(t,e),t.fastSeek)t.fastSeek(e);else try{const n=()=>{t.currentTime=e};t.readyState>=t.HAVE_CURRENT_DATA?n():(t.load(),n(),t.currentTime<e&&t.addEventListener("loadedmetadata",n,{once:!0}))}catch(n){t.src=`${t.currentSrc.split("#")[0]}#t=${e}`}i(t)?.updateLoading?.(e)}},me={...{playStopOthers:!0,scrollTo:!1,autoplay:!1,IDPrefix:"CPU-Audio-tag-",globalCss:!0,advanceInPlaylist:!0,keymove:5,alternateDelay:1e3,fastFactor:4,repeatDelay:400,repeatFactor:100},...function(){const t=document.head.querySelector(ue);if(!t)return{};try{return JSON.parse(t.innerHTML)}catch{return h(`invalid ${ue} parameter tag`),{}}}(),defaultDataset:jt,currentAudiotagPlaying:null,globalController:null,hadPlayed:!1,lastUsed:null,playlists:{},convert:A,trigger:xt,findCPU:i,adjacentKey:function(t,e,n){if(!t?.hasOwnProperty)return null;const a=Object.keys(t);return a[a.indexOf(e)+n]},isAudiotagPlaying:function(t){const e=document.CPU.currentAudiotagPlaying;return e&&t.isEqualNode(e)},isAudiotagGlobal:function(t){return this.globalController?t.isEqualNode(this.globalController.audiotag):this.isAudiotagPlaying(t)},jumpIdAt:pe,seekElementAt:he,currentPlaylist:function(){const t=this.globalController?.audiotag;if(!t)return[];for(const e of Object.values(this.playlists))if(e.includes(t.id))return e;return[]},currentPlaylistID:function(){const t=this.globalController?.audiotag;if(!t)return[];for(const e of Object.keys(this.playlists))if(this.playlists[e].includes(t.id))return e;return null}};async function ge(){let a;u?(a="with-webcomponents",me.globalCss&&function(){const t=document.createElement("style");t.innerHTML='audio[controls]{display:block;width:100%}:root{--cpu-height:64px;--cpu-font-family:Lato,"Open Sans","Segoe UI",Frutiger,"Frutiger Linotype","Dejavu Sans","Helvetica Neue",Arial,sans-serif;--cpu-font-size:15px;--cpu-font-small-size:calc(var(--cpu-font-size) * 0.8);--cpu-line-height:1.2;--cpu-background:#555;--cpu-color:#ddd;--cpu-playing-background:#444;--cpu-playing-color:#fff;--cpu-error-background:#a00;--cpu-error-color:#ff7;--cpu-popup-background:#aaa;--cpu-popup-color:#333;--cpu-cue:#000;--cpu-timeline-limits:#f00;--cpu-elapse-width:160px;--cpu-min-padding:16px;--cpu-inner-shadow:inset 0px 5px 10px -5px black;--cpu-color-transitions:0s;--cpu-background-transitions:0s}@media (max-width:640px){.interface,:root{--cpu-font-size:13px;--cpu-height:48px;--cpu-elapse-width:140px;--cpu-min-padding:4px}@media (max-width:480px){.interface,:root{--cpu-elapse-width:70px}}}',document.head.appendChild(t)}(),window.customElements.define(t.toLowerCase(),de),window.customElements.define(e.toLowerCase(),le)):(a="without-webcomponents",h("WebComponent may NOT behave correctly on this browser. Only timecode hash links are activated.\nSee https://github.com/dascritch/cpu-audio/ for details"),o(n,Ut)),document.body.classList.add(`cpu-audio-${a}`),window.addEventListener("hashchange",Pt,l),Pt({at_start:!0})}document.CPU||window.customElements.get(t.toLowerCase())?h("cpu-audio is called twice"):(HTMLDocument.prototype.CPU=me,document.addEventListener("DOMContentLoaded",ge,l),"loading"!==document.readyState&&ge())})();
//# sourceMappingURL=cpu-audio.js.map
// Generated theme : default

