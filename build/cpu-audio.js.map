{"version":3,"sources":["webpack://cpu-audio/./src/utils.js","webpack://cpu-audio/./src/i18n.js","webpack://cpu-audio/./src/default_dataset.js","webpack://cpu-audio/./src/convert.js","webpack://cpu-audio/./src/translate_vtt.js","webpack://cpu-audio/./src/media_element_extension.js","webpack://cpu-audio/./src/build_playlist.js","webpack://cpu-audio/./src/trigger.js","webpack://cpu-audio/./src/finger_manager.js","webpack://cpu-audio/./src/build_chapters.js","webpack://cpu-audio/./src/build_controller.js","webpack://cpu-audio/./src/element_cpu.js","webpack://cpu-audio/./src/cpu_controller.class.js","webpack://cpu-audio/./src/cpu_audio.class.js","webpack://cpu-audio/./src/default_document_cpu_parameters.js","webpack://cpu-audio/./src/document_cpu.js","webpack://cpu-audio/./src/index.js","webpack://cpu-audio/./tmp/insert_template.js"],"names":["CpuAudioTagName","CpuControllerTagName","selector_interface","acceptable_selector","selector_audio_in_component","passive_ev","passive","once_passive_ev","once","querySelector_apply","selector","callback","subtree","document","Array","from","querySelectorAll","forEach","is_decent_browser_for_webcomponents","undefined","window","customElements","absolutize_url","url","test_element","createElement","href","split","not_screen_context","matchMedia","matches","prevent_link_on_same_page","event","location","target","preventDefault","element_prevent_link_on_same_page","element","addEventListener","escape_html","text","burn_after_reading","innerText","out","innerHTML","remove","find_interface","child","closest","find_container","includes","tagName","CPU","closest_cpuaudio","parentNode","host","warn","message","console","error","sources_i18n","prefered_language","querySelector","lang","length","toLowerCase","languages","navigator","language","browserLanguage","added","line","code","__","default_dataset","domain","header_element","content","title","attr","playlist","waveform","duration","download","units_scale","d","h","m","s","scale","_is_only_numeric","_any_not_numeric","TimeInSeconds","givenTime","seconds","test","Number","convert","ColonTimeInSeconds","SubunitTimeInSeconds","SecondsInTime","givenSeconds","Infinity","converted","inned","key","hasOwnProperty","multiply","digits","Math","floor","SecondsInColonTime","IsoDuration","toUpperCase","atom","replace","atoms","pos","SecondsInPaddledColonTime","colon_time","substr","acceptables_tags","vtt_opentag","vtt_closetag","vtt_cr","not_acceptable_tag","name","opentag","tag","class_name","attribute","$_attr","trim","closetag","translate_vtt","vtt_taged","recall_stored_play","audiotag","current_audiotag_playing","is_audiotag_streamed","lasttimecode","localStorage","getItem","currentSrc","trigger","_last_play_error","seekElementAt","play","HTMLAudioElement","prototype","CPU_connected","count_element","dataset","streamed","attach_events_audiotag","play_once","ended","on","update","pause","getAttribute","preload","load","CPU_controller","this","CPU_update","controller","api","global_controller","plane_playlist","body_className_playing_cue","play_once_unlock","autoplay","_timecode_start","_timecode_end","hash_order","async","hashcode","callback_fx","at_start","hash","timecode","segments","parameter","p_key","p_value","timecode_start","timecode_end","jumpIdAt","container","is_controller","previous_playlist","current_playlist","find_current_playlist","get_plane","add_plane","track","panel","highlight","_comp","clear_plane","remove_plane","audiotag_id","add_point","getElementById","link","highlight_point","id","activecue_classname","shadowRoot","insertAdjacentElement","get_plane_panel","build_playlist","hover","offsetX","seeked_time","clientWidth","show_throbber_at","hide_throbber","throbble","at","document_CPU","is_audiotag_playing","isNaN","update_loading","expected_event","setAttribute","removeItem","document_cpu","last_used","currentTime","promised","then","had_played","catch","unlock","bind","CPU_api","glow_before_play","set_act_container","isEqualNode","attach_audiotag_to_controller","show_main","redraw_all_planes","set_mode_container","controller_switch_to","mult","altKey","ctrlKey","metaKey","shiftKey","seek_relative","hide_throbber_later","keyCode","restart","paused","keymove","keydownplay","reward","foward","fastreward","fast_factor","fastfoward","cuechange","active_cue","body_classes","body","classList","add","setItem","String","playlist_name","playlists","playlist_index","indexOf","next_id","next_audiotag","pressing","acceptable_press_actions","press_manager","clearTimeout","setTimeout","repeat","repeat_delay","repeat_factor","touching","touch_manager","show_handheld_nav","alternate_delay","plane_chapters","build_chapters","has","textTracks","chapter_track","tracks","kind","cues","cuechange_event_this","cuechange_event","removeEventListener","cue","get_point","cuepoint","startTime","end","endTime","activeCues","body_class","body_classlist","_time","Object","is","_activecue","oops","remove_highlights_points","fire_event","native_share","canonical","fetch_audiotag_dataset","share","build_controller","interface_classlist","shadowId","cliquables","time","actions","show_actions","back","poster","that","_buttons","_actions","touchstart","touchend","touchcancel","mousedown","mouseup","mouseleave","element_id","_act","press","release","timeline_element","do_events","mouseover","mousemove","mouseout","event_name","start","cancel","reposition_tracks","this_build_chapters","track_element","_CPU_load_ev","build_chapters_loader","acceptable_hide_atttributes","preview_classname","valid_id","plane_point_names_from_id","get_point_names_from_id","plane_name","point_name","match","preview_container_hover","get_point_id","is_seconds","sec","show_element","show","CPU_element_api","container_interface","element_attributes","_audiotag","mode_when_play","glow","mode_was","act_was","_CPU_planes","_planes","mode","mode_still","mode_play","hide","set_hide_container","detail","dispatchEvent","CustomEvent","bubbles","cancelable","composed","classes","act","hide_elements","container_class","hide_this","_attr","_preload","readyState","HTMLMediaElement","HAVE_CURRENT_DATA","will_act","_CPU_played","hide_panels_except_play_mark","ratio","style","width","_is_at","elapse_element","total_duration","_natural","round","_forced","duration_element","update_line","is_audiotag_global","check","error_object","error_message","pageerror","show_interface","MediaError","MEDIA_ERR_ABORTED","media_err_aborted","MEDIA_ERR_NETWORK","media_err_network","MEDIA_ERR_DECODE","media_err_decode","MEDIA_ERR_SRC_NOT_SUPPORTED","media_err_src_not_supported","media_err_unknow","update_error","update_playbutton","update_time","update_time_borders","seconds_begin","seconds_end","left","right","phylactere","opacity","position_time_element","dateTime","_hider","timepos","tag_id","_url","encodeURIComponent","_twitter","twitter","substring","src","links","facebook","email","classlist","update_links","toggle","style_key","css","remove_css","appendChild","element_canonical","untitled","backgroundImage","add_id_to_audiotag","complete_template","get_plane_track","data","remove_highlights_points_bind","assign_events_on_planes","plane_track","plane_panel","mirrored_in_controller","draw_plane","points","fromEntries","entries","plane_points","sort","point_a","point_b","keys","plane_resort","previous_element","plane_pointsnames","get_point_panel","image","use_link","plane_point_track","get_point_track","tabIndex","track_img","plane_point_panel","get_plane_nav","time_element","plane","point","data_point","element_point_track","element_point_panel","draw_point","_st_max","panel_reorder","original_data","will_refresh","values","that_start","remove_point","nav","refresh_plane","mirror","CpuControllerElement","HTMLElement","super","template","attachShadow","hasAttribute","observer_cpuaudio","media_tagname","info","copy_attributes_to_media_dataset","observer_audio","CpuAudioElement","value","connectedCallback","hidden","removeAttribute","push","connect_audiotag","MutationObserver","observe","childList","attributes","only_play_one_audiotag","advance_in_playlist","do_needle_move","secs","mocked_event","HAVE_FUTURE_DATA","do_element_play","fastSeek","e","current_audiotag","main","head","loading","moment","more","e_mail","insert_template","define","get","HTMLDocument"],"mappings":"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","file":"cpu-audio.js","sourcesContent":["/** @license\nCpu-Audio: an extension to the hash system to address timecode into audio/video elements and a player WebComponent\nVersion 6.7pre\nCopyright (C) 2014-2021 Xavier \"dascritch\" Mouton-Dubosc & contributors.\nLicense GNU GPL 3\n\n- project mini-site https://dascritch.github.io/cpu-audio/\n- project repository : https://github.com/dascritch/cpu-audio\n- use case : http://cpu.pm\n- blog post : https://dascritch.net/post/2018/11/06/Reconstruire-son-lecteur-audio-pour-le-web\n**/\n\nexport const CpuAudioTagName = 'CPU-AUDIO';\nexport const CpuControllerTagName = 'CPU-CONTROLLER';\nexport const selector_interface = '#interface';\nexport const acceptable_selector = 'audio[controls]';\nexport const selector_audio_in_component = 'cpu-audio audio'; // should be 'audio[controls]' but PHRACK APPLE !\n\n// Parameters for addEventListener\n// @private\nexport const passive_ev = {passive: true};\n// @private\nexport const once_passive_ev = {passive: true, once: true};\n\n// private,to add attributes for unnamed <audio>\n// @private\nexport const dynamically_allocated_id_prefix = 'CPU-Audio-tag-';\n\n/**\n * @summary Process a function on each matched CSS selector found in a DOM tree\n *\n * @param      {string}                selector             The css selector\n * @param      {Function}              callback             The callback function, its 1st parameter will be the matching DOM element\n * @param      {Element|HTMLDocument|ShadowRoot}  [subtree=undefined]  The subtree, by default the whole hosting document\n */\nexport function querySelector_apply(selector, callback, subtree=document) {\n\tArray.from(\n\t\tsubtree.querySelectorAll(selector)\n\t).forEach(callback);\n}\n\n/**\n * @summary Determines if the hosting browser can use webcomponents.\n *\n * @return     {boolean}  True if decent browser for webcomponents, False otherwise.\n */\nexport function is_decent_browser_for_webcomponents() {\n\treturn window.customElements !== undefined;\n}\n\n/**\n * @summary Transform a possibily relative URL to an absolute URL, including server name, but removing hash part\n *\n * @param      {string}  url     The url\n * @return     {string}  url     Absolute url\n */\nexport function absolutize_url(url) {\n\tlet test_element = document.createElement('a');\n\ttest_element.href = (typeof url !== 'string') ? url : url.split('#')[0];\n\treturn test_element.href;\n}\n\n/**\n * @summary Checks if we are in a screen context, and not a vocal or braille interface\n *\n * @return     {boolean}  False if have a screen\n */\nexport function not_screen_context() {\n\treturn !window.matchMedia('screen').matches;\n}\n\n/**\n * @summary Will prevent a link in a page if linked to the same absolute URL\n *\n * @param      {Event}  event   The event\n */\nfunction prevent_link_on_same_page(event) {\n\tif (absolutize_url(window.location.href) === absolutize_url(event.target.href)) {\n\t\tevent.preventDefault();\n\t}\n}\n\n/**\n * @summary Cancel any action on this link if its href is in this page\n *\n * @param      {Element}  element  The <A> DOM element\n */\nexport function element_prevent_link_on_same_page(element) {\n\telement.addEventListener('click', prevent_link_on_same_page);\n}\n\n/**\n * @summary Escape a text. Will truly escape HTML tags and entities. No hazardous regexes or replaces\n *\n * @param      {string}  text    The text\n * @return     {string}  HTML escaped text\n */\nexport function escape_html(text) {\n\tlet burn_after_reading = document.createElement('span');\n\tburn_after_reading.innerText = text;\n\tlet out = burn_after_reading.innerHTML;\n\tburn_after_reading.remove();\n\treturn out;\n}\n\n/**\n * @summary check if an element.id is cited in hash url\n *\n * @param      {string}   id      element id to check\n * @return     {boolean}  is in hash\n * /\nfunction id_in_hash(id) {\n\treturn location.hash.substr(1).split('&').includes(id);\n}*/\n\n\n/**\n * @summary For any ShadowDOM element, will returns its parent interface container\n * @public via document.CPU.find_interface\n *\n * @param      {Element}  child   The ShadowDOM child\n * @return     {Element}  The #interface element\n */\nexport function find_interface(child) {\n\treturn child.closest(selector_interface);\n}\n\n/**\n * @summary For any <audio> tag or its child tag or shadowDOM element, returns the element `CPU` API\n * @public via document.CPU.find_container\n *\n * @param      {Element}  child   The child\n * @return     {CPU_element_api}       Element.CPU\n */\nexport function find_container(child) {\n\tif ([CpuAudioTagName, CpuControllerTagName].includes(child.tagName)) {\n\t\treturn child.CPU;\n\t}\n\n\tlet closest_cpuaudio = child.closest(CpuAudioTagName);\n\tif (closest_cpuaudio) {\n\t\treturn closest_cpuaudio.CPU;\n\t}\n\n\treturn find_interface(child).parentNode.host.CPU;\n}\n\n\n/**\n * @summary Shortcut for console info\n *\n * @param      {string}  message  The message\n */\nexport function info(message) {\n\twindow.console.info(`${CpuAudioTagName}: `,message);\n}\n\n/**\n * @summary Shortcut for console warning\n *\n * @param      {string}  message  The message\n */\nexport function warn(message) {\n\twindow.console.warn(`${CpuAudioTagName}: `,message);\n}\n\n/**\n * @summary Shortcut for console error\n *\n * @param      {string}  message  The message\n */\nexport function error(message) {\n\twindow.console.error(`${CpuAudioTagName}: `,message);\n}\n","const sources_i18n = {\n\t'fr' : {\n\t\t'loading' : 'Chargement en cours…',\n\t\t'pause' : 'Pause',\n\t\t'play' : 'Lecture',\n\t\t'canonical' : 'Lien vers la fiche du sonore',\n\t\t'moment' : 'Lien vers ce moment',\n\n\t\t'untitled' : '(sans titre)',\n\t\t'cover' : 'pochette',\n\t\t'more' : 'Actions',\n\t\t'share' : 'Partager',\n\t\t'twitter' : 'Partager sur Twitter',\n\t\t'facebook' : 'Partager sur Facebook',\n\t\t'e_mail' : 'Partager par e-mail',\n\t\t'download' : 'Télécharger',\n\t\t'back' : 'Annuler',\n\n\t\t'chapters' : 'Chapitres',\n\t\t'playlist' : 'Playlist',\n\n\t\t'media_err_aborted' : 'Vous avez annulé la lecture.',\n\t\t'media_err_network' : 'Une erreur réseau a causé l\\'interruption du téléchargement.',\n\t\t'media_err_decode' : 'La lecture du sonore a été annulée suite à des problèmes de corruption ou de fonctionnalités non supportés par votre navigateur.',\n\t\t'media_err_src_not_supported' : 'Le sonore n\\'a pu être chargé, soit à cause de sourcis sur le serveur, le réseau ou parce que le format n\\'est pas supporté.',\n\t\t'media_err_unknow' : 'Erreur due à une raison inconnue.'\n\t},\n\t'en' : {\n\t\t'loading' : 'Loading…',\n\t\t'pause' : 'Pause',\n\t\t'play' : 'Play',\n\t\t'canonical' : 'Link to the sound\\'s page',\n\t\t'moment' : 'Link to this time',\n\n\t\t'untitled' : '(untitled)',\n\t\t'cover' : 'cover',\n\t\t'more' : 'Actions',\n\t\t'share' : 'Share',\n\t\t'twitter' : 'Share on Twitter',\n\t\t'facebook' : 'Share on Facebook',\n\t\t'e_mail' : 'Share via e-mail',\n\t\t'download' : 'Download',\n\t\t'back' : 'Back',\n\n\t\t'chapters' : 'Chapters',\n\t\t'playlist' : 'Playlist',\n\n\t\t'media_err_aborted' : 'You have aborted the play.',\n\t\t'media_err_network' : 'A network error broke the download.',\n\t\t'media_err_decode' : 'Play was canceled due to file corruption or a not supported function in your browser.',\n\t\t'media_err_src_not_supported' : 'The media cannot be downloaded due to server problems, network problems or unsupported by your browser.',\n\t\t'media_err_unknow' : 'Error of unknown cause.'\n\t},\n};\n\n\n// First, we'll try to guess the hosting page language\nexport let prefered_language = document.querySelector('html').lang;\n\nif ((!prefered_language.length) || (!(prefered_language.toLowerCase() in sources_i18n))) {\n\n\t// Inexisting ?\n\tprefered_language = 'en';\n\t// We will use english in last resort\n\n\t// trying to find the browser preferences\n\tlet languages = window.navigator.languages;\n\tlanguages = (languages !== undefined) ?\n\t\t\t\tlanguages :\n\t\t\t\t[(navigator.language || navigator.browserLanguage)];\n\tlet added = false;\n\tfor (let line of languages) {\n\t\tif (line.split) {\n\t\t\t// we will only look (yes, this is bad) at the first level xx of any locale xx-YY code\n\t\t\tlet code = line.split('-')[0];\n\t\t\tif ( (!added) && (code in sources_i18n)) {\n\t\t\t\t// we still don't have a locale selected and this one is in our register, we can use it\n\t\t\t\tprefered_language = code;\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport const __ = sources_i18n[prefered_language];\n","export const default_dataset = {\n\tget title() {\n\t\tfor (const domain of ['og', 'twitter']) {\n\t\t\tconst header_element = document.querySelector(`meta[property=\"${domain}:title\"]`);\n\t\t\tif (header_element) {\n\t\t\t\treturn header_element.content;\n\t\t\t}\n\t\t}\n\t\tconst title = document.title;\n\t\treturn title === '' ? null : title;\n\t},\n\tget poster() {\n\t\tfor (const attr of ['property=\"og:image\"', 'name=\"twitter:image:src\"']) {\n\t\t\tconst header_element = document.querySelector(`meta[${attr}]`);\n\t\t\tif (header_element) {\n\t\t\t\treturn header_element.content;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t},\n\tget canonical() {\n\t\tconst header_element = document.querySelector('link[rel=\"canonical\"]');\n\t\tif (header_element) {\n\t\t\treturn header_element.href;\n\t\t}\n\t\treturn location.href.split('#')[0];\n\t},\n\tget twitter() {\n\t\tconst header_element = document.querySelector('meta[name=\"twitter:creator\"]');\n\t\tif ((header_element) && (header_element.content.length > 1)) {\n\t\t\treturn header_element.content;\n\t\t}\n\t\treturn null;\n\t},\n\tplaylist : null,\n\twaveform : null,\n\tduration : null,\n\tdownload : null\n};","const units_scale = {\n\td : 86400,\n\th : 3600,\n\tm : 60,\n\ts : 1\n};\nlet scale = [1, 60, 3600, 86400];\n\nconst _is_only_numeric = /^\\d+$/;\nconst _any_not_numeric = /\\D*/g;\n\n// How Inifity (streamed live media with unspecified duration) should be humanly expressed\nconst Infinity_representation = '?';\n\n/**\n * @summary convert a string empty, with a number, with a colon-coded or an human-coded timecode in seconds\n * @public\n *\n * @class      TimeInSeconds (name)\n * @param      {string}  givenTime  The given time\n * @return     {number}  time in seconds\n */\nexport const TimeInSeconds = function(givenTime) {\n\tlet seconds = 0;\n\tif (givenTime !== '') {\n\t\tif (_is_only_numeric.test(givenTime)) {\n\t\t\tseconds = Number(givenTime);\n\t\t} else {\n\t\t\tseconds = givenTime.includes(':') ?\n\t\t\t\tconvert.ColonTimeInSeconds(givenTime) :\n\t\t\t\tconvert.SubunitTimeInSeconds(givenTime) ;\n\t\t}\n\t}\n\treturn seconds;\n};\n\n/**\n * @summary convert a human-coded (`1h2m3s`) time in seconds\n * @public\n *\n * @class      SubunitTimeInSeconds (name)\n * @param      {string}  givenTime  The given time\n * @return     {number}  seconds\n */\nexport const SubunitTimeInSeconds = function(givenTime) {\n\tlet seconds = 0;\n\tlet atom;\n\tfor(let key in units_scale) {\n\t\tif ( (units_scale.hasOwnProperty(key)) && (givenTime.includes(key)) ) {\n\t\t\t[atom, givenTime] = givenTime.split(key);\n\t\t\tseconds += Number(atom.replace(_any_not_numeric,'' )) * units_scale[key];\n\t\t}\n\t}\n\treturn seconds;\n};\n\n/**\n * @summary    convert a colon-coded (`01:02:03`) time in seconds\n * @public\n *\n * @class      ColonTimeInSeconds (name)\n * @param      {string}  givenTime  The given time\n * @return     {number}  Time in seconds\n */\nexport const ColonTimeInSeconds = function(givenTime) {\n\tlet seconds = 0;\n\tlet atoms = givenTime.split(':');\n\tfor (let pos = 0 ; pos < atoms.length ; pos++) {\n\t\tseconds += Number(atoms[pos]) * scale[((atoms.length-1) - pos)];\n\t}\n\treturn seconds;\n};\n\n/**\n * @summary convert a time in seconds in a human-coded time (`1h2m3s`). Zero is `0s`.\n * @public\n *\n * @class      SecondsInTime (name)\n * @param      {number}   givenSeconds  The given seconds\n * @return     {string}   Converted time\n */\nexport const SecondsInTime = function(givenSeconds) {\n\tif (givenSeconds === Infinity) {\n\t\treturn Infinity_representation;\n\t}\n\tlet converted = '';\n\tlet inned = false;\n\tfor (let key in units_scale) {\n\t\tif (units_scale.hasOwnProperty(key)) {\n\t\t\tlet multiply = units_scale[key];\n\t\t\tif ((givenSeconds >= multiply) || (inned)) {\n\t\t\t\tinned = true;\n\t\t\t\tlet digits = Math.floor(givenSeconds / multiply);\n\t\t\t\tconverted += digits + key;\n\t\t\t\tgivenSeconds -= digits * multiply;\n\t\t\t}\n\t\t}\n\t}\n\treturn converted === '' ? '0s' : converted;\n};\n\n/**\n * @summary    convert a time in seconds in a colon-coded time (`1:02:03s`). Zero is `0:00`.\n * @public\n *\n * @class      SecondsInColonTime (name)\n * @param      {number}          givenSeconds  The given seconds\n * @return     {string}  Converted time\n */\nexport const SecondsInColonTime = function(givenSeconds) {\n\tif (givenSeconds === Infinity) {\n\t\treturn Infinity_representation;\n\t}\n\tlet converted = '';\n\tlet inned = false;\n\tfor (let key in units_scale) {\n\t\tif (units_scale.hasOwnProperty(key)) {\n\t\t\tlet multiply = units_scale[key];\n\t\t\tif ((givenSeconds >= multiply) || (inned)) {\n\t\t\t\tinned = true;\n\t\t\t\tlet digits = Math.floor(givenSeconds / multiply);\n\t\t\t\tconverted += (converted === '' ? '' : ':');\n\t\t\t\tconverted += ( ((digits<10) && (converted !== '')) ? '0' : '') + digits ;\n\t\t\t\tgivenSeconds -= digits * multiply;\n\t\t\t}\n\t\t}\n\t}\n\tif (converted.length === 1) {\n\t\t// between 0 and 9 seconds\n\t\treturn `0:0${converted}`;\n\t}\n\tif (converted.length === 2) {\n\t\t// between 10 and 59 seconds\n\t\treturn `0:${converted}`;\n\t}\n\n\treturn converted === '' ? '0:00' : converted;\n};\n\n/**\n * @summary same as `SecondsInColonTime`, but suited for `<input type=\"time\"\n * />`. Zero is `00:00:00`.\n *\n * @public\n *\n * @class      SecondsInPaddledColonTime (name)\n * @param      {number}  givenSeconds  The given seconds\n * @return     {string}  Converted time\n */\nexport const SecondsInPaddledColonTime = function(givenSeconds) {\n\tif (givenSeconds === Infinity) {\n\t\treturn Infinity_representation;\n\t}\n\t// principaly needed by <input type=\"time\"> whom needs a really precise HH:MM:SS format\n\tlet colon_time = convert.SecondsInColonTime(givenSeconds);\n\treturn '00:00:00'.substr(0, 8 - colon_time.length ) + colon_time;\n};\n\n/**\n * @summary convert a duration in an ISO 8601 string suitable for `datetime=\"\"` attribute in <time>\n * See spec in https://www.w3.org/TR/html51/infrastructure.html#durations\n * @public\n *\n * @class      IsoDuration (name)\n * @param      {number}  givenSeconds  Duration, in seconds\n * @return     {string}  Converted duration\n */\nexport const IsoDuration = function(givenSeconds) {\n\treturn `P${convert.SecondsInTime(givenSeconds).toUpperCase()}`;\n};\n\nexport const convert = {\n\tTimeInSeconds,\n\tSubunitTimeInSeconds,\n\tColonTimeInSeconds,\n\tSecondsInTime,\n\tSecondsInColonTime,\n\tSecondsInPaddledColonTime,\n\tIsoDuration\n};\n","import {escape_html} from './utils.js';\n\nlet acceptables_tags = {\n\t'i'     : 'i',\n\t'em'    : 'em', // (not in the standard but used in legacy CPU.pm show)\n\t'b'     : 'b',\n\t'bold'  : 'strong', // (declared in the MDN page, but never saw it in standard pages)\n\t'u'     : 'u',\n\t'lang'  : 'i' // emphasis for typographic convention\n};\n\n/**\n *\n * NEVER EVER BELIEVE you can parse HTML with regexes ! This function works because we just do minimalistic changes\n * By the way, regexes are really time consuming, both for you and your computer.\n * And, sincerely, I love playing on https://regexcrossword.com/\n */\n\n// regexes used for WebVTT tag validation\nconst vtt_opentag = /<(\\w+)(\\.[^>]+)?( [^>]+)?>/gi;\nconst vtt_closetag = /<\\/(\\w+)( [^>]*)?>/gi;\nconst vtt_cr = /\\n/gi;\n\n/**\n * Checks if a WebVTT candidate tag name is acceptable or not\n *\n * @param      {string}  name    Tag name\n * @return     {boolean}  not accepted (inverted logic)\n */\nfunction not_acceptable_tag(name) {\n\treturn !(name in acceptables_tags);\n}\n\n/**\n * @param      {string}   \t\t   tag \t\t\tUnused regex capture\n * @param      {string}   \t\t   name \t\tName of the tag\n * @param      {string}   \t\t   class_name \tattribute key, unused\n * @param      {string}   \t\t   attribute \tattribute value, may be language code\n * @return     {string}\n */\nfunction opentag(tag, name, class_name, attribute) {\n\tname = name.toLowerCase();\n\tif (not_acceptable_tag(name)) {\n\t\treturn '';\n\t}\n\tlet $_attr = '';\n\tif (name === 'lang') {\n\t\t$_attr = ` lang=\"${attribute.trim()}\"`;\n\t}\n\treturn `<${acceptables_tags[name]}${$_attr}>`;\n}\n\n/**\n * @param      {string}   \t\t   tag \t\t\tUnused regex capture\n * @param      {string}   \t\t   name \t\tName of the tag\n * @return     {string}\n */\nfunction closetag(tag, name) {\n\tname = name.toLowerCase();\n\tif (not_acceptable_tag(name)) {\n\t\treturn '';\n\t}\n\treturn `</${acceptables_tags[name]}>`;\n}\n\n/**\n * @summary Transform WebVTT tag langage into HTML tags, filtering out some\n * (needed @public mainly for tests. Moving it up and do those tests in CLI will make it @private-izable)\n *\n * @param      {string}            vtt_taged  The vtt tagged\n * @return     string                         HTML tagged string\n */\nexport function translate_vtt(vtt_taged) {\n\n\tif ((vtt_taged.split('<').length) !== (vtt_taged.split('>').length)) {\n\t\t// unmatching < and >, probably badly written tags, or in full text\n\t\t// unsurprisingly, (vtt_taged.split('<').length) is a lot faster than using regex. JS needs a standard property for counting substring occurences in a string\n\t\treturn escape_html(vtt_taged);\n\t}\n\n\treturn vtt_taged.\n\t\t\treplace(vtt_opentag, opentag).\n\t\t\treplace(vtt_closetag, closetag).\n\t\t\treplace(vtt_cr, '<br/>');\n}\n","import {CpuAudioTagName, dynamically_allocated_id_prefix, is_decent_browser_for_webcomponents, passive_ev} from './utils.js';\n\nimport {trigger} from './trigger.js';\n\n// Indicate if media element was extended\nHTMLAudioElement.prototype.CPU_connected = false;\n\n/**\n * @summary At start, will start the last playing <audio> tag at its last known position\n *\n * @param      {Object}  event   The event\n */\nfunction recall_stored_play(event) {\n\tlet audiotag = event.target;\n\tif ((document.CPU.current_audiotag_playing !== null) || (is_audiotag_streamed(audiotag))) {\n\t\treturn;\n\t}\n\tlet lasttimecode = Number(window.localStorage.getItem(audiotag.currentSrc));\n\t// TODO and no hashed time\n\tif ((lasttimecode > 0) && (!trigger._last_play_error)) {\n\t\tdocument.CPU.seekElementAt(audiotag, lasttimecode);\n\t\ttrigger.play(undefined, audiotag);\n\t}\n}\n\n// used for add_id_to_audiotag , when tag was not named in HTML or DOM\nlet\tcount_element = 0;\n\n/**\n * @summary Adds an identifier to audiotag at build time.\n * @private\n */\nexport function\tadd_id_to_audiotag(audiotag) {\n\taudiotag.id = audiotag.id || `${dynamically_allocated_id_prefix}${count_element++}`;\n}\n\n\n/**\n * @summary Determines if audiotag source is streamed, and so unactivate reposition, position memory, length display…\n *\n * @param      {HTMLAudioElement|null}  audiotag  The audiotag\n * @return     {boolean}            \tTrue if audiotag streamed, False otherwise.\n */\nexport function is_audiotag_streamed(audiotag) {\n\treturn ((audiotag === null) || (audiotag.duration === Infinity) || (audiotag.dataset.streamed !== undefined));\n}\n\n/**\n * @summary Attach events on a <audio> tag\n *\n * @param      {HTMLAudioElement}  audiotag  The audiotag\n */\nexport function attach_events_audiotag(audiotag) {\n\taudiotag.addEventListener('loadedmetadata', recall_stored_play, passive_ev);\n\taudiotag.addEventListener('play', trigger.play_once, passive_ev);\n\taudiotag.addEventListener('ended', trigger.ended, passive_ev);\n\t// those ↓ for PHRACKING SAFARI\n\taudiotag.addEventListener('ready', recall_stored_play, passive_ev);\n\taudiotag.addEventListener('canplay', recall_stored_play, passive_ev);\n\n\t// see https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Media_events for list of events\n\t[\n\t\t'ready', 'load', 'loadeddata', 'canplay', 'abort',\n\t\t'error', 'emptied',\n\t\t'play', 'playing', 'pause', 'ended',\n\t\t'durationchange',  'loadedmetadata', 'timeupdate', 'waiting'\n\t].forEach( (on) => {\n\t\taudiotag.addEventListener(on, trigger.update, passive_ev);\n\t});\n\n\tif (!is_decent_browser_for_webcomponents()) {\n\t\t// in case we are in legacy mode\n\t\t[\n\t\t\t'pause', 'ended'\n\t\t].forEach( (on) => {\n\t\t\taudiotag.addEventListener(on, trigger.pause, passive_ev);\n\t\t});\n\t}\n\n\t// ask ASAP metadata about media\n\tif (audiotag.getAttribute('preload') === '') {\n\t\taudiotag.preload = 'metadata';\n\t\taudiotag.load();\n\t}\n}\n\n/**\n * @summary Connects an audiotag to CPU APIs, launched at start or when the webcomponent appears\n *\n * @param      {HTMLAudioElement}  audiotag  The audiotag\n */\nexport function connect_audiotag(audiotag) {\n\tif (audiotag.CPU_connected) {\n\t\treturn;\n\t}\n\taudiotag.CPU_connected = true;\n\n\tattach_events_audiotag(audiotag);\n\n\t// hide native controls\n\taudiotag.hidden = true;\n\t// PHRACK SAFARI\n\taudiotag.removeAttribute('controls');\n\n\t// playlist\n\tif (typeof(audiotag.dataset.playlist) === 'string') {\n\t\tlet playlist_name = audiotag.dataset.playlist;\n\t\tif (!(playlist_name in document.CPU.playlists)) {\n\t\t\tdocument.CPU.playlists[playlist_name] = [];\n\t\t}\n\t\t// TODO do not rerecord id if already in this playlist. Remove from other playlists\n\t\t// TODO LATER, remove id when cpu-audio or audiotag removed\n\t\tdocument.CPU.playlists[playlist_name].push(audiotag.id);\n\t}\n}\n\n\n/**\n * @summary Return the parent <cpu-audio> DOM element\n *\n * @class      CPU_controller (name)\n * @return     {Element}  <cpu-audio> DOM element\n */\nHTMLAudioElement.prototype.CPU_controller = function() {\n\treturn this.closest(CpuAudioTagName);\n};\n\n/**\n * @summary Trigger display updates in the interface\n *\n * @class      CPU_update (name)\n */\nHTMLAudioElement.prototype.CPU_update = function() {\n\tlet controller = this.CPU_controller();\n\tif (controller) {\n\t\tlet api = controller.CPU;\n\t\tif ((api) && (api.update)) {\n\t\t\t// i don't like try catch\n\t\t\tapi.update();\n\t\t}\n\t}\n\tif (document.CPU.global_controller !== null) {\n\t\tdocument.CPU.global_controller.update();\n\t}\n};\n","import {__} from './i18n.js';\nimport {activecue_classname} from './element_cpu.js';\n\n// plane for _playlist. Only used in <CPU-Controller>\nconst plane_playlist = '_playlist';\n\n/**\n * @summary Builds or refresh the playlist panel.\n Should be called only for <cpu-controller>\n * @private was public\n *\n * @param      {Object}  \t\t\tcontainer  <cpu-controller>.CPU\n *\n */\nexport function build_playlist(container) {\n\tif (!container.is_controller) {\n\t\t// Note that ONLY the global controller will display the playlist. For now.\n\t\treturn;\n\t}\n\n\tlet previous_playlist = container.current_playlist;\n\tcontainer.current_playlist = document.CPU.find_current_playlist();\n\n\tif (! container.get_plane(plane_playlist)) {\n\t\tcontainer.add_plane(plane_playlist, __['playlist'], {\n\t\t\ttrack \t\t: false,\n\t\t\tpanel \t\t: 'nocuetime',\n\t\t\thighlight \t: true,\n\t\t\t_comp \t\t: true \t\t\t\t// data stored on CPU-Controller ONLY\n\t\t});\n\t}\n\n\tif (previous_playlist !== container.current_playlist) {\n\t\tcontainer.clear_plane(plane_playlist);\n\n\t\tif (container.current_playlist.length === 0) {\n\t\t\t// remove plane to hide panel. Yes, overkill\n\t\t\tcontainer.remove_plane(plane_playlist);\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let audiotag_id of container.current_playlist) {\n\t\t\t// TODO : when audiotag not here, do not add point\n\t\t\tcontainer.add_point(plane_playlist, 0, audiotag_id, {\n\t\t\t\ttext : document.getElementById(audiotag_id)?.dataset.title, \n\t\t\t\tlink : `#${audiotag_id}&t=0`\n\t\t\t});\n\t\t}\n\t}\n\n\tcontainer.highlight_point(plane_playlist, container.audiotag.id, activecue_classname);\n\n\t// move _playlist on top. Hoping it will insert it RIGHT AFTER the main element.\n\tcontainer.element.shadowRoot.querySelector('main').insertAdjacentElement(\n\t\t'afterend', container.get_plane_panel(plane_playlist) );\n}","import {once_passive_ev, find_container, warn} from './utils.js';\nimport {is_audiotag_streamed} from './media_element_extension.js';\nimport {TimeInSeconds} from './convert.js';\nimport {build_playlist} from './build_playlist.js';\n\nconst KEY_LEFT_ARROW = 37;\nconst KEY_RIGHT_ARROW = 39;\n\nlet NotAllowedError = 'Auto-play prevented : Browser requires a manual interaction first.';\nlet NotSupportedError = 'The browser refuses the audio source, probably due to audio format.';\n\n// actual active elements\n// @type {string|null}\nlet\tbody_className_playing_cue = null;\n\n\n/**\n * @summary If audio position out of begin/end borders, remove borders\n * @private\n *\n * @param      {number}  at      timecode position\n */\nfunction remove_timecode_outofborders(at) {\n\tif (\n\t\t(at < trigger._timecode_start)\n\t\t|| ((trigger._timecode_end !== false) && (at > trigger._timecode_end)) ) {\n\t\ttrigger._timecode_start = 0;\n\t\ttrigger._timecode_end = false;\n\t}\n}\n\n/**\n * @summary If playing media was prevented by browser due to missing focus, event on focus does unlock player\n * @private\n *\n * @param      {Object|undefined}  event   Unlocking event\n */\nfunction play_once_unlock(event, audiotag) {\n\ttrigger._last_play_error = false;\n\tif (document.CPU.autoplay) {\n\t\ttrigger.play(event, audiotag);\n\t}\n}\n\n/**\n * @summary When a <cpu-audio> plays, attach it to the eventual <cpu-controller>\n * @private\n *\n * @param      {audiotag}  HTMLAudioElement   The playing <audio> tag\n */\nfunction controller_switch_to(audiotag) {\n\tlet global_controller = document.CPU.global_controller;\n\tif (!global_controller) {\n\t\treturn;\n\t}\n\tif  (!audiotag.isEqualNode(global_controller.audiotag)) {\n\t\tglobal_controller.attach_audiotag_to_controller(audiotag);\n\t\tglobal_controller.audiotag = audiotag;\n\t\tglobal_controller.show_main();\n\t\tglobal_controller.redraw_all_planes();\n\t\tglobal_controller.set_mode_container(); \t// to switch back the display between streamed/not-str medias\n\t}\n\tglobal_controller.build_playlist();\n}\n\nexport const trigger = {\n\n\t// @private   MAY GO OUT OF THIS OBJECT IF NOT TESTED OUTSIDE\n\t_timecode_start : 0,\n\t// @private   MAY GO OUT OF THIS OBJECT IF NOT TESTED OUTSIDE\n\t_timecode_end : false,\n\n\t// @private   MAY GO OUT OF THIS OBJECT IF NOT TESTED OUTSIDE\n\t_last_play_error : false,\n\n\t/**\n\t * @summary    Interprets the hash part of the URL, when loaded or changed\n\t * @package\n\t *\n\t * still exposed in public for tests\n\t *\n\t * @param      {string|Object}  hashcode     Called hashcode\n\t * @param      {Function}       callback_fx  When done, call a function to end the tests (optional).\n\t */\n\thash_order : async function(hashcode, callback_fx=undefined) {\n\t\tlet at_start = true;\n\t\tif (typeof hashcode !== 'string') {\n\t\t\tat_start = 'at_start' in hashcode;\n\t\t\thashcode = location.hash.substr(1);\n\t\t}\n\t\tlet hash = '';\n\t\tlet timecode = '';\n\t\tlet segments = hashcode.split('&');\n\t\tlet autoplay = false;\n\n\t\tfor (let parameter of segments) {\n\t\t\tif ((!parameter.includes('=')) && (hash === '')) {\n\t\t\t\t// should reference to the ID of the element\n\t\t\t\thash = parameter;\n\t\t\t} else {\n\t\t\t\t// should be a key=value parameter\n\t\t\t\tlet [p_key, p_value] = parameter.split('=');\n\t\t\t\tswitch (p_key) {\n\t\t\t\t\tcase 't':\n\t\t\t\t\t\t// is a time index\n\t\t\t\t\t\ttimecode = p_value || '0';\n\t\t\t\t\t\t// we make autoplay at requested timecode, simplier of the user\n\t\t\t\t\t\tautoplay = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'autoplay':\n\t\t\t\t\t\t// is a card from a social network, run now\n\t\t\t\t\t\tautoplay = p_value === '1';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'auto_play':\n\t\t\t\t\t\t// is a card from a social network, run now\n\t\t\t\t\t\tautoplay = p_value === 'true';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ((timecode === '') || ((at_start) && (!autoplay))) {\n\t\t\t// this is a normal anchor call. Go back to normal behaviour\n\t\t\tcallback_fx?.();\n\t\t\treturn /* false */;\n\t\t}\n\n\t\t// we may have a begin,end notation\n\t\tlet [timecode_start, timecode_end] = timecode.split(',');\n\t\ttrigger._timecode_start = TimeInSeconds(timecode_start);\n\t\ttrigger._timecode_end = timecode_end !== undefined ? TimeInSeconds(timecode_end) : false;\n\t\tif (trigger._timecode_end !== false) {\n\t\t\ttrigger._timecode_end = (trigger._timecode_end > trigger._timecode_start) ?\n\t\t\t\ttrigger._timecode_end :\n\t\t\t\tfalse;\n\t\t}\n\n\t\tawait document.CPU.jumpIdAt(hash, timecode_start, callback_fx);\n\n\t\t// not in document.CPU (yet) to avoid unuseful repaint\n\t\tlet global_controller = document.CPU.global_controller;\n\t\tif (global_controller) {\n\t\t\tbuild_playlist(global_controller);\n\t\t}\n\t\t// scroll to the audio element. Should be reworked, or parametrable , see issue #60\n\t\t// window.location.hash = `#${hash}`;\n\t},\n\n\t/**\n\t * @summary Update throbber position when hovering the timeline interface\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\thover : function({target, offsetX}) {\n\t\tlet container = find_container(target);\n\t\tlet ratio = offsetX / target.clientWidth;\n\t\tlet seeked_time = ratio * container.audiotag.duration;\n\t\tcontainer.show_throbber_at(seeked_time);\n\t},\n\n\t/**\n\t * @summary Hide the throbber when leaving the timeline interface\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\tout : function({target}) {\n\t\tfind_container(target).hide_throbber();\n\t},\n\n\t/**\n\t * @summary Change play position of a audio tag\n\t *\n\t * @param      {Object}  event   The event, may be mocked\n\t */\n\tthrobble : function(event) {\n\t\tlet at = 0;\n\t\tlet {target, offsetX} = event;\n\t\tlet document_CPU = document.CPU;\n\t\tlet audiotag = find_container(target).audiotag;\n\n\t\tif (audiotag.duration === Infinity) {\n\t\t\t// CAVEAT : we may have improper duration due to a streamed media\n\t\t\ttrigger.play(event);\n\t\t\treturn ;\n\t\t}\n\n\t\tif ((document_CPU.current_audiotag_playing) && (!document_CPU.is_audiotag_playing(audiotag))) {\n\t\t\t// Chrome needs to STOP any other playing tag before seeking\n\t\t\t//  Very slow seeking on Chrome #89\n\t\t\ttrigger.pause(undefined, document_CPU.current_audiotag_playing);\n\t\t}\n\n\t\tif ((isNaN(audiotag.duration)) && (!is_audiotag_streamed(audiotag))) {\n\t\t\t// Correct play from position on the timeline when metadata not preloaded #88\n\n\t\t\t// indicate we are loading something\n\t\t\tlet controller = audiotag.CPU_controller();\n\t\t\tif ((controller) && (controller.update_loading)) {\n\t\t\t\tcontroller.update_loading(undefined, 100 * offsetX  / target.clientWidth);\n\t\t\t}\n\n\t\t\tlet expected_event = 'loadedmetadata';\n\t\t\taudiotag.addEventListener(\n\t\t\t\texpected_event,\n\t\t\t\t() => {trigger.throbble({offsetX, target});},\n\t\t\t\tonce_passive_ev);\n\t\t\t// loading metadata. May not work on Apples\n\t\t\taudiotag.setAttribute('preload', 'metadata');\n\t\t\treturn ;\n\t\t}\n\n\t\t// We know the media length, normal execution\n\t\tif (event.at !== undefined) {\n\t\t\tat = event.at;\n\t\t} else {\n\t\t\t// normal usage, via an event\n\t\t\tlet ratio = event.offsetX / target.clientWidth;\n\t\t\tat = ratio * audiotag.duration;\n\t\t}\n\t\tdocument_CPU.seekElementAt(audiotag, at);\n\t\ttrigger.play(event);\n\t},\n\n\t/**\n\t * @summary    Do pause\n\t *\n\t * @param      {Object|undefined}   event     The event, may be omitted\n\t * @param      {Element|undefined}  audiotag  The audiotag, may be omitted\n\t */\n\tpause : function(event=undefined, audiotag=undefined) {\n\t\tif (!audiotag) {\n\t\t\tlet {target} = event;\n\t\t\taudiotag = (target.tagName === 'AUDIO') ? target : find_container(target).audiotag;\n\t\t}\n\t\taudiotag.pause();\n\t\tdocument.CPU.current_audiotag_playing = null;\n\t\twindow.localStorage.removeItem(audiotag.currentSrc);\n\t},\n\n\t/**\n\t * @summary    Change referenced playing audio, pause the previous one\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\tplay_once : function({target}) {\n\t\tlet document_cpu = document.CPU;\n\t\t// target, aka audiotag\n\t\tdocument.CPU.last_used = target;\n\n\t\tif ( \n\t\t\t(document_cpu.only_play_one_audiotag) && \n\t\t\t(document_cpu.current_audiotag_playing) && \n\t\t\t(!document_cpu.is_audiotag_playing(target)) \n\t\t\t) {\n\t\t\ttrigger.pause(undefined, document_cpu.current_audiotag_playing);\n\t\t}\n\t\tdocument_cpu.current_audiotag_playing = target;\n\t},\n\n\t/**\n\t * @summary    Do play an audio tag\n\t *\n\t * @param      {Object|undefined}   event     The event, may be mocked or ommitted\n\t * @param      {Element|undefined}  audiotag  The audiotag\n\t */\n\tplay : function(event=undefined, audiotag=undefined) {\n\t\tif ( (!event) && (trigger._last_play_error)) {\n\t\t\twarn(`play() prevented because already waiting for focus`);\n\t\t\treturn;\n\t\t}\n\t\taudiotag = audiotag ?? find_container(event.target).audiotag;\n\n\t\ttrigger._last_play_error = false;\n\t\tremove_timecode_outofborders(audiotag.currentTime);\n\n\t\tlet promised = audiotag.play();\n\n\t\tif (promised) {\n\t\t\tpromised.then(\n\t\t\t\t() => {\n\t\t\t\t\t// we have a successful play occured, we can display wait event later\n\t\t\t\t\tdocument.CPU.had_played = true;\n\t\t\t\t}\n\t\t\t).catch(\n\t\t\t\terror => {\n\t\t\t\t\ttrigger._last_play_error = true;\n\t\t\t\t\tlet unlock = play_once_unlock.bind(this, audiotag);\n\t\t\t\t\tswitch (error.name) {\n\t\t\t\t\t\tcase 'NotAllowedError':\n\t\t\t\t\t\t\twarn(NotAllowedError);\n\t\t\t\t\t\t\tdocument.addEventListener('focus', unlock, once_passive_ev);\n\t\t\t\t\t\t\tdocument.addEventListener('click', unlock, once_passive_ev);\n\n\t\t\t\t\t\t\tif (audiotag.CPU_connected) {\n\t\t\t\t\t\t\t\tlet CPU_api = audiotag.CPU_controller().CPU;\n\t\t\t\t\t\t\t\tCPU_api.glow_before_play = true;\n\t\t\t\t\t\t\t\tCPU_api.set_act_container('glow');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'NotSupportedError':\n\t\t\t\t\t\t\terror(NotSupportedError);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\tcontroller_switch_to(audiotag);\n\t},\n\n\t/**\n\t * @summary Interprets pressed key\n\t *\n\t * @param      {Object}  event   The event\n\t * @param      {number}  mult    Multiply the keypressed act, 1 by default\n\t */\n\tkey : function(event, mult=1) {\n\t\t// do not interpret key when there is a modifier, for not preventing browsers shortcurs\n\t\tif (event.altKey || event.ctrlKey || event.metaKey || event.shiftKey) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet container = find_container(event.target);\n\t\tlet audiotag = container.audiotag;\n\n\t\t/** @param      {number}  seconds    Relative position fowards */\n\t\tfunction seek_relative(seconds) {\n\t\t\tevent.at = container.audiotag.currentTime + seconds;\n\t\t\tcontainer.show_throbber_at(event.at);\n\t\t\ttrigger.throbble(event);\n\t\t\tcontainer.hide_throbber_later();\n\t\t}\n\n\t\tswitch (event.keyCode) {\n\t\t\t// can't use enter : standard usage\n\t\t\tcase 27 : // esc\n\t\t\t\ttrigger.restart(event);\n\t\t\t\ttrigger.pause(undefined, audiotag);\n\t\t\t\tbreak;\n\t\t\tcase 32 : // space\n\t\t\t\taudiotag.paused ?\n\t\t\t\t\ttrigger.play(event, audiotag) :\n\t\t\t\t\ttrigger.pause(undefined, audiotag);\n\t\t\t\tbreak;\n\t\t\tcase 35 : // end\n\t\t\t\tdocument.CPU.seekElementAt(audiotag, audiotag.duration);\n\t\t\t\tbreak;\n\t\t\tcase 36 : // home\n\t\t\t\ttrigger.restart(event);\n\t\t\t\tbreak;\n\t\t\tcase KEY_LEFT_ARROW : // ←\n\t\t\t\tseek_relative(- (document.CPU.keymove * mult));\n\t\t\t\tbreak;\n\t\t\tcase KEY_RIGHT_ARROW : // →\n\t\t\t\tseek_relative(+ (document.CPU.keymove * mult));\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn ;\n\t\t}\n\t\tevent.preventDefault();\n\t},\n\n\t/**\n\t * @summary Interprets keypress on the play/pause button\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\tkeydownplay : function(event) {\n\t\tif (event.keyCode === 13) {\n\t\t\treturn;\n\t\t}\n\t\tlet container = find_container(event.target);\n\t\tlet audiotag = container.audiotag;\n\n\t\taudiotag.paused ?\n\t\t\ttrigger.play(undefined, audiotag) :\n\t\t\ttrigger.pause(undefined, audiotag);\n\t\tevent.preventDefault();\n\t},\n\n\t/**\n\t * @summary Pressing restart button, Rewind at start the audio tag\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\trestart : function({target}) {\n\t\tlet container = find_container(target);\n\t\tdocument.CPU.seekElementAt(container.audiotag, 0);\n\t},\n\t/**\n\t * @summary Pressing reward button\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\treward : function(event) {\n\t\tevent.keyCode = KEY_LEFT_ARROW;\n\t\ttrigger.key(event);\n\t},\n\t/**\n\t * @summary Pressing foward button\n\t * Function associated, see below, DO NOT RENAME\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\tfoward : function(event) {\n\t\tevent.keyCode = KEY_RIGHT_ARROW;\n\t\ttrigger.key(event);\n\t},\n\t/**\n\t * @summary Pressing fastreward button\n\t * Function associated, see below, DO NOT RENAME\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\tfastreward : function(event) {\n\t\tevent.keyCode = KEY_LEFT_ARROW;\n\t\ttrigger.key(event, document.CPU.fast_factor);\n\t},\n\t/**\n\t * @summary Pressing fastfoward button\n\t * Function associated, see below, DO NOT RENAME\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\tfastfoward : function(event) {\n\t\tevent.keyCode = KEY_RIGHT_ARROW;\n\t\ttrigger.key(event, document.CPU.fast_factor);\n\t},\n\n\t/**\n\t * @summary Refresh document body when changing chapter\n\t *\n\t * @param      {Object}   active_cue         \t\tThe TextTrack actived\n\t * @param      {HTMLAudioElement}   audiotag        Audiotag relative to TextTrack\n\t *\n\t * To not warns on classList.remove()\n\t * @suppress {checkTypes}\n\t */\n\tcuechange : function(active_cue, audiotag) {\n\t\tlet body_classes = document.body.classList;\n\t\tbody_classes.remove(body_className_playing_cue);\n\t\t// giving a class to document.body, with a syntax according to https://www.w3.org/TR/CSS21/syndata.html#characters\n\t\tbody_className_playing_cue = `cpu_playing_tag_«${audiotag.id}»_cue_«${active_cue.id}»`;\n\t\tbody_classes.add(body_className_playing_cue);\n\t},\n\n\n\t/**\n\t * @summary Updatting time position. Pause if a end position was defined\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\tupdate : function({target:audiotag}) {\n\t\tif ((trigger._timecode_end !== false) && (audiotag.currentTime > trigger._timecode_end)) {\n\t\t\ttrigger.pause(undefined, audiotag);\n\t\t}\n\n\t\taudiotag.CPU_update();\n\t\tif ((!audiotag.paused) && (!is_audiotag_streamed(audiotag))) {\n\t\t\twindow.localStorage.setItem(audiotag.currentSrc, String(audiotag.currentTime));\n\t\t}\n\t},\n\n\t/**\n\t * @summary When an audiotag is ended, advance in playlist\n\t *\n\t * @param      {Object}  \t\t\tevent     The event\n\t * @param      {HTMLAudioElement}  \taudiotag  The audiotag\n\t */\n\tended : function({target}, audiotag=undefined) {\n\t\t// the media element reached its end\n\t\taudiotag = audiotag ?? target;\n\t\tlet {dataset, id} = audiotag;\n\n\t\tif (!dataset.playlist) {\n\t\t\treturn;\n\t\t}\n\t\t// and is in a declarated playlist\n\t\tlet playlist_name = dataset.playlist;\n\t\tlet playlist = document.CPU.playlists[playlist_name];\n\t\tif (playlist === undefined) { \n\t\t\t// test strict : we may have a funnily 'undefined' named playlist ;)\n\t\t\twarn(`Named playlist ${playlist_name} not created. WTF ?`);\n\t\t\treturn;\n\t\t}\n\t\tlet playlist_index = playlist.indexOf(id);\n\t\tif (playlist_index < 0) {\n\t\t\twarn(`Audiotag ${id} not in playlist ${playlist_name}. WTF ?`);\n\t\t\treturn;\n\t\t}\n\t\tif ((playlist_index +1) === playlist.length) {\n\t\t\t// end of playlist\n\t\t\treturn;\n\t\t}\n\t\tlet next_id = playlist[ playlist_index+1 ];\n\n\t\tlet next_audiotag = /** @type {HTMLAudioElement} */ (document.getElementById(next_id));\n\t\tif (!next_audiotag) {\n\t\t\twarn(`Audiotag #${next_id} doesn't exists. WTF ?`);\n\t\t\treturn;\n\t\t}\n\t\t// Play the next media in playlist, starting at zero\n\t\tdocument.CPU.seekElementAt(next_audiotag, 0);\n\t\ttrigger.play({}, next_audiotag);\n\t},\n\n};\n","import {find_container} from './utils.js';\nimport {trigger} from './trigger.js';\n\n// Repeated event allocation\nlet pressing = null;\nconst acceptable_press_actions = ['fastreward', 'reward', 'foward', 'fastfoward'];\n\n// Handheld navigation button process\n// @private\nexport class press_manager {\n\t/*\n\t * @summary Start handheld navigation button press\n\t * @private\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\tpress(event) {\n\t\tlet target = event.target.id ? event.target : event.target.closest('button');\n\t\tif ( (!target.id) || (!acceptable_press_actions.includes(target.id))) {\n\t\t\t// we have been misleaded\n\t\t\treturn;\n\t\t}\n\t\t// execute the associated function\n\t\ttrigger[target.id](event);\n\t\tif (pressing) {\n\t\t\twindow.clearTimeout(pressing);\n\t\t}\n\n\t\tpressing = window.setTimeout(press_manager.repeat, document.CPU.repeat_delay, { target });\n\t\tevent.preventDefault();\n\t}\n\t/*\n\t * @summary Repeat during pressing handheld navigation button\n\t * @private\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\trepeat(event) {\n\t\t//\n\t\ttrigger[event.target.id](event);\n\t\t// next call : repetition are closest\n\t\tpressing = window.setTimeout(press_manager.repeat, document.CPU.repeat_factor, event);\n\t}\n\t/*\n\t * @summary Release handheld navigation button\n\t * @private\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\trelease(event) {\n\t\twindow.clearTimeout(pressing);\n\t\tpressing = null;\n\t\tevent.preventDefault();\n\t}\n}\n\n// touch is occuring\nlet touching = null;\n\nexport class touch_manager {\n\t/**\n\t * @summary Interprets long play on timeline to reveal alternative fine position panel\n\t */\n\t\n\t/**\n\t * @summary Press started on the timeline\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\tstart({target}) {\n\t\tlet container = find_container(target);\n\t\ttouching = setTimeout(container.show_handheld_nav.bind(container), document.CPU.alternate_delay);\n\t}\n\t/**\n\t * @summary Press stoped on the timeline\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\tcancel() {\n\t\tclearTimeout(touching);\n\t}\n\n}\n","import {error, once_passive_ev, passive_ev} from './utils.js';\nimport {__, prefered_language} from './i18n.js';\nimport {trigger} from './trigger.js';\nimport {translate_vtt} from './translate_vtt.js';\nimport {activecue_classname} from './element_cpu.js';\n\nconst plane_chapters = '_chapters';\n\n/**\n * @summary Add listeners on tracks to build chapters when loaded\n * @private\n * \n * @param      {Object}  container  <cpu-audio>.CPU\n */\nexport function build_chapters_loader(container) {\n\tbuild_chapters(container);\n\tlet audiotag = container.audiotag;\n\tlet this_build_chapters = build_chapters.bind(undefined, container);\n\n\t// sometimes, we MAY have loose loading\n\taudiotag.addEventListener('loadedmetadata', this_build_chapters, once_passive_ev);\n\n\tlet track_element = audiotag.querySelector('track[kind=\"chapters\"]');\n\tif ((track_element) && (!track_element._CPU_load_ev)) {\n\t\ttrack_element._CPU_load_ev = track_element.addEventListener('load', this_build_chapters, passive_ev);\n\t}\n}\n\n/**\n * @summary Builds or refresh chapters interface.\n * @private was public\n *\n * @param      {Object}  \t\t\tcontainer  <cpu-audio>.CPU\n * @param      {Object|undefined}  \tevent          The event\n */\nexport async function build_chapters(container) {\n\t// this functions is called THREE times at load : at build, at loadedmetada event and at load event\n\t// and afterwards, we have to reposition track points on duractionchange\n\n\tif (container.is_controller) {\n\t\t// not your job, CPUController\n\t\treturn;\n\t}\n\n\tlet audiotag = container.audiotag;\n\tlet has = false;\n\n\tif (audiotag) {\n\t\tif (audiotag.textTracks?.length > 0) {\n\t\t\tlet chapter_track = null;\n\n\t\t\tfor (let tracks of audiotag.textTracks) {\n\t\t\t\tif (\n\t\t\t\t\t\t(tracks.kind.toLowerCase() === 'chapters') &&\n\t\t\t\t\t\t(tracks.cues) &&  // linked to default=\"\" attribute, only one per set !\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\t(!chapter_track) /* still no active track */\n\t\t\t\t\t\t\t|| (tracks.language.toLowerCase() === prefered_language) /* correspond to <html lang> */\n\t\t\t\t\t\t)\n\t\t\t\t\t) {\n\t\t\t\t\tchapter_track = tracks;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (chapter_track?.cues.length > 0) {\n\t\t\t\tcontainer.add_plane(plane_chapters, __['chapters'], {track : 'chapters'});\n\n\t\t\t\tlet cuechange_event_this = cuechange_event.bind(undefined, container);\n\t\t\t\t// ugly, but best way to catch the DOM element, as the `cuechange` event won't give it to you via `this` or `event`\n\t\t\t\t// adding/reinstall chapter changing event\n\t\t\t\tchapter_track.removeEventListener('cuechange', cuechange_event_this);\n\t\t\t\tchapter_track.addEventListener('cuechange', cuechange_event_this, passive_ev);\n\n\t\t\t\tfor (let cue of chapter_track.cues) {\n\t\t\t\t\tif (!container.get_point(plane_chapters, cue.id)) {\n\t\t\t\t\t\t// avoid unuseful redraw, again\n\t\t\t\t\t\tlet cuepoint = Math.floor(cue.startTime);\n\t\t\t\t\t\tcontainer.add_point(plane_chapters, cuepoint, cue.id,  {\n\t\t\t\t\t\t\ttext : translate_vtt(cue.text),\n\t\t\t\t\t\t\tlink : true,          // point the link to start time position\n\t\t\t\t\t\t\tend  : cue.endTime    // end timecode of the cue\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (chapter_track.cues.length > 0) {\n\t\t\t\t\thas = true;\n\t\t\t\t}\n\t\t\t\tcuechange_event(container, {\n\t\t\t\t\ttarget : {\n\t\t\t\t\t\tactiveCues : chapter_track.cues\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tlet body_class = `cpu_tag_«${audiotag.id}»_chaptered`;\n\tlet body_classlist = document.body.classList;\n\tif (has) {\n\t\t// indicate in host page that audio tag chapters are listed\n\t\t// see https://github.com/dascritch/cpu-audio/issues/36\n\t\tbody_classlist.add(body_class);\n\t} else {\n\t\tcontainer.remove_plane(plane_chapters);\n\t\tbody_classlist.remove(body_class);\n\t}\n\n\t/*\n\tif ((active_cue) && (id_in_hash(this.audiotag.id)) ) {\n\t\t// shoud be set ONLY if audiotag is alone in page or if audiotag.id named in hash\n\t\ttrigger.cuechange(active_cue, this.audiotag);\n\t\tthis.fire_event('chapter_changed', {\n\t\t\tcue : active_cue\n\t\t});\n\t}\n\t*/\n\n}\n\n/**\n * @summary Call when a chapter is changed, to trigger the changes\n * @private\n *\n * @param      {Object}  container  Element.CPU\n * @param      {Object}  event   \tThe event\n */\nfunction cuechange_event(container, event) {\n\tlet active_cue;\n\ttry {\n\t\t// Chrome may put more than one activeCue. That's a stupid regression from them, but alas... I have to do with\n\t\tlet _time = container.audiotag.currentTime;\n\t\tfor (let cue of event.target.activeCues) {\n\t\t\tif ((cue.startTime <= _time) && (_time < cue.endTime)) {\n\t\t\t\tactive_cue = cue;\n\t\t\t}\n\t\t}\n\t\tif (Object.is(active_cue, container._activecue)) {\n\t\t\treturn ;\n\t\t}\n\n\t\tcontainer._activecue = active_cue;\n\t\t// do NOT tell me this is ugly, i know this is ugly. I missed something. Teach me how to do it better\n\t} catch (oops) {\n\t\terror(oops);\n\t}\n\n\tcontainer.remove_highlights_points(plane_chapters, activecue_classname);\n\tif (active_cue) {\n\t\ttrigger.cuechange(active_cue, container.audiotag);\n\t\tcontainer.fire_event('chapter_changed', {\n\t\t\tcue : active_cue\n\t\t});\n\t\tcontainer.highlight_point(plane_chapters, active_cue.id, activecue_classname);\n\t}\n}","import {passive_ev, querySelector_apply, find_container, element_prevent_link_on_same_page} from './utils.js';\nimport {trigger} from './trigger.js';\nimport {press_manager, touch_manager} from './finger_manager.js';\nimport {build_chapters_loader} from './build_chapters.js';\n\n/**\n * @summary Interprets `navigator.share` native API\n *\n * @param      {Object}  event   The event\n */\nfunction native_share(event) {\n\tlet {title, canonical} = find_container(event.target).fetch_audiotag_dataset();\n\tnavigator.share({\n\t\ttitle,\n\t\ttext\t: title,\n\t\turl \t: canonical\n\t});\n\tevent.preventDefault();\n}\n\n/**\n * @private, because at start\n *\n * @param      {Object}  \t\t\tcontainer  <cpu-audio>.CPU\n *\n * @summary Builds the controller.\n */\nexport function build_controller(container) {\n\tlet interface_classlist = container.shadowId('interface').classList;\n\n\t// hide broken image while not loaded\n\tcontainer.shadowId('poster').addEventListener('load', () => {\n\t\tinterface_classlist.add('poster-loaded');\n\t}, passive_ev);\n\n\tlet show_main = container.show_main.bind(container);\n\n\tlet cliquables = {\n\t\tpause     : trigger.play,\n\t\tplay      : trigger.pause,\n\t\ttime      : trigger.throbble,\n\t\tactions   : container.show_actions.bind(container),\n\t\tback      : show_main,\n\t\tposter    : show_main,\n\t\trestart   : trigger.restart,\n\t};\n\tfor (let that in cliquables) {\n\t\tcontainer.shadowId(that).addEventListener('click', cliquables[that], passive_ev);\n\t}\n\n\t// handheld nav to allow long press to repeat action\n\tlet _buttons = ['fastreward', 'reward', 'foward', 'fastfoward'];\n\tlet _actions = {\n\t\ttouchstart    : true,\n\t\ttouchend      : false,\n\t\ttouchcancel   : false,\n\t\t/* PHRACKING IOS PHRACKING SAFARI PHRACKING APPLE */\n\t\tmousedown     : true,\n\t\tmouseup       : false,\n\t\tmouseleave    : false\n\t};\n\tfor (let that of _buttons) {\n\t\tconst element_id = container.shadowId(that);\n\t\tfor (let _act in _actions) {\n\t\t\telement_id.addEventListener(_act, _actions[_act] ? press_manager.press : press_manager.release);\n\t\t}\n\t}\n\n\t// keyboard management\n\tcontainer.element.addEventListener('keydown', trigger.key);\n\n\t// not working correctly :/\n\tcontainer.shadowId('control').addEventListener('keydown', trigger.keydownplay);\n\t// throbber management\n\tlet timeline_element = container.shadowId('time');\n\tlet do_events = {\n\t\tmouseover   : true,\n\t\tmousemove   : true,\n\t\tmouseout    : false,\n\n\t\ttouchstart  : true,\n\t\ttouchend    : false,\n\t\ttouchcancel : false,\n\t};\n\tfor (let event_name in do_events) {\n\t\ttimeline_element.addEventListener(\n\t\t\tevent_name,\n\t\t\tdo_events[event_name] ? trigger.hover : trigger.out,\n\t\t\tpassive_ev);\n\t}\n\t// alternative fine navigation for handhelds\n\ttimeline_element.addEventListener('touchstart', touch_manager.start, passive_ev);\n\ttimeline_element.addEventListener('touchend', touch_manager.cancel, passive_ev);\n\ttimeline_element.addEventListener('contextmenu', container.show_handheld_nav.bind(container));\n\n\tif (navigator.share) {\n\t\tinterface_classlist.add('hasnativeshare');\n\t\tcontainer.shadowId('nativeshare').addEventListener('click', native_share, passive_ev);\n\t}\n\n\tif (!container.audiotag)  {\n\t\t// <cpu-controller> without <cpu-audio> , see https://github.com/dascritch/cpu-audio/issues/91\n\t\treturn;\n\t}\n\n\tcontainer.audiotag.addEventListener('durationchange', container.reposition_tracks.bind(container), passive_ev);\n\n\tcontainer.show_main();\n\tbuild_chapters_loader(container);\n\tcontainer.fire_event('ready');\n\n\tquerySelector_apply('#canonical', element_prevent_link_on_same_page, container.shadowRoot);\n}","import {CpuControllerTagName, find_container, selector_audio_in_component, querySelector_apply, absolutize_url, error, escape_html, passive_ev} from './utils.js';\nimport {__} from './i18n.js';\nimport {default_dataset} from './default_dataset.js';\nimport {SecondsInColonTime, SecondsInTime, IsoDuration} from './convert.js';\nimport {translate_vtt} from './translate_vtt.js';\nimport {trigger} from './trigger.js';\nimport {is_audiotag_streamed, add_id_to_audiotag} from './media_element_extension.js';\nimport {build_controller} from './build_controller.js';\n\n// Acceptables attributes values for hide=\"\" parameter on webcomponent\nconst acceptable_hide_atttributes = ['poster', 'actions', 'timeline', 'chapters', 'panels', 'panels-title', 'panels-except-play'];\n\n// should be put in CPU-controller ?\nconst preview_classname = 'with-preview';\nexport const activecue_classname = 'active-cue';\n\n// Regex used to validate planes, points and injected css names\nconst valid_id = /^[a-zA-Z0-9\\-_]+$/;\n\n// Regex for extracting plane and point names from an id\nconst plane_point_names_from_id = /^[a-zA-Z0-9\\-_]+_«([a-zA-Z0-9\\-_]+)(»_.*_«([a-zA-Z0-9\\-_]+))?»$/;\n\n/**\n * @summary Gets the plane point names from an id on a ShadowDOM element.\n * @package\n\n * repeated in the class for testing purposes\n *\n * @param      {string}  element_id  The element identifier\n * @return     {Array<string>}    An array with two strings : plane name and point name.\n */\nfunction get_point_names_from_id(element_id) {\n\tconst [,plane_name, , point_name] = element_id.match(plane_point_names_from_id) || [];\n\treturn [plane_name??'', point_name??''];\n}\n\n/**\n * @summary    Highlight the playable positions when hovering a marked link\n *\n * @param      {Object}  event   An hover event\n */\nfunction preview_container_hover({target}) {\n\tif (!target.id) {\n\t\ttarget = target.closest('[id]');\n\t}\n\tif (!target) {\n\t\treturn;\n\t}\n\n\tlet [plane_name, point_name] = get_point_names_from_id(target.id);\n\tfind_container(target).highlight_point(plane_name, point_name);\n}\n\n/**\n * @summary Gets the point track identifier\n *\n * @param      {string}  plane_name  The plane name\n * @param      {string}  point_name  The point name\n * @param      {boolean} panel       Is panel (true) or track (false)\n * @return     {string}  The point track identifier.\n */\nfunction get_point_id(plane_name, point_name, panel) {\n\treturn `${ panel?'panel':'track' }_«${plane_name}»_point_«${point_name}»`;\n}\n\n/**\n  * @param  {number|undefined|boolean} sec  Is it a \"seconds\" value ?\n  * @return {boolean}\n  */\nfunction is_seconds(sec) {\n\t// completely ugly... but « WAT » ! as in https://www.destroyallsoftware.com/talks/wat\n\treturn ((sec !== undefined) && (sec !== false));\n}\n\n/**\n * @summary Show or hide an element\n *\n * @param      {Element} element  \tThe element to show or hide\n * @param      {boolean} show \t\tShow if true, hide if false\n */\nfunction show_element({classList}, show) {\n\tif (show) {\n\t\tclassList.remove('no');\n\t} else {\n\t\tclassList.add('no');\n\t}\n}\n\n/**\n * @summary Clean up DOM elements of any annotations, before rebuild them\n * @private\n *\n * @param      {Element} container  The webcontainer to clean-up\n */\nfunction undraw_all_planes(container) {\n\tquerySelector_apply('aside, div.panel', (element) => { element.remove(); }, container);\n}\n\n\nexport class CPU_element_api {\n\t/**\n\t *\n\t * @summary Constructs the object.\n\t * @public\n\t *\n\t * @param      {Element}  element              The DOMelement\n\t * @param      {Element}  container_interface  The container interface\n\t */\n\tconstructor(element, container_interface, element_attributes) {\n\t\t// I hate this style. I rather prefer the object notation\n\t\tthis.element = element;\n\t\tthis.audiotag = /* @type {HTMLAudioElement} */ element._audiotag;\n\t\tthis.container = container_interface;\n\t\tthis.mode_when_play = null;\n\t\tthis.glow_before_play = !! element_attributes.glow;\n\t\tthis.glow_before_play = element_attributes.glow;\n\t\tthis.current_playlist = [];\n\t\tthis._activecue = null;\n\t\tthis.mode_was = null;\n\t\tthis.act_was = null;\n\n\t\tif ( (this.audiotag) && (! this.audiotag._CPU_planes)) {\n\t\t\tthis.audiotag._CPU_planes = {};\n\t\t}\n\n\t\tthis.is_controller = this.element.tagName === CpuControllerTagName;\n\t\t// only used for CPU-CONTROLLER, for playlist\n\t\tthis._planes = {};\n\n\t\tif (!this.audiotag) {\n\t\t\tdocument.CPU.global_controller = this;\n\t\t\tthis.audiotag = document.querySelector(selector_audio_in_component);\n\t\t}\n\n\t\tbuild_controller(this);\n\t\tthis.attach_audiotag_to_controller(this.audiotag);\n\n\t\t// mode=\"\" attribute, on general aspect\n\t\tlet mode = element_attributes.mode;\n\t\tif (mode) {\n\t\t\t// in case of a mode=\"still,play\" declaration\n\t\t\tlet [mode_still, mode_play] = mode.split(',');\n\t\t\tif (mode_play) {\n\t\t\t\tmode = this.audiotag.paused ? mode_still : mode_play;\n\t\t\t\tthis.mode_when_play = mode_play;\n\t\t\t}\n\t\t}\n\t\tthis.set_mode_container(mode);\n\n\t\t// hide=\"\" attribute, space separated elements to hide\n\t\tif (element_attributes.hide) {\n\t\t\tthis.set_hide_container(element_attributes.hide.split(' '));\n\t\t}\n\n\t}\n\n\t/**\n\t * @summary Check if the actual <cpu-audio> is mirrored in <cpu-controller>. False if no cpu-controller\n\t * @private but next time public ?\n\t *\n\t * @return     boolean\t\t\tFalse if no cpu-controller or not mirrored\n     */\n\tmirrored_in_controller() {\n\t\tlet global_controller = document.CPU.global_controller;\n\t\treturn (global_controller) && (this.audiotag.isEqualNode(global_controller.audiotag));\n\t}\n\n\n\t/**\n\t * @summary Passthru there only for testing purposes.\n\t * @private but needed in tests\n\t *\n\t * @param      {string}            vtt_taged  The vtt tagged\n\t * @return     string                         HTML tagged string\n     */\n\ttranslate_vtt(vtt_taged) {\n\t\treturn translate_vtt(vtt_taged);\n\t}\n\n\t/**\n\t * @summary Passthru there only for testing purposes. Perhaps may be on document.CPU as public method ?\n\t * @public\n\t */\n\tget_point_names_from_id(element_id) {\n\t\treturn get_point_names_from_id(element_id);\n\t}\n\n\t/**\n\t * @summary    create and fire custom events for the global document.\n\t * @private\n\t *\n\t * We async-ed it, to avoid ultra-probable performances issues\n\t *\n\t * @param      {string}            event_name  The event name, will be prefixed with CPU_\n\t * @param      {Object|undefined}  detail      Specific public informations about the event\n\t * @return     {Promise}           { description_of_the_return_value }\n\t */\n\tasync fire_event(event_name, detail = undefined) {\n\t\t/**\n\t\t * Events to be created :\n\t\t *  - plane CRUD\n\t\t *  - point CRUD\n\t\t */\n\t\tthis.element.dispatchEvent(\n\t\t\tnew CustomEvent(`CPU_${event_name}`, {\n\t\t\t\ttarget \t\t: this.element,\n\t\t\t\tbubbles \t: true,\n\t\t\t\tcancelable \t: false,\n\t\t\t\tcomposed \t: false,\n\t\t\t\tdetail \t\t: detail\n\t\t\t})\n\t\t);\n\t}\n\n\tshadowId(id) {\n\t\treturn this.element.shadowRoot.getElementById(id);\n\t}  \n\n\t/**\n\t * @summary Used for `mode=\"\"` attribute.\n\t * @public\n\t *\n\t * @param      {string|null}  mode    Accepted are only in `/\\w+/` format, 'default' by default\n\t */\n\tset_mode_container(mode=null) {\n\t\tmode = mode ?? 'default';\n\t\tif (this.mode_was === mode) {\n\t\t\treturn;\n\t\t}\n\t\tlet classes = this.container.classList;\n\t\tclasses.remove(`mode-${this.mode_was}`);\n\t\tclasses.add(`mode-${mode}`);\n\t\tthis.mode_was = mode;\n\t}\n\t/**\n\t * @summary Change the presentation style reflecting the media tag status\n\t * @public\n\t *\n\t * @param      {string}  act     can be 'loading', 'pause', 'glow' or 'play'\n\t */\n\tset_act_container(act) {\n\t\tif (this.act_was === act) {\n\t\t\treturn;\n\t\t}\n\t\tif ( (! document.CPU.had_played) && (this.act_was !== null) && (act === 'loading') ){\n\t\t\treturn;\n\t\t}\n\t\tlet classes = this.container.classList;\n\t\tclasses.remove(\n\t\t\t'act-loading',\n\t\t\t'act-buffer',\n\t\t\t'act-pause',\n\t\t\t'act-play',\n\t\t\t'act-glow'\n\t\t\t);\n\t\tclasses.add(`act-${act}`);\n\t\tif ((this.act_was === 'play') && (act === 'loading')) {\n\t\t\tclasses.add(`act-buffer`);\n\t\t}\n\t\tthis.act_was = act;\n\t}\n\t/**\n\t * @public\n\t * @summary Hide some blocks in the interface\n\t * used for `hide=\"\"` attribute\n\t *\n\t * @param      {Array<string>}  hide_elements  Array of strings, may contains\n\t *                                        'actions' or 'chapters'\n\t */\n\tset_hide_container(hide_elements) {\n\t\tlet container_class = this.container.classList;\n\n\t\tfor (let hide_this of acceptable_hide_atttributes) {\n\t\t\tcontainer_class.remove(`hide-${hide_this}`);\n\t\t}\n\n\t\tfor (let hide_this of hide_elements) {\n\t\t\thide_this = hide_this.toLowerCase();\n\t\t\tif (acceptable_hide_atttributes.includes(hide_this)) {\n\t\t\t\tcontainer_class.add(`hide-${hide_this}`);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @public\n\t * @summary update play/pause button according to media status\n\t */\n\tupdate_playbutton() {\n\t\tlet audiotag = this.audiotag;\n\t\tlet _attr = audiotag.getAttribute('preload');\n\t\tlet _preload = _attr ? (_attr.toLowerCase() !== 'none') : true ;\n\t\tif (\n\t\t\t\t(audiotag.readyState < HTMLMediaElement.HAVE_CURRENT_DATA ) &&\n\t\t\t\t((_preload) || (audiotag._CPU_played))\n\t\t\t) {\n\t\t\tthis.set_act_container('loading');\n\t\t\treturn;\n\t\t}\n\n\t\tlet will_act = 'play';\n\t\tif (audiotag.paused) {\n\t\t\twill_act = 'pause';\n\t\t\tif ((!audiotag._CPU_played) && (this.glow_before_play)) {\n\t\t\t\t// TODO check option\n\t\t\t\twill_act = 'glow';\n\t\t\t}\n\t\t}\n\n\t\tthis.set_act_container(will_act);\n\t\tlet hide_panels_except_play_mark = 'last-used';\n\n\t\tlet container_class = this.container.classList;\n\t\tif (!audiotag.paused) {\n\t\t\taudiotag._CPU_played = true;\n\t\t\tcontainer_class.add(hide_panels_except_play_mark);\n\t\t\tif (this.mode_when_play) {\n\t\t\t\tthis.set_mode_container(this.mode_when_play);\n\t\t\t\tthis.mode_when_play = null;\n\t\t\t}\n\t\t} else {\n\t\t\tif (! this.audiotag.isEqualNode(document.CPU.last_used)) {\n\t\t\t\tcontainer_class.remove(hide_panels_except_play_mark);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @summary Update time-line length\n\t * @private\n\t *\n\t * @param      {number}  seconds  The seconds\n\t * @param      {number|undefined=}  ratio    ratio position in case time position are still unknown\n\t */\n\tupdate_line(seconds, ratio=undefined) {\n\t\tlet { duration } = this.audiotag;\n\t\tratio = ratio ?? ( duration === 0 ? 0 : (100*seconds / duration) );\n\t\tthis.shadowId('loadingline').style.width = `${ratio}%`;\n\t}\n\n\t/**\n\t * @summary update current timecode and related links\n\t * @private\n\t */\n\tupdate_time() {\n\t\tlet audiotag = this.audiotag;\n\t\tlet timecode = is_audiotag_streamed(audiotag) ? 0 : Math.floor(audiotag.currentTime);\n\t\tlet canonical = audiotag.dataset.canonical ?? '' ;\n\t\tlet _is_at = canonical.indexOf('#');\n\t\tlet elapse_element = this.shadowId('elapse');\n\t\telapse_element.href = \n\t\t\t`${ absolutize_url(canonical) }#${ (_is_at < 0) ?\n\t\t\t\taudiotag.id :\n\t\t\t\tcanonical.substr(_is_at + 1) }&t=${timecode}`;\n\n\t\tlet total_duration = false;\n\t\tlet _natural = Math.round(audiotag.duration);\n\t\tif (!isNaN(_natural)){\n\t\t\ttotal_duration = SecondsInColonTime(_natural);\n\t\t} else {\n\t\t\tlet _forced = Math.round(audiotag.dataset.duration);\n\t\t\tif (_forced > 0) {\n\t\t\t\ttotal_duration = SecondsInColonTime(_forced);\n\t\t\t}\n\t\t}\n\n\t\telapse_element.querySelector('span').innerText = SecondsInColonTime(audiotag.currentTime);\n\t\tlet duration_element = elapse_element.querySelector('.nosmaller');\n\t\tduration_element.innerText = total_duration ? `\\u00a0/\\u00a0${total_duration}` : '…';\n\t\tshow_element(duration_element, total_duration);\n\n\t\tthis.update_line(audiotag.currentTime);\n\t}\n\n\t/**\n\t * @summary Shows indicators for the limits of the playing position\n\t * @private\n\t */\n\tupdate_time_borders() {\n\t\tlet audiotag = this.audiotag;\n\t\tlet plane_name = '_borders';\n\t\tlet point_name = 'play';\n\t\tif ((!document.CPU.is_audiotag_global(audiotag)) || (trigger._timecode_end === false)) {\n\t\t\tthis.remove_plane(plane_name);\n\t\t\treturn;\n\t\t}\n\t\t// verify if plane exists, and point is invariant\n\t\tif (this.get_plane(plane_name)) {\n\t\t\tlet check = this.get_point(plane_name, point_name);\n\t\t\tif (\n\t\t\t\t(check) &&\n\t\t\t\t(check.start === trigger._timecode_start) &&\n\t\t\t\t(check.end === trigger._timecode_end)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.add_plane(plane_name,'',{\n\t\t\ttrack   \t: 'borders',\n\t\t\tpanel   \t: false,\n\t\t\thighlight \t: false\n\t\t});\n\t\tthis.add_point(plane_name, trigger._timecode_start, point_name, {\n\t\t\tlink    \t: false,\n\t\t\tend     \t: trigger._timecode_end\n\t\t});\n\n\t}\n\t/**\n\t * @summary Show that the media is loading\n\t * @private\n\t *\n\t * @param      {number}  seconds  The seconds\n\t */\n\tupdate_loading(seconds, ratio) {\n\t\tthis.update_line(seconds, ratio);\n\t\tthis.set_act_container('loading');\n\t}\n\n\t/**\n\t * @summary Show the current media error status. NOTE : this is not working, even on non supported media type\n\t * Chrome logs an error « Uncaught (in promise) DOMException: Failed to load because no supported source was found. »\n\t * but don't update message\n\t *\n\t * @private\n\t *\n\t * @return     {boolean}  True if an error is displayed\n\t */\n\tupdate_error() {\n\t\tlet audiotag = this.audiotag;\n\t\tif (!audiotag) {\n\t\t\treturn true;\n\t\t}\n\t\tlet error_object = audiotag.error;\n\t\tif (error_object) {\n\t\t\tlet error_message;\n\t\t\tlet pageerror = this.shadowId('pageerror');\n\t\t\tthis.show_interface('error');\n\t\t\tswitch (error_object.code) {\n\t\t\t\tcase MediaError.MEDIA_ERR_ABORTED:\n\t\t\t\t\terror_message = __.media_err_aborted;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MediaError.MEDIA_ERR_NETWORK:\n\t\t\t\t\terror_message = __.media_err_network;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MediaError.MEDIA_ERR_DECODE:\n\t\t\t\t\terror_message = __.media_err_decode;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:\n\t\t\t\t\terror_message = __.media_err_src_not_supported;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\terror_message = __.media_err_unknow;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tpageerror.innerText = error_message;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * @summary Will refresh player interface at each time change (a lot)\n\t *\n\t * @private\n\t */\n\tupdate() {\n\t\tif (!this.update_error()) {\n\t\t\tthis.update_playbutton();\n\t\t\tthis.update_time();\n\t\t\tthis.update_time_borders();\n\t\t}\n\t}\n\n\t/**\n\t * @summary Position an element in the timeline, on its time\n\t * @private\n\t *\n\t * @param      {Element} \t\t\t      element         Element to impact, should be in #time\n\t * @param      {number|undefined}   \t  seconds_begin   Starts position in seconds, do not apply if undefined\n\t * @param      {number|undefined|boolean} seconds_end     Ends position in seconds, do not apply if undefined or false\n\t */\n\tposition_time_element(element, seconds_begin=undefined, seconds_end=undefined) {\n\t\tlet { duration } = this.audiotag;\n\n\t\tif ((duration === 0) || (isNaN(duration))) {\n\t\t\treturn;\n\t\t\t// duration still unkonw ! We will need to redraw later the tracks\n\t\t}\n\n\t\tif (is_seconds(seconds_begin)) {\n\t\t\telement.style.left =  `${100 * (seconds_begin / duration)}%`;\n\t\t}\n\t\tif (is_seconds(seconds_end)) {\n\t\t\telement.style.right = `${100 * (1 - (seconds_end / duration))}%`;\n\t\t}\n\n\t}\n\n\t/**\n\t * @summary Shows the throbber\n\t *\n\t * @public\n\t *\n\t * @param      {number}  seeked_time  The seeked time\n\t */\n\tasync show_throbber_at(seeked_time) {\n\t\tlet audiotag = this.audiotag;\n\t\tif (audiotag.duration < 1) {\n\t\t\t// do not try to show if no metadata\n\t\t\treturn;\n\t\t}\n\t\tif ((isNaN(audiotag.duration)) && (!is_audiotag_streamed(audiotag))) {\n\t\t\t// as we navigate on the timeline, we wish to know its total duration\n\t\t\t// yes, this is twice calling, as of trigger.throbble()\n  \t\t\taudiotag.setAttribute('preload', 'metadata');\n\t\t}\n\n\t\tlet phylactere = this.shadowId('popup');\n\t\tphylactere.style.opacity = 1;\n\t\tthis.position_time_element(phylactere, seeked_time);\n\t\tphylactere.innerHTML = SecondsInColonTime(seeked_time);\n\t\tphylactere.dateTime = SecondsInTime(seeked_time).toUpperCase();\n\t}\n\n\t/**\n\t * @summary Hides immediately the throbber.\n\t * @public\n\t */\n\thide_throbber() {\n\t\t// we use opacity instead of a class change to permits opacity smooth transition via `--cpu-background-transitions`\n\t\tthis.shadowId('popup').style.opacity = 0;\n\t}\n\n\t/**\n\t * @summary Hides the throbber later. Will delay the hiding if recalled.\n\t * @public\n\t */\n\thide_throbber_later() {\n\t\tlet hide_throbber_delay = 1000;\n\t\tlet phylactere = this.shadowId('popup');\n\t\tif (phylactere._hider) {\n\t\t\twindow.clearTimeout(phylactere._hider);\n\t\t}\n\t\tphylactere._hider = window.setTimeout(this.hide_throbber.bind(this), hide_throbber_delay);\n\t}\n\n\t/**\n\t * @summary Will get presentation data from <audio> or from parent document\n\t *\n\t * @package\n\t *\n\t * @return     {Object}  dataset\n\t */\n\tfetch_audiotag_dataset() {\n\t\treturn {...default_dataset, ...this.audiotag.dataset};\n\t}\n\n\t/**\n\t * @private\n\t * still need to be public exposed for tests\n\t *\n\t * @summary Update links for sharing\n\t */\n\tupdate_links() {\n\t\tlet container = this;\n\t\tlet audiotag = this.audiotag;\n\t\tlet dataset = this.fetch_audiotag_dataset();\n\t\tlet canonical = absolutize_url( dataset.canonical ?? '' );\n\t\tlet timepos = (audiotag.currentTime === 0)  ? '' : `&t=${Math.floor(audiotag.currentTime)}`;\n\t\t// watch out : we should put the ID only if canonical URL is strictly identical to this page\n\t\tlet tag_id = (canonical === absolutize_url(window.location.href)) ? audiotag.id : '';\n\t\tlet _url = encodeURIComponent(`${canonical}#${tag_id}${timepos}`);\n\t\tlet _twitter = '';\n\t\tif (dataset.twitter?.[0]==='@') {\n\t\t\t /* why did I want an @ in the attribute if I cut it in my code ? to keep HTML readable and comprehensible, instead to developpe attribute name into a \"twitter-handler\" */\n\t\t\t_twitter = `&via=${dataset.twitter.substring(1)}`;\n\t\t}\n\t\tlet link = audiotag.querySelector('source[data-downloadable]')?.src ||\n\t\t\t\t\t dataset.download ||\n\t\t\t\t\t audiotag.currentSrc;\n\n\t\tlet title = dataset.title;\n\t\tlet links = {\n\t\t\ttwitter  : `https://twitter.com/share?text=${title}&url=${_url}${_twitter}`,\n\t\t\tfacebook : `https://www.facebook.com/sharer.php?t=${title}&u=${_url}`,\n\t\t\temail    : `mailto:?subject=${title}&body=${_url}`,\n\t\t\tlink\n\t\t};\n\t\tfor (let key in links) {\n\t\t\tcontainer.shadowId(key).href = links[key];\n\t\t}\n\t}\n\n\t/**\n\t * @summary Shows the interface\n\t *\n\t * @public\n\t * @param      {string}  mode    The mode, can be 'main', 'share' or 'error'\n\t */\n\tshow_interface(mode) {\n\t\tlet classlist = this.container.classList;\n\t\tclasslist.remove(\n\t\t\t'show-no',\n\t\t\t'show-main',\n\t\t\t'show-share',\n\t\t\t'show-error',\n\t\t\t'media-streamed'\n\t\t);\n\t\tif (is_audiotag_streamed(this.audiotag)) {\n\t\t\tclasslist.add('media-streamed');\n\t\t}\n\t\tclasslist.add(`show-${mode}`);\n\t}\n\n\t/**\n\t * @summary Shows the sharing panel\n\t * @private\n\t */\n\tshow_actions(/* event */) {\n\t\tthis.show_interface('share');\n\t\tthis.update_links();\n\t}\n\n\t/**\n\t * @summary Shows the main manel\n\t * @private\n\t */\n\tshow_main(/* event */) {\n\t\tthis.show_interface('main');\n\t}\n\n\t/**\n\t * @package not mature enough\n     * @summary Shows the handheld fine navigation\n\t *\n\t * @param      {Object}  event   The event\n\t */\n\tshow_handheld_nav(event) {\n\t\tif (is_audiotag_streamed(this.audiotag)) {\n\t\t\treturn;\n\t\t}\n\t\tthis.container.classList.toggle('show-handheld-nav');\n\t\tevent?.preventDefault();\n\t}\n\n\t/**\n\t * @summary Inject a <style> into the shadowDom.\n\t * @public\n\t *\n\t * Usage example in applications/chapters_editor.js\n\t *\n\t * @param \t{string}  style_key   \tA name in the range /[a-zA-Z0-9\\-_]+/, key to tag the created <style>\n\t * @param \t{string}  css \t\t\tinline CSS to inject\n\t */\n\tinject_css(style_key, css) {\n\t\tif (!style_key.match(valid_id)) {\n\t\t\terror(`inject_css invalid key \"${style_key}\"`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.remove_css(style_key);\n\t\tlet element = document.createElement('style');\n\t\telement.id = `style_${style_key}`;\n\t\telement.innerHTML = css;\n\t\tthis.container.appendChild(element);\n\t}\n\n\t/**\n\t * @summary Remove an injected <style> into the shadowDom\n\t * @public\n\t *\n\t * @param \t{string}  style_key   \tKey of the created <style> , /[a-zA-Z0-9\\-_]+/\n\t */\n\tremove_css(style_key) {\n\t\tthis.shadowId(`style_${style_key}`)?.remove();\n\t}\n\n\n\t/**\n\t * @summary Complete the interface at build time\n\t * @package\n\t */\n\tcomplete_template() {\n\t\tlet dataset = this.fetch_audiotag_dataset();\n\t\tlet { title, waveform } = dataset;\n\t\tlet element_canonical = this.shadowId('canonical');\n\n\t\telement_canonical.href = dataset.canonical;\n\n\t\tlet classlist = element_canonical.classList;\n\n\t\tif (!title) {\n\t\t\tclasslist.add('untitled');\n\t\t\ttitle = __.untitled;\n\t\t} else {\n\t\t\tclasslist.remove('untitled');\n\t\t}\n\t\telement_canonical.innerText = title;\n\t\tif (this.element.title !== title) {\n\t\t\tthis.element.title = title; // WATCHOUT ! May goes recursive with observers\n\t\t}\n\t\tthis.shadowId('poster').src = dataset.poster || '';\n\t\tthis.shadowId('time').style.backgroundImage = waveform ? `url(${waveform})` : '';\n\t}\n\t/**\n\t * @summary Attach the audiotag to the API\n\t * @package\n\t *\n\t * @param      {Element}  audiotag  The audiotag\n\t */\n\tattach_audiotag_to_controller(audiotag) {\n\t\tif (!audiotag) {\n\t\t\treturn;\n\t\t}\n\t\tthis.audiotag = audiotag;\n\t\tadd_id_to_audiotag(audiotag);\n\t\tthis.complete_template();\n\n\t\t// throw simplified event\n\t\ttrigger.update({target : audiotag});\n\t}\n\n\n\t/**\n\t * @summary Gets the plane info\n\t * @private\n\t *\n\t * @param      {string}  plane_name     The name\n\t * @return     {Object}                 data of the plane\n\t */\n\tget_plane(plane_name) {\n\t\treturn this._planes[plane_name] ?? this.audiotag._CPU_planes[plane_name];\n\t}\n\n\t/**\n\t * @summary Gets the plane track element\n\t * @private but needed in tests\n\t *\n\t * @param      {string}  plane_name   The name\n\t * @return     {Element}    The <aside> track element from ShadowDom interface\n\t */\n\tget_plane_track(plane_name) {\n\t\treturn this.shadowId(`track_«${plane_name}»`);\n\t}\n\n\t/**\n\t * @summary Gets the plane panel element\n\t * @private but needed in test\n\t *\n\t * @param      {string}  plane_name   The name\n\t * @return     {Element}    The panel element from ShadowDom interface\n\t */\n\tget_plane_panel(plane_name) {\n\t\treturn this.shadowId(`panel_«${plane_name}»`);\n\t}\n\n\t/**\n\t * @summary Gets the <nav><ul> plane panel element\n\t * @private but needed in tests\n\t *\n\t * @param      {string}  plane_name   The name\n\t * @return     {Element}    The <ul> element from ShadowDom interface, null if inexisting\n\t */\n\tget_plane_nav(plane_name) {\n\t\treturn this.get_plane_panel(plane_name)?.querySelector(`ul`);\n\t}\n\n\t/**\n\t * @summary Draws a plane\n\t * @private\n\t *\n\t * @param      {string}  plane_name  The plane name\n\t */\n\tdraw_plane(plane_name) {\n\t\tthis.get_plane_track(plane_name)?.remove();\n\t\tthis.get_plane_panel(plane_name)?.remove();\n\n\t\tlet data = this.get_plane(plane_name);\n\t\tif (!data) {\n\t\t\treturn ;\n\t\t}\n\t\tlet { track, panel, title } = data;\n\t\tlet remove_highlights_points_bind = this.remove_highlights_points.bind(this, plane_name, preview_classname, true);\n\n\t\t/**\n\t\t * @param      {Element}  element  Impacted element\n\t\t */\n\t\tfunction assign_events_on_planes(element) {\n\t\t\telement.addEventListener('mouseover', preview_container_hover, passive_ev);\n\t\t\telement.addEventListener('focusin', preview_container_hover, passive_ev);\n\t\t\telement.addEventListener('mouseleave', remove_highlights_points_bind, passive_ev);\n\t\t\telement.addEventListener('focusout', remove_highlights_points_bind, passive_ev);\n\t\t}\n\n\n\t\tif (track !== false) {\n\t\t\t// we have to create the track timeline\n\t\t\tlet plane_track = document.createElement('aside');\n\t\t\tplane_track.id = `track_«${plane_name}»`;\n\t\t\tif (track !== true) {\n\t\t\t\t// …with a class list\n\t\t\t\tplane_track.classList.add(track.split(' '));\n\t\t\t}\n\n\t\t\tthis.shadowId('line').appendChild(plane_track);\n\t\t\tassign_events_on_planes(plane_track);\n\t\t}\n\n\t\tif (panel !== false) {\n\t\t\t// we have to create the panel area\n\t\t\tlet plane_panel = document.createElement('div');\n\t\t\tplane_panel.id = `panel_«${plane_name}»`;\n\t\t\tif (panel !== true) {\n\t\t\t\t// …with a class list\n\t\t\t\tplane_panel.classList.add(panel.split(' '));\n\t\t\t}\n\n\t\t\tplane_panel.classList.add('panel');\n\n\t\t\tplane_panel.innerHTML = `<h6>${escape_html(title)}</h6><nav><ul></ul></nav>`;\n\t\t\tthis.container.appendChild(plane_panel);\n\t\t\tshow_element( plane_panel.querySelector('h6') , title);\n\t\t\tassign_events_on_planes(plane_panel);\n\t\t}\n\n\t\tif ( (!this.is_controller) && (this.mirrored_in_controller()) ) {\n\t\t\tdocument.CPU.global_controller.draw_plane(plane_name);\n\t\t}\n\n\t}\n\n\t/**\n\t * @summary Add an annotation plane layer\n\t * @public\n\t *\n\t * @param      {string}   plane_name  A name in the range /[a-zA-Z0-9\\-_]+/\n\t * @param      {string}   title       The displayed title for the panel\n\t * @param      {Object}   data        { track : true/false/classnames ,\n\t * \t\t\t\t\t\t\t\t\t\tpanel : true/false/classnames ,\n\t * \t\t\t\t\t\t\t\t\t\thighlight : true/false,\n\t *\t\t\t\t\t\t\t\t\t\t_comp : true/false // only stored in component, private use only\n\t  }\n\t *\n\t* TODO as parameter points : to bulk create points\n\t* TODO as parameter _comp : true/false // only stored in component, private use only\n\n\t * @return     {boolean}  success\n\t */\n\tadd_plane(plane_name, title, data = {}) {\n\t\tif ((! plane_name.match(valid_id)) || (this.get_plane(plane_name))) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// I don't understand (yet) why, when I move this declaration at top of file, tests will fail\n\t\tconst default_plane_data = {\n\t\t\ttrack       : true,\n\t\t\tpanel       : true,\n\t\t\ttitle       : '',\n\t\t\thighlight   : true,\n\t\t\tpoints      : {},\n\t\t\t_comp\t\t: false\n\t\t};\n\n\t\tdata = { ...default_plane_data, ...data , title};\n\n\t\tif (!data._comp) {\n\t\t\tif (this.is_controller) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.audiotag._CPU_planes = this.audiotag._CPU_planes ?? {};\n\t\t\tthis.audiotag._CPU_planes[plane_name] = data;\n\t\t} else {\n\t\t\tthis._planes[plane_name] = data;\n\t\t}\n\t\tthis.draw_plane(plane_name);\n\t\treturn true;\n\t}\n\t/**\n\t * @summary Remove an annotation plane layer\n\t * @public\n\t *\n\t * @param      {string}   name    A name in the range /[a-zA-Z0-9\\-_]+/\n\t *\n\t * @return     {boolean}  success\n\t */\n\tremove_plane(plane_name) {\n\t\tif ( (this.is_controller) || (! plane_name.match(valid_id)) || (! this.get_plane(plane_name))) {\n\t\t\treturn false;\n\t\t}\n\n\t\tdelete (this._planes[plane_name] ? this._planes : this.audiotag._CPU_planes)[plane_name];\n\n\t\tthis.get_plane_track(plane_name)?.remove();\n\t\tthis.get_plane_panel(plane_name)?.remove();\n\n\t\tif ( (!this.is_controller) && (this.mirrored_in_controller()) ) {\n\t\t\t// as plane data is removed, it will remove its aside and track\n\t\t\tdocument.CPU.global_controller.draw_plane(plane_name);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * @summary Shortcut to get  points data\n\t * @private\n\t *\n\t * @param      {string}  plane_name  The plane name\n\t * @return     {Object}  Data\n\t */\n\tplane_points(plane_name) {\n\t\treturn this.get_plane(plane_name).points;\n\t}\n\n\t/**\n\t * @summary Gets the point info\n\t * @public\n\t *\n\t * @param      {string}  plane_name  The plane name\n\t * @param      {string}  point_name  The point name\n\t * @return     {Object}  Data\n\t */\n\tget_point(plane_name, point_name) {\n\t\treturn this.get_plane(plane_name).points[point_name];\n\t}\n\n\t/**\n\t * @summary Gets the point element in the track\n\t * @private but needed in tests\n\t *\n\t * @param      {string}  plane_name   The plane\n\t * @param      {string}  point_name   The point\n\t * @return     {Element}    The <div> point element into <aside> from ShadowDom interface\n\t */\n\tget_point_track(plane_name, point_name) {\n\t\treturn this.shadowId(get_point_id(plane_name, point_name, false));\n\t}\n\n\t/**\n\t * @summary Gets the point element in the panel\n\t * @private but needed in tests\n\t *\n\t * @param      {string}  plane_name   The plane\n\t * @param      {string}  point_name   The point\n\t * @return     {Element}    The <li> point element into panel from ShadowDom interface\n\t */\n\tget_point_panel(plane_name, point_name) {\n\t\treturn this.shadowId(get_point_id(plane_name, point_name, true));\n\t}\n\n\t/**\n\t * @summary    Resort points of a plane by start-time\n\t * @private\n\t *\n\t * @param      {string}   plane_name     The plane name\n\t */\n\tplane_resort(plane_name) {\n\t\tlet out = Object.fromEntries(\n\t\t    Object.entries(\n\t\t    \tthis.plane_points(plane_name)\n\t\t\t).sort(\n\t\t    \t([, point_a], [, point_b]) => {\n\t\t    \t\treturn point_a.start - point_b.start;\n\t\t    \t}\n\t\t    )\n\t\t);\n\t\tthis.get_plane(plane_name).points = out;\n\t}\n\n\t/**\n\t * @summary    get point_names from a plane_name\n\t * @private may goes public later\n\t *\n\t * @param      {string}   plane_name     The plane name\n\t * @return     {[string]} points_names\t Array of point_names\n\t */\n\tplane_pointsnames(plane_name) {\n\t\treturn Object.keys(this.plane_points(plane_name));\n\t}\n\n\t/**\n\t * @summary    Reorder panel of a plane by points order\n\t * @private\n\t *\n\t * @param      {string}   plane_name     The plane name\n\t */\n\tpanel_reorder(plane_name) {\n\t\tthis.plane_resort(plane_name);\n\t\tif (!this.get_plane_panel(plane_name)) {\n\t\t\treturn;\n\t\t}\n\t\tlet previous_element, element;\n\t\tfor (let point_name of this.plane_pointsnames(plane_name)) {\n\t\t\telement = this.get_point_panel(plane_name, point_name);\n\t\t\tprevious_element?.insertAdjacentElement('afterend', element);\n\t\t\tprevious_element = element;\n\t\t}\n\t}\n\n\t/**\n\t * @summary Draws a plane point\n\t * @private\n\t *\n\t * @param      {string}  plane_name  The plane name\n\t * @param      {string}  point_name  The point name\n\t */\n\tdraw_point(plane_name, point_name) {\n\t\tlet audiotag = this.audiotag ? this.audiotag : document.CPU.global_controller.audiotag;\n\t\tlet data = this.get_point(plane_name, point_name);\n\t\tlet {start, link, text, image, end} = data;\n\n\t\tlet use_link = '#';\n\t\tif (link === true) {\n\t\t\t// automated link to the audio tag.\n\t\t\tuse_link = `#${audiotag.id}&t=${start}`;\n\t\t}\n\t\tif (typeof(link) === 'string') {\n\t\t\t// Integrator of the page wants a specific url (hoping he know what he do with a \"javascript:\")\n\t\t\tuse_link = link;\n\t\t}\n\n\t\tlet track = this.get_plane_track(plane_name);\n\t\tlet plane_point_track;\n\t\tif (track) {\n\t\t\tplane_point_track = this.get_point_track(plane_name, point_name);\n\t\t\tif (!plane_point_track) {\n\t\t\t\tplane_point_track = document.createElement('a');\n\t\t\t\tplane_point_track.id = get_point_id(plane_name, point_name, false);\n\t\t\t\t// TODO : how to do chose index of a point track if there is no link, or a panel but no track??\n\t\t\t\tplane_point_track.tabIndex = -1; \n\t\t\t\tplane_point_track.innerHTML = '<img alt=\"\" /><span></span>';\n\t\t\t\ttrack.appendChild(plane_point_track);\n\t\t\t}\n\t\t\tplane_point_track.href = use_link;\n\t\t\tplane_point_track.title = text;\n\t\t\tlet track_img = plane_point_track.querySelector('img');\n\t\t\tshow_element(track_img, image);\n\t\t\ttrack_img.src = image || '';\n\t\t\tplane_point_track.querySelector('img').innerHTML = text ;\n\t\t\tthis.position_time_element(plane_point_track, start, end);\n\t\t}\n\n\t\tlet panel = this.get_plane_nav(plane_name);\n\t\tlet plane_point_panel;\n\t\tif (panel) {\n\t\t\tplane_point_panel = this.get_point_panel(plane_name, point_name);\n\t\t\tif (!plane_point_panel) {\n\t\t\t\tplane_point_panel = document.createElement('li');\n\t\t\t\tplane_point_panel.id = get_point_id(plane_name, point_name, true);\n\t\t\t\tplane_point_panel.innerHTML = '<a href=\"#\" class=\"cue\"><strong></strong><time></time></a>';\n\t\t\t\tpanel.appendChild(plane_point_panel);\n\t\t\t}\n\t\t\tplane_point_panel.querySelector('a').href = use_link;\n\t\t\tplane_point_panel.querySelector('strong').innerHTML = text;\n\t\t\tlet time_element = plane_point_panel.querySelector('time');\n\t\t\ttime_element.dateTime = IsoDuration(start);\n\t\t\ttime_element.innerText = SecondsInColonTime(start);\n\t\t}\n\n\t\tthis.fire_event('draw_point', {\n\t\t\tplane : plane_name,\n\t\t\tpoint : point_name,\n\t\t\tdata_point :  data,\n\t\t\telement_point_track : plane_point_track,\n\t\t\telement_point_panel : plane_point_panel,\n\t\t});\n\n\t\tif ( (!this.is_controller) && (this.mirrored_in_controller()) ) {\n\t\t\tdocument.CPU.global_controller.draw_point(plane_name, point_name);\n\t\t}\n\t}\n\n\t/**\n\t * @summary Add an annotation point\n\t * @public\n\t *\n\t * @param      {string}   plane_name      The existing plane name\n\t * @param      {number}   timecode_start  The timecode start for this annotation\n\t * @param      {string}   point_name      The point name, should conform to /^[a-zA-Z0-9\\-_]+$/\n\t * @param      {Object}   data            { 'image' : <url>,\n\t * \t\t\t\t\t\t\t\t\t\t\t'link' : <url>/true (in audio)/false (none),\n\t * \t\t\t\t\t\t\t\t\t\t\t'text' : <text>,\n\t * \t\t\t\t\t\t\t\t\t\t\t'end'  : <seconds> }\n\t *\n\t * @return     {boolean}  success\n\t */\n\tadd_point(plane_name, timecode_start, point_name, data={}) {\n\t\t// TODO major release : move timecode_start in data, add points argument for a bulk insertion\n\n\t\tif ( (!this.get_plane(plane_name)) || (this.get_point(plane_name, point_name)) || (timecode_start < 0) || (!point_name.match(valid_id)) ) {\n\t\t\treturn false;\n\t\t}\n\t\tif ((!this._planes[plane_name]) && (this.is_controller)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tdata.start = Number(timecode_start); // TO move into parameter\n\t\tlet { start } = data;\n\t\tthis.get_plane(plane_name).points[point_name] = data;\n\n\t\tthis.fire_event('add_point', {\n\t\t\tplane : plane_name,\n\t\t\tpoint : point_name,\n\t\t\tdata_point :  data\n\t\t});\n\n\t\tif (this.get_plane(plane_name)._st_max > start) {\n\t\t\t// we need to reorder the plane\n\t\t\tthis.panel_reorder(plane_name);\n\t\t} else {\n\t\t\tthis.draw_point(plane_name, point_name);\n\t\t\tthis.get_plane(plane_name)._st_max = start;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * @summary Edit an annotation point\n\t * @public\n\t *\n\t * @param      {string}   plane_name      The existing plane name\n\t * @param      {string}   point_name      The existing point name\n\t * @param      {Object}   data            { 'image' : <url>,\n\t * \t\t\t\t\t\t\t\t\t\t\t'link'  : <url>/true (in audio)/false (none),\n\t * \t\t\t\t\t\t\t\t\t\t\t'text'  : <text>,\n\t * \t\t\t\t\t\t\t\t\t\t\t'start' : <seconds>,\n\t * \t\t\t\t\t\t\t\t\t\t\t'end'   : <seconds> }\n\t *\t\t\t\t\t\t\t\t\t\t  will only change keys in the list\n\t */\n\tedit_point(plane_name, point_name, data) {\n\t\tlet plane = this.get_plane(plane_name);\n\t\tif (!plane) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet original_data = this.get_point(plane_name, point_name);\n\t\tif (!original_data) {\n\t\t\treturn false;\t\n\t\t}\n\n\t\tlet { start } = data;\n\t\tstart = Number(start);\n\t\tlet will_refresh = ((start != null) && (start !== original_data.start));\n\n\t\tdata = {...original_data, ...data};\n\n\t\tplane.points[point_name] = data;\n\n\t\tthis.draw_point(plane_name, point_name);\n\t\tif (will_refresh) {\n\t\t\tthis.panel_reorder(plane_name);\n\t\t}\n\n\t\tthis.fire_event('edit_point', {\n\t\t\tplane : plane_name,\n\t\t\tpoint : point_name,\n\t\t\tdata_point :  data\n\t\t});\n\n\t\tif (plane._st_max < start) {\n\t\t\tplane._st_max = start;\n\t\t}\n\n\t}\n\n\t/**\n\t * @summary Remove an annotation point\n\t * @public\n\t *\n\t * @param      {string}   plane_name  A name in the range /^[a-zA-Z0-9\\-_$]+/\n\t * @param      {string}   point_name  A name in the range /^[a-zA-Z0-9\\-_$]+/\n\t * @return     {boolean}  success\n\t */\n\tremove_point(plane_name, point_name) {\n\t\tlet plane = this.get_plane(plane_name);\n\t\tif ((!plane) || (!this.get_point(plane_name, point_name))) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.fire_event('remove_point', {\n\t\t\tplane : plane_name,\n\t\t\tpoint : point_name\n\t\t});\n\n\t\tthis.get_point_track(plane_name, point_name)?.remove();\n\t\tthis.get_point_panel(plane_name, point_name)?.remove();\n\n\t\t//  recalc _start_max for caching repaints\n\t\tlet _st_max = 0;\n\t\tfor (let s of Object.values(this.plane_points(plane_name))) {\n\t\t\tlet that_start = Number(s.start);\n\t\t\t_st_max = _st_max < that_start ? that_start : _st_max;\n\t\t}\n\t\tplane._st_max = _st_max;\n\n\t\tif ( (!this.is_controller) && (this.mirrored_in_controller()) ) {\n\t\t\tdocument.CPU.global_controller.remove_point(plane_name, point_name);\n\t\t}\n\t\tif (plane.points[point_name]) {\n\t\t\tdelete plane.points[point_name];\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * @summary Remove any points from an annotation plane\n\t * @public\n\t *\n\t * @param      {string}  plane_name  The plane name\n\t */\n\tclear_plane(plane_name) {\n\t\tlet plane = this.get_plane(plane_name);\n\t\tif (!plane) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (let point_name of Object.keys(plane.points)) {\n\t\t\tthis.remove_point(plane_name, point_name);\n\t\t}\n\t\t// need to repass in case of badly removed / malformed entries\n\t\tlet nav = this.get_plane_nav(plane_name);\n\t\tif (nav) {\n\t\t\tnav.innerHTML = '';\n\t\t}\n\t\t// purge repaint flag to redraw\n\t\tplane._st_max = 0;\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * @summary Refresh a plane. a panel_reorder may be enough\n\t * @public\n\t *\n\t * @param      {string}  plane_name  The plane name\n\t */\n\trefresh_plane(plane_name) {\n\t\tthis.plane_resort(plane_name);\n\t\tfor (let point_name of this.plane_pointsnames(plane_name)) {\n\t\t\tthis.draw_point(plane_name, point_name);\n\t\t}\n\t}\n\n\t/**\n\t * @summary Clear and redraw all planes\n\t * Mainly when cpu-controller is changing targeted audio tag\n\t * @public\n\t */\n\tredraw_all_planes() {\n\t\tundraw_all_planes(this.container);\n\n\t\tfor (let plane_name of Object.keys({...this._planes, ...this.audiotag._CPU_planes})) {\n\t\t\tthis.draw_plane(plane_name);\n\t\t\tthis.refresh_plane(plane_name);\n\t\t}\n\t}\n\n\n\t/**\n\t * @summary Needed because Chrome can fire loadedmetadata before knowing audio duration. Fired at durationchange\n\t *\n\t * @private\n\t */\n\treposition_tracks() {\n\t\tlet duration = this.audiotag.duration;\n\t\tif ((duration === 0) || (isNaN(duration))) {\n\t\t\t// duration still unkown\n\t\t\treturn ;\n\t\t}\n\n\t\tfor (let plane_name in this.audiotag._CPU_planes) {\n\t\t\tlet plane_data = this.get_plane(plane_name);\n\t\t\tif (plane_data.track) {\n\t\t\t\tfor (let point_name of this.plane_pointsnames(plane_name)) {\n\t\t\t\t\tlet element = this.get_point_track(plane_name, point_name);\n\t\t\t\t\tlet {start, end} = this.get_point(plane_name, point_name);\n\t\t\t\t\tthis.position_time_element(element, start, end);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @summary Remove any previewes on plane points\n\t * @public\n\t *\n\t * @param\t\t\t {string}  plane_name The plane name to operate\n\t * @param      {string}  class_name Targeted class name, 'with-preview' by default\n\t * @param      {boolean} mirror     Also act on linked cpu-controller/cpu-audio\n\t */\n\tremove_highlights_points(plane_name, class_name=preview_classname, mirror=true) {\n\t\tquerySelector_apply(\n\t\t\t`#track_«${plane_name}» .${class_name}, #panel_«${plane_name}» .${class_name}`,\n\t\t\t(element) => { element.classList.remove(class_name); },\n\t\t\tthis.container);\n\t\tif ( (mirror) && (this.mirrored_in_controller()) ) {\n\t\t\tlet global_controller = document.CPU.global_controller;\n\n\t\t\tlet on;\n\t\t\tif (!this.is_controller) {\n\t\t\t\ton = global_controller;\n\t\t\t} else {\n\t\t\t\ton = find_container(global_controller.audiotag);\n\t\t\t}\n\t\t\ton.remove_highlights_points(plane_name, class_name, false);\n\t\t}\n\t}\n\n\t/**\n\t * @summary Sets a preview on a plane point\n\t * @public\n\t *\n\t * @param      {string}  plane_name  The plane name\n\t * @param      {string}  point_name  The point name\n\t * @param      {string}  class_name  class name, 'with-preview' by default\n\t * @param      {boolean} mirror     Also act on linked cpu-controller/cpu-audio, true by default\n\t */\n\thighlight_point(plane_name, point_name, class_name=preview_classname, mirror=true) {\n\t\tthis.remove_highlights_points(plane_name, class_name, mirror);\n\n\t\tif (! this.get_plane(plane_name)?.highlight) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.get_point_track(plane_name, point_name)?.classList.add(class_name);\n\t\tthis.get_point_panel(plane_name, point_name)?.classList.add(class_name);\n\n\t\tif ( (mirror) && (this.mirrored_in_controller()) ) {\n\t\t\tlet document_CPU = document.CPU;\n\t\t\tlet on;\n\t\t\tif (!this.is_controller) {\n\t\t\t\ton = document_CPU.global_controller;\n\t\t\t} else {\n\t\t\t\ton = find_container(document_CPU.global_controller.audiotag);\n\t\t\t}\n\t\t\ton.highlight_point(plane_name, point_name, class_name, false);\n\t\t}\n\t}\n\n}\n","import {CpuAudioTagName, acceptable_selector, selector_interface, not_screen_context, warn, } from './utils.js';\nimport {CPU_element_api} from './element_cpu.js';\n\n/**\n * Controller without assigned audio element, i.e. global page controller\n *\n * @class      CpuControllerElement (name)\n */\nexport class CpuControllerElement extends HTMLElement {\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CPU = null;\n\n\t\tif (not_screen_context()) {\n\t\t\t// I'm not in a screen context, as a braille surface\n\t\t\t// Sorry, but your browser's native controls are surely more accessible\n\t\t\tthis.remove();\n\t\t\treturn ;\n\t\t}\n\n\t\tif (this.tagName === CpuAudioTagName) {\n\t\t\tif (!this.querySelector(acceptable_selector)) {\n\t\t\t\t// Graceful degradation : do not start if no media element OR no native controls\n\t\t\t\twarn(`Tag <${CpuAudioTagName}> without <audio controls>.\\nSee https://github.com/dascritch/cpu-audio/blob/master/INSTALL.md for a correct installation.`);\n\t\t\t\tthis.remove();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tlet template =  document.querySelector('template#CPU__template');\n\t\tlet shadow_element = this.attachShadow({mode: 'open'});\n\t\tshadow_element.innerHTML = template.innerHTML;\n\t}\n\n\tconnectedCallback() {\n\t\tif (not_screen_context()) {\n\t\t\treturn ;\n\t\t}\n\t\tthis.CPU = new CPU_element_api(\n\t\t\tthis,\n\t\t\tthis.shadowRoot.querySelector(selector_interface),\n\t\t\t{\n\t\t\t\tglow : this.hasAttribute('glow'),\n\t\t\t\tmode : this.hasAttribute('mode') ? this.getAttribute('mode') : null,\n\t\t\t\thide : this.hasAttribute('hide') ? this.getAttribute('hide') : false,\n\t\t\t}\n\t\t);\n\t}\n\n\tdisconnectedCallback() {\n\t}\n\n}\n","import {acceptable_selector, find_container, info} from './utils.js';\nimport {CpuControllerElement} from './cpu_controller.class.js';\nimport {connect_audiotag} from './media_element_extension.js';\nimport {TimeInSeconds} from './convert.js';\nimport {build_chapters} from './build_chapters.js';\n\n/**\n * @summary Interprets if <cpu-audio> element is modified\n *\n * @param      {Object}  mutationsList  The mutations list\n */\nfunction observer_cpuaudio([{target}]) {\n\tconst container = find_container(target);\n\tlet media_tagname = 'audio';\n\tlet audio_element = container.element.querySelector(media_tagname);\n\tif (!audio_element) {\n\t\tinfo(`<${media_tagname}> element was removed.`);\n\t\tcontainer.element.remove();\n\t\treturn;\n\t}\n\tcontainer.element.copy_attributes_to_media_dataset();\n}\n\n/**\n * @summary Interprets if <audio> element is modified or removed\n * TODO : act when a child change as <source> or <track>\n *\n * @param      {Object}  mutationsList  The mutations list\n */\nfunction observer_audio([{target}]) {\n\tconst container = find_container(target);\n\n\t// in case <track> changed/removed\n\tbuild_chapters(container);\n\n\t// in case attributes changed\n\tcontainer.complete_template();\n\n\tconst global_controller = document.CPU.global_controller;\n\tif (container.audiotag.isEqualNode(global_controller?.audiotag)) {\n\t\tbuild_chapters(global_controller);\n\t\tglobal_controller.complete_template();\n\t}\n}\n\n/**\n * Controller with assigned audio element\n *\n * @class      CpuAudioElement (name)\n */\nexport class CpuAudioElement extends CpuControllerElement {\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis._audiotag = null;\n\t\tthis.audiotag = null;\n\t\tthis.observer_cpuaudio = null;\n\t\tthis.observer_audio = null;\n\t}\n\n\tcopy_attributes_to_media_dataset() {\n\t\t// copying personalized data to audio tag\n\t\t/**\n\t\tnot working because of null returned values, and because dataset in a setter\n\t\t\tlet def = document.CPU.default_dataset;\n\t\t\tthis._audiotag.dataset = {...def, duration : TimeInSeconds(def.duration || 0)};\n\t\t**/\n\n\t\tfor (let key in document.CPU.default_dataset) {\n\t\t\tlet value = this.getAttribute(key);\n\t\t\tif (value !== null) {\n\t\t\t\tthis._audiotag.dataset[key] = (key !== 'duration') ? value : TimeInSeconds(value);\n\t\t\t}\n\t\t}\n\t}\n\n\tconnectedCallback() {\n\t\tthis._audiotag = this.querySelector(acceptable_selector);\n\t\tif (!this._audiotag) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.copy_attributes_to_media_dataset();\n\n\t\tsuper.connectedCallback();\n\n\t\tconnect_audiotag(this.CPU.audiotag);\n\n\t\tthis.observer_cpuaudio = new MutationObserver(observer_cpuaudio);\n\t\tthis.observer_cpuaudio.observe(this, {\n\t\t\tchildList \t: true,\n\t\t\tattributes\t: true\n\t\t});\n\n\t\tthis.observer_audio = new MutationObserver(observer_audio);\n\t\tthis.observer_audio.observe(this, {\n\t\t\tchildList\t: true,\n\t\t\tattributes\t: true,\n\t\t\tsubtree\t\t: true\n\t\t});\n\n\t\t// this.observer.disconnect();\n\t}\n}\n","export const default_document_cpu_parameters = {\n\t// those values may be later modified via loading parameters\n\n\t// @public\n\t// @type boolean\n\tautoplay : false,\n\n\t// @public\n\t// @type number\n\tkeymove : 5,\n\t// @public\n\t// @type boolean\n\tonly_play_one_audiotag : true,\n\t// @public\n\t// @type number\n\t// why 500ms ? Because Chrome will trigger a touchcancel event at 800ms to show a context menu\n\talternate_delay : 500,\n\n\t// @public\n\t// @type number\n\tfast_factor : 4,\n\t// @public\n\t// @type number\n\trepeat_delay : 400,\n\t// @public\n\t// @type number\n\trepeat_factor : 100,\n\n\t// @public\n\t// @type boolean\n\tadvance_in_playlist : true,\n\n};","import {find_interface, find_container, once_passive_ev, selector_audio_in_component, warn} from './utils.js';\nimport {default_document_cpu_parameters} from './default_document_cpu_parameters.js';\nimport {default_dataset} from './default_dataset.js';\nimport {convert, TimeInSeconds} from './convert.js';\nimport {trigger} from './trigger.js';\nimport {is_audiotag_streamed} from './media_element_extension.js';\n\nexport const document_CPU = {\n\t// global object for global API\n\n\t// public, parameters\n\t...default_document_cpu_parameters,\n\n\t// public, actual active elements\n\t// @public\n\t// @type {HTMLAudioElement|null}\n\tcurrent_audiotag_playing : null,\n\t// @type {CpuControllerElement|null}\n\t// @public\n\tglobal_controller : null,\n\n\t// private, indicate a play already occured in the DOM, so we can start any play\n\t// @private\n\t// @type boolean\n\thad_played : false,\n\n\t// private, indicate last used audiotag\n\t// @private\n\t// @type {HTMLAudioElement|null}\n\tlast_used : null,\n\n\t// public, playlists\n\t// @public\n\t// @type Object\n\tplaylists : {},\n\n\t// public, Exposing internals needed for tests\n\t// @public\n\tconvert,\n\t// @public\n\ttrigger,\n\n\t// @package, not enough mature\n\tdefault_dataset,\n\n\t// @public utilities to find shadowRoot and CPU API\n\tfind_interface,\n\tfind_container,\n\n\t/**\n\t * @public\n\t * @summary Determines if audiotag is currently playing.\n\t *\n\t * @param      {HTMLAudioElement}   audiotag  The audiotag\n\t * @return     {boolean}  True if audiotag playing, False otherwise.\n\t */\n\tis_audiotag_playing : function(audiotag) {\n\t\tlet current_audiotag_playing = document.CPU.current_audiotag_playing;\n\t\treturn (current_audiotag_playing) && (audiotag.isEqualNode(current_audiotag_playing));\n\t},\n\t/**\n\t * @public\n\t * @summary Determines if audiotag is displayed in <cpu-controller>\n\t *\n\t * @param      {HTMLAudioElement}   audiotag  The audiotag\n\t * @return     {boolean}  True if audiotag global, False otherwise.\n\t */\n\tis_audiotag_global : function(audiotag) {\n\t\treturn this.global_controller ? \n\t\t\taudiotag.isEqualNode(this.global_controller.audiotag) : \n\t\t\tthis.is_audiotag_playing(audiotag);\n\t},\n\n\t/**\n\t * @public\n\t * @summary Position a timecode to a named audio tag\n\t *\n\t * @param      {string}   hash         The id=\"\" of an <audio> tag\n\t * @param      {string}   timecode     The timecode,\n\t * @param      {Function|null|undefined}   callback_fx  Function to be called afterwards, for ending tests\n\t */\n\tjumpIdAt : async function(hash, timecode, callback_fx=undefined) {\n\n\t\t/**\n\t\t * @param \t{Object}\tevent \ttriggered event, or mockup\n\t\t */\n\t\tfunction do_needle_move({target:audiotag}) {\n\t\t\t// maybe we should add `timecode` in argument (timecode, event), and bind it to the event listener, moving the function upper\n\t\t\tlet secs = TimeInSeconds(timecode);\n\t\t\tdocument.CPU.seekElementAt(audiotag, secs);\n\n\t\t\tlet mocked_event = {target : audiotag};\n\t\t\tif (audiotag.readyState >= audiotag.HAVE_FUTURE_DATA) {\n\t\t\t\tdo_element_play(mocked_event);\n\t\t\t} else {\n\t\t\t\taudiotag.addEventListener('canplay', do_element_play, once_passive_ev);\n\t\t\t}\n\t\t\ttrigger.update(mocked_event);\n\t\t}\n\n\t\t/**\n\t\t * @param \t{Object}\tevent \ttriggered event, or mockup\n\t\t */\n\t\tfunction do_element_play(event) {\n\t\t\tlet tag = event.target;\n\t\t\ttrigger.play(undefined, tag);\n\t\t\tcallback_fx?.();\n\t\t}\n\n\t\tlet audiotag = /** @type {HTMLAudioElement} */ ( (hash !== '') ? document.getElementById(hash)  :  document.querySelector(selector_audio_in_component) );\n\n\t\tif ((audiotag == null) || (audiotag.currentTime === undefined)) {\n\t\t\twarn(`Unknow audiotag ${hash}`);\n\t\t\treturn;\n\t\t}\n\n\t\tlet mocked_event = {target : audiotag};\n\t\tif (audiotag.readyState < HTMLMediaElement.HAVE_CURRENT_DATA) {\n\t\t\t// WHHYYYY ??????\n\t\t\taudiotag.addEventListener('loadedmetadata', do_needle_move , once_passive_ev);\n\t\t\taudiotag.load();\n\t\t\ttrigger.update(mocked_event);\n\t\t} else {\n\t\t\tdo_needle_move(mocked_event);\n\t\t}\n\t\t// No problems\n\t},\n\n\t/**\n\t * @summary Position a <audio> element to a time position\n\t * @public\n\t *\n\t * @param      {HTMLAudioElement}  audiotag  <audio> DOM element\n\t * @param      {number}  seconds   \tWanted position, in seconds\n\t *\n\t */\n\tseekElementAt : function (audiotag, seconds) {\n\t\tif ((isNaN(seconds)) || // may happens, if the audio track is not loaded/loadable\n\t\t\t(is_audiotag_streamed(audiotag))) { // never try to set a position on a streamed media\n\t\t\treturn;\n\t\t}\n\n\t\tif (audiotag.fastSeek !== undefined) {\n\t\t\t// HTMLAudioElement.fastSeek() is an experimental but really fast function.\n\t\t\taudiotag.fastSeek(seconds);\n\t\t} else {\n\t\t\ttry {\n\t\t\t\t// Browsers may not have fastSeek but can set currentTime\n\t\t\t\taudiotag.currentTime = seconds;\n\t\t\t} catch(e) {\n\t\t\t\t// except sometimes, so you must use standard media fragment\n\t\t\t\taudiotag.src = `${audiotag.currentSrc.split('#')[0]}#t=${seconds}`;\n\t\t\t}\n\t\t}\n\n\t\tlet controller = audiotag.CPU_controller();\n\t\t// it may be still constructing it, so be precautionous\n\t\tcontroller?.update_loading?.(seconds);\n\t},\n\n\n\t/**\n>\t * @summary Return the current playing playlist array\n\t * @public\n\t *\n\t * @return     {Array}  Array with named id\n\t */\n\tfind_current_playlist : function() {\n\n\t\tlet current_audiotag = this.global_controller?.audiotag;\n\t\tif (!current_audiotag) {\n\t\t\treturn [];\n\t\t}\n\t\tfor (let playlist of this.playlists) {\n\t\t\tif (playlist.includes(current_audiotag.id)) {\n\t\t\t\treturn playlist;\n\t\t\t}\n\t\t}\n\t\treturn [];\n\t}\n};\n","import {CpuAudioTagName, CpuControllerTagName, acceptable_selector, is_decent_browser_for_webcomponents, passive_ev, querySelector_apply, warn} from './utils.js';\n\nimport {CpuAudioElement} from './cpu_audio.class.js';\nimport {CpuControllerElement} from './cpu_controller.class.js';\nimport {attach_events_audiotag} from './media_element_extension.js';\nimport {document_CPU} from './document_cpu.js';\nimport {insert_template} from '../tmp/insert_template.js';\nimport {trigger} from './trigger.js';\n\n/**\n * Entry point\n *\n * @return     {Promise}  No returned value\n */\nasync function main() {\n\tinsert_template();\n\n\tif (!is_decent_browser_for_webcomponents()) {\n\t\twarn(`WebComponent may NOT behave correctly on this browser. Only timecode hash links are activated.\\nSee https://github.com/dascritch/cpu-audio/ for details`);\n\t\tquerySelector_apply(acceptable_selector, attach_events_audiotag);\n\t\tdocument.body.classList.add('cpu-audio-without-webcomponents');\n\t} else {\n\t\twindow.customElements.define(CpuAudioTagName.toLowerCase(), CpuAudioElement);\n\t\twindow.customElements.define(CpuControllerTagName.toLowerCase(), CpuControllerElement);\n\t\tdocument.body.classList.add('cpu-audio-with-webcomponents');\n\t}\n\twindow.addEventListener('hashchange', trigger.hash_order, passive_ev);\n\ttrigger.hash_order({ at_start : true });\n}\n\nif ((document.CPU) || (window.customElements.get(CpuAudioTagName.toLowerCase()))) {\n\twarn('cpu-audio is called twice');\n} else {\n\t// Here comes document.CPU\n\tHTMLDocument.prototype.CPU = document_CPU;\n\n\tif (document.body !== null) {\n\t\tmain();\n\t} else {\n\t\t// needed in cpu-audio.js context\n\t\tdocument.addEventListener('DOMContentLoaded', main, passive_ev);\n\t}\n}\n","// auto-generated source, done via make.sh\nimport {__} from '../src/i18n.js';\n/** @summary insert styles and template into host document */\nexport function insert_template(){\n\tlet style = document.createElement('style');\n\tstyle.innerHTML = `audio[controls]{display:block;width:100%}:root{--cpu-height:64px;--cpu-font-family:Lato,\"Open Sans\",\"Segoe UI\",Frutiger,\"Frutiger Linotype\",\"Dejavu Sans\",\"Helvetica Neue\",Arial,sans-serif;--cpu-font-size:15px;--cpu-font-small-size:calc(var(--cpu-font-size) * 0.8);--cpu-background:#555;--cpu-color:#ddd;--cpu-playing-background:#444;--cpu-playing-color:#fff;--cpu-error-background:#a00;--cpu-error-color:#ff7;--cpu-popup-background:#aaa;--cpu-popup-color:#333;--cpu-cue:#000;--cpu-timeline-limits:#f00;--cpu-elapse-width:160px;--cpu-min-padding:16px;--cpu-inner-shadow:inset 0px 5px 10px -5px black;--cpu-color-transitions:0s;--cpu-background-transitions:0s;--cpu-unfold:0s}@media (max-width:640px){.interface,:root{--cpu-font-size:13px;--cpu-height:48px;--cpu-elapse-width:140px;--cpu-min-padding:4px}@media (max-width:480px){.interface,:root{--cpu-elapse-width:70px}}}`;\n\tdocument.head.appendChild(style);\n\n\tlet template = document.createElement('template');\n\ttemplate.id = 'CPU__template';\n\ttemplate.innerHTML = `<style>:host{all:initial;display:block;contain:content}.act-buffer,.act-play{--cpu-background:var(--cpu-playing-background);--cpu-color:var(--cpu-playing-color)}.show-error{--cpu-background:var(--cpu-error-background);--cpu-color:var(--cpu-error-color)}#interface{--cpu-timeline-height:10px;background:var(--cpu-background);color:var(--cpu-color)}#interface,*{font-family:var(--cpu-font-family);font-size:var(--cpu-font-size);font-weight:400;font-style:normal;line-height:1.2;border:none;padding:0;margin:0;text-indent:0;list-style-type:none;user-select:none;transition:color var(--cpu-color-transitions),background-color var(--cpu-background-transitions),opacity var(--cpu-background-transitions)}.show-no main{visibility:hidden}main{display:flex;overflow:hidden;height:var(--cpu-height)}a,button{color:currentColor;border:none;text-decoration:none}button{background:0 0}svg{fill:currentColor;width:var(--cpu-height);height:var(--cpu-height)}em,i{font-style:italic}b,h5 a,strong{font-weight:700}[src='']{visibility:hidden}#pageerror{padding:0 4px;align-self:center}#actions,#control{flex:0 0 var(--cpu-height);width:var(--cpu-height);max-height:var(--cpu-height);height:100%;text-align:center;vertical-align:middle}a{cursor:pointer}#handheld-nav,#loading,#pause,#play,.show-error #pagemain,.show-error #pageshare,.show-error #poster,.show-handheld-nav #titleline,.show-main #pageerror,.show-main #pageshare,.show-share #pageerror,.show-share #pagemain{display:none}.act-glow #pause,.act-loading #loading,.act-pause #pause,.act-play #play{display:block}.act-glow #pause{animation:glow 2s infinite}@keyframes glow{0%{opacity:.5}50%{opacity:1}100%{opacity:.5}}.show-main #pagemain,.show-share #pageshare{flex:1 1 100%;display:flex;align-items:center}.act-loading #loading circle{fill:#777;opacity:1;animation:pulse 2s infinite}#loading circle:nth-child(2){animation-delay:.5s}#loading circle:nth-child(3){animation-delay:1s}@keyframes pulse{50%{opacity:0}}#poster{max-width:var(--cpu-height);min-width:var(--cpu-height);max-height:var(--cpu-height);min-height:var(--cpu-height);object-fit:contain;opacity:0}.poster-loaded #poster{opacity:1}.hide-poster #poster{display:none}#actions svg,#control svg{vertical-align:middle;max-width:100%;max-height:100%}#titleline{display:flex;align-items:center}#about,#title{flex:1 1 auto;position:relative}#title{overflow:hidden;text-overflow:'…'}#title a{display:block;max-height:calc(6px + calc(2 * var(--cpu-font-size)))}#canonical.untitled{font-style:italic}#elapse{flex:0 1 var(--cpu-elapse-width);text-align:right}.mode-compact #elapse{flex:0 0 calc(var(--cpu-elapse-width) + 32px);text-align:center}#time{background-color:#000;background-repeat:no-repeat;background-size:100% 100%;width:100%;height:var(--cpu-timeline-height);display:block;position:relative;cursor:none}#loadingline{background:currentColor;height:var(--cpu-timeline-height);display:block;position:absolute;left:0;pointer-events:none}#loadingline:after{content:'';position:absolute;right:0;width:0;height:var(--cpu-timeline-height);display:block;outline:var(--cpu-color) 4px solid;z-index:127;opacity:0}main:focus #loadingline:after,main:hover #loadingline:after{opacity:1}aside{position:absolute;width:100%}aside a{position:absolute;display:block}aside a span{display:none}aside.chapters{height:2px}aside.chapters a{background:var(--cpu-cue);height:2px;border:1px solid var(--cpu-background)}aside.chapters a.active-cue{background:var(--cpu-color)}aside.borders{pointer-events:none;height:var(--cpu-timeline-height);z-index:4;top:calc(var(--cpu-timeline-height) + 6px)}aside.borders a{height:var(--cpu-timeline-height);background:0 0}aside.borders a:after,aside.borders a:before{pointer-events:none;content:\"\";position:absolute;width:2px;height:var(--cpu-timeline-height);border:2px solid var(--cpu-timeline-limits)}aside.borders a:before{border-right-width:0;left:0}aside.borders a:after{border-left-width:0;left:100%}aside.ticker{height:16px;top:30px}aside.ticker a.active-cue{left:0!important;right:0!important;background:inherit!important;color:inherit!important}aside.ticker a.active-cue span{display:inline-block}.act-loading #loadingline #loadingline{background:repeating-linear-gradient(45deg,var(--cpu-color) 0,var(--cpu-background) 15px,var(--cpu-color) 30px);background-size:200% 200%;animation:loadingline 1s linear infinite}@keyframes loadingline{0%{background-position-y:var(--cpu-timeline-height)}}#handheld-nav{max-height:calc(6px + calc(2 * var(--cpu-font-size)));padding-bottom:8px}.show-handheld-nav #handheld-nav{display:flex}#handheld-nav *{flex:1 0 auto;height:calc(2 * var(--cpu-font-size))}.hide-actions #actions{visibility:hidden;pointer-events:none;min-width:var(--cpu-min-padding);max-width:var(--cpu-min-padding)}#pageshare{text-align:center}#pageshare a{display:flex;align-items:center;justify-content:center;height:var(--cpu-height)}#pageshare a,#pageshare div{flex:1 0;color:#fff;text-decoration:none;overflow:hidden;text-overflow:clip}#pageshare svg{vertical-align:middle;width:32px;height:32px}#pageshare #nativeshare{display:none}.hasnativeshare #pageshare #nativeshare{display:flex}.hasnativeshare #pageshare .nonativeshare{display:none}#twitter{background:#4db5f4}#facebook,#nativeshare{background:#5974cc}#email{background:#c00}#link{background:#77f}#popup{pointer-events:none;position:absolute;transform:translate(-25px,-19px);z-index:127;min-width:50px;font-size:11px;text-align:center;padding:2px;border-radius:4px;box-shadow:#000 2px 2px;background:var(--cpu-popup-background);color:var(--cpu-popup-color);opacity:0}#popup:before{pointer-events:none;content:\"\";position:absolute;z-index:127;left:20px;bottom:-8px;width:0;height:0;border-top:8px solid var(--cpu-popup-background);border-left:4px solid transparent;border-right:4px solid transparent}.panel{display:flex;list-style:none;flex-direction:column;padding:0 var(--cpu-min-padding);box-shadow:var(--cpu-inner-shadow)}h6{text-align:center}.cue{border-top:1px solid #000;display:flex;margin:0;padding:2px}.cue strong{flex:1 1;font-weight:400}.cue time{flex:0 0 var(--cpu-elapse-width) 0px;text-align:right}.nocuetime time{display:none}.cue time,aside a,aside.ticker *,h6{font-size:var(--cpu-font-small-size)}.mode-compact{width:calc(var(--cpu-elapse-width) + var(--cpu-height) * 2 + 32px)}.mode-button{width:var(--cpu-height)}.mode-button #about,.mode-button #actions,.mode-button #poster,.mode-button .panel,.mode-button aside,.mode-compact #actions,.mode-compact #line,.mode-compact #title,.mode-compact .panel,.mode-compact aside{width:0;display:none}.hide-chapters .chapters,.hide-panels .panel,.hide-panels-except-play .panel,.hide-panels-title h6,.hide-timeline #line,.media-streamed #line,.media-streamed #link,.mode-hidden{display:none}.hide-panels-except-play.last-used .panel{display:flex}.mode-compact.show-main #pagemain{flex:0 0 auto}@media (max-width:640px){.nosmall{display:none!important}#elapse{max-height:16px}#interface{--cpu-timeline-height:8px}#handheld-nav{padding-bottom:4px}aside.ticker{top:22px}}@media (max-width:480px){.nosmaller{display:none!important}.mode-default #elapse{flex:0 1 var(--cpu-elapse-width)}.mode-default #pagemain{padding-bottom:16px}#titleline{height:32px}#line{position:absolute;left:calc(0px - var(--cpu-height));right:calc(0px - var(--cpu-height));height:16px;top:32px}aside a{pointer-events:none}aside.borders{top:-2px}aside.chapters{top:8px}#handheld-nav{padding-bottom:2px}}@media (max-width:320px){.mode-default #elapse,.nosmallest{display:none!important}}@media print{#interface{display:none}}#pageshare div:hover,.active-cue,.with-preview,a:focus,a:hover,button:focus,button:hover{background:var(--cpu-focus-background,var(--cpu-color))!important;color:var(--cpu-focus-color,var(--cpu-background))!important}</style><div id=\"interface\"class=\"show-no\"tabindex=\"0\"><main><img id=\"poster\"class=\"nosmall\"src=\"\"alt=\"\"loading=\"lazy\"decoding=\"async\"><section id=\"pageerror\"role=\"alert\"></section><section id=\"pagemain\"><button type=\"button\"id=\"control\"tabindex=\"0\"><svg id=\"loading\"aria-label=\"${__.loading}\"viewBox=\"0 0 32 32\"aria-hidden=\"true\"><title>${__.loading}</title><circle cx=\"6\"cy=\"22\"r=\"4\"/><circle cx=\"16\"cy=\"22\"r=\"4\"/><circle cx=\"26\"cy=\"22\"r=\"4\"/></svg> <svg id=\"play\"aria-label=\"${__.pause}\"viewBox=\"0 0 32 32\"aria-hidden=\"true\"><title>${__.pause}</title><path d=\"M 6,6 12.667,6 12.667,26 6,26 z\"/><path d=\"M 19.333,6 26,6 26,26 19.333,26 z\"/></svg> <svg id=\"pause\"aria-label=\"${__.play}\"viewBox=\"0 0 32 32\"aria-hidden=\"true\"><title>${__.play}</title><path d=\"M 6,6 6,26 26,16 z\"/></svg></button><div id=\"about\"><div id=\"titleline\"><h5 id=\"title\"><a href=\"#\"id=\"canonical\"aria-label=\"${__.canonical}\"></a></h5><a id=\"elapse\"aria-label=\"${__.moment}\"tabindex=\"-1\"><span>…</span><span class=\"nosmaller\"></span></a></div><div id=\"handheld-nav\"><button type=\"button\"id=\"restart\"><svg viewBox=\"0 0 24 16\"aria-hidden=\"true\"><polygon points=\"4,0 8,0 8,16 4,16\"/><path d=\"M 16,0 8,8 16,16 z\"/><path d=\"M 24,0 16,8 24,16 z\"/></svg></button> <button type=\"button\"id=\"fastreward\"><svg viewBox=\"0 0 24 16\"aria-hidden=\"true\"><path d=\"M 8,0 0,8 8,16 z\"/><path d=\"M 16,0 8,8 16,16 z\"/><path d=\"M 24,0 16,8 24,16 z\"/></svg></button> <button type=\"button\"id=\"reward\"class=\"nosmallest\"><svg viewBox=\"0 0 24 16\"aria-hidden=\"true\"><path d=\"M 12,0 4,8 12,16 z\"/><path d=\"M 20,0 12,8 20,16 z\"/></svg></button> <button type=\"button\"id=\"foward\"><svg viewBox=\"0 0 24 16\"aria-hidden=\"true\"><path d=\"M 4,0 12,8 4,16 z\"/><path d=\"M 12,0 20,8 12,16 z\"/></svg></button> <button type=\"button\"id=\"fastfoward\"><svg viewBox=\"0 0 24 16\"aria-hidden=\"true\"><path d=\"M 0,0 8,8 0,16 z\"/><path d=\"M 8,0 16,8 8,16 z\"/><path d=\"M 16,0 24,8 16,16 z\"/></svg></button></div><div id=\"line\"><div id=\"time\"><div id=\"loadingline\"role=\"progressbar\"></div><time id=\"popup\">--:--</time></div></div></div><button id=\"actions\"aria-label=\"${__.more}\"title=\"${__.more}\"><svg viewBox=\"0 0 32 32\"aria-hidden=\"true\"><circle cx=\"7\"cy=\"16\"r=\"3\"/><circle cx=\"16\"cy=\"16\"r=\"3\"/><circle cx=\"25\"cy=\"16\"r=\"3\"/></svg></button></section><section id=\"pageshare\"><a href=\"#\"target=\"social\"id=\"nativeshare\"aria-label=\"${__.share}\"title=\"${__.share}\"><svg viewBox=\"0 0 32 32\"aria-hidden=\"true\"><path d=\"M 21 0 C 18.2 0 16 2.2 16 5 C 16 5.1 16 5.2 16.0 5.2 L 8.2 9.2 C 7.3 8.4 6.2 8 5 8 C 2.2 8 0 10.2 0 13 C 0 15.8 2.2 18 5 18 C 6.2 18 7.3 17.5 8.2 16.8 L 16 20.8 C 16.0 20.8 16 20.9 16 21 C 16 23.8 18.2 26 21 26 C 23.8 26 26 23.8 26 21 C 26 18.2 23.8 16 21 16 C 19.8 16 18.7 16.4 17.8 17.2 L 10 13.3 C 10 13.2 10 13.1 10 13 C 10 12.9 10 12.8 10 12.8 L 17.8 8.8 C 18.7 9.6 19.8 10 21 10 C 23.8 10 26 7.8 26 5 C 26 2.2 23.8 0 21 0 Z\"></path></svg> <span class=\"nosmall\">${__.share}</span> </a><a href=\"#\"target=\"social\"id=\"twitter\"class=\"nonativeshare\"aria-label=\"${__.twitter}\"title=\"${__.twitter}\"><svg viewBox=\"0 0 32 32\"aria-hidden=\"true\"><path d=\"M 25.9,9.9 C 25.2,10.2 24.4,10.4 23.6,10.5 24.5,10 25.1,9.2 25.4,8.2 24.6,8.8 23.8,9.1 22.9,9.3 22.1,8.5 21.1,8 19.9,8 c -2.2,0 -4,1.8 -4,4 0,0 0,0.6 0.1,0.9 -3.3,-0.2 -6.3,-1.8 -8.3,-4.2 -0.3,0.6 -0.5,1.3 -0.5,2 0,1.4 0.7,2.6 1.8,3.4 -0.7,0 -1.3,-0.2 -1.8,-0.5 0,0 0,0 0,0.1 0,2 1.4,3.6 3.2,4 -0.3,0.1 -0.7,0.1 -1.1,0.1 -0.3,0 -0.5,0 -0.8,-0.1 0.5,1.6 2,2.8 3.7,2.8 -1.4,1.1 -3.1,1.7 -5,1.7 -0.3,0 -0.6,0 -1,-0.1 1.8,1.1 3.9,1.8 6.1,1.8 7.4,0 11.4,-6.1 11.4,-11.4 0,-0.2 0,-0.3 0,-0.5 0.8,-0.6 1.4,-1.3 2,-2.1 z\"/></svg> <span class=\"nosmall\">${__.twitter}</span> </a><a href=\"#\"target=\"social\"id=\"facebook\"class=\"nonativeshare\"aria-label=\"${__.facebook}\"title=\"${__.facebook}\"><svg viewBox=\"0 0 32 32\"aria-hidden=\"true\"><path d=\"m 21.1,16 -3.7,0 0,10 -4.3,0 0,-10 -2.1,0 0,-3.3 2.1,0 0,-2.1 c 0,-2.9 1.2,-4.6 4.7,-4.6 l 3.9,0 0,3.5 -3.2,0 c -1,0 -1.1,0.5 -1.1,1.4 l -0,1.8 4.3,0 -0.6,3.3 0,0 z\"/></svg> <span class=\"nosmall\">${__.facebook}</span> </a><a href=\"#\"target=\"social\"id=\"email\"class=\"nonativeshare\"aria-label=\"${__.e_mail}\"title=\"${__.e_mail}\"><svg viewBox=\"0 0 32 32\"aria-hidden=\"true\"><path d=\"m 8,9 15.9,0 c 0.3,0 0.6,0.1 0.8,0.2 l -8.8,9 -8.8,-9 c 0.3,-0.1 0.5,-0.2 0.8,-0.2 z m -2,12.3 0,-10.5 c 0,0 0,-0.1 0,-0.1 l 5.8,6 -5.8,5.1 c 0,-0.1 -0.1,-0.3 -0.1,-0.4 z m 17.9,1.8 -15.9,0 c -0.2,0 -0.3,0 -0.5,-0.1 l 5.7,-5 2.8,2.9 2.8,-2.9 5.7,5 c -0.2,0 -0.3,0.1 -0.5,0.1 z m 2,-1.8 c 0,0.2 0,0.3 -0.1,0.5 l -5.8,-5.1 5.8,-6 c 0,0 0,0.1 0,0.1 z\"/></svg> <span class=\"nosmall\">${__.e_mail}</span> </a><a href=\"#\"target=\"social\"download=\"\"id=\"link\"aria-label=\"${__.download}\"title=\"${__.download}\"><svg viewBox=\"0 0 32 32\"aria-hidden=\"true\"><path d=\"M 6,6 26,6 16,26 z\"/><rect x=\"6\"y=\"22\"width=\"20\"height=\"4\"/></svg> <span class=\"nosmall\">${__.download}</span> </a><a id=\"back\"aria-label=\"${__.back}\"title=\"${__.back}\"><svg viewBox=\"0 0 32 32\"aria-hidden=\"true\"><path d=\"M 9,8 24,23 23,24 8,9 z\"/><path d=\"M 9,24 24,9 23,8 8,23 z\"/></svg> <span class=\"nosmall\">${__.back}</span></a></section></main></div>`;\n\tdocument.head.appendChild(template);\n}\n"],"sourceRoot":""}